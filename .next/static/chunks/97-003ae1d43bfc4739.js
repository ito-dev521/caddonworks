"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{33277:function(e,r,o){o.d(r,{C:function(){return s}});var n=o(57437);o(2265);var t=o(96061),i=o(22169);let l=(0,t.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600",engineering:"border-engineering-blue bg-engineering-blue/10 text-engineering-blue",glass:"glass text-gray-700 border-white/30"}},defaultVariants:{variant:"default"}});function s(e){let{className:r,variant:o,...t}=e;return(0,n.jsx)("div",{className:(0,i.cn)(l({variant:o}),r),...t})}},575:function(e,r,o){o.d(r,{z:function(){return u}});var n=o(57437),t=o(2265),i=o(54949),l=o(96061),s=o(22169);let a=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=t.forwardRef((e,r)=>{let{className:o,variant:t,size:l,asChild:u=!1,...c}=e,d=u?i.g7:"button";return(0,n.jsx)(d,{className:(0,s.cn)(a({variant:t,size:l,className:o})),ref:r,...c})});u.displayName="Button"},66210:function(e,r,o){o.r(r),o.d(r,{AuthProvider:function(){return a},useAuth:function(){return s}});var n=o(57437),t=o(2265),i=o(14958);let l=(0,t.createContext)(void 0);function s(){let e=(0,t.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a(e){let{children:r}=e,[o,s]=(0,t.useState)(null),[a,u]=(0,t.useState)(null),[c,d]=(0,t.useState)(null),[g,f]=(0,t.useState)(null),[h,v]=(0,t.useState)(!0),b=(0,t.useRef)(null);(0,t.useEffect)(()=>{(async()=>{try{var e,r,o;console.log("AuthProvider: 初期セッション取得開始");let{data:{session:n},error:t}=await i.OQ.auth.getSession();if(t){console.error("AuthProvider: セッション取得エラー:",t),v(!1);return}console.log("AuthProvider: セッション取得結果:",{hasSession:!!n,userId:null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.id,hasAccessToken:!!(null==n?void 0:n.access_token),tokenLength:null==n?void 0:null===(r=n.access_token)||void 0===r?void 0:r.length}),s(null!==(o=null==n?void 0:n.user)&&void 0!==o?o:null),(null==n?void 0:n.user)&&(null==n?void 0:n.access_token)?(console.log("\uD83D\uDE80 AuthProvider: 初期セッション - ユーザープロフィール取得開始"),setTimeout(()=>{console.log("⏱️ setTimeout実行: fetchUserProfile呼び出し (初期セッション)"),p(n.user.id)},0)):console.log("AuthProvider: セッションまたはトークンなし、ローディング終了")}catch(e){console.error("AuthProvider: 初期化エラー:",e),s(null),u(null),d(null),f(null)}finally{v(!1)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,r)=>{var o,n;let t=new Date().toISOString();console.log("\uD83D\uDD04 [".concat(t,"] Auth state change:"),{event:e,userId:null==r?void 0:null===(o=r.user)||void 0===o?void 0:o.id,hasToken:!!(null==r?void 0:r.access_token)}),s(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),(null==r?void 0:r.user)&&"SIGNED_IN"===e?(console.log("\uD83D\uDD11 [".concat(t,"] Auth state change: SIGNED_IN, fetching profile")),setTimeout(()=>{console.log("⏱️ [".concat(t,"] setTimeout実行: fetchUserProfile呼び出し (SIGNED_IN)")),p(r.user.id)},0)):"SIGNED_OUT"===e&&(console.log("Auth state change: SIGNED_OUT, clearing profile"),u(null),d(null),f(null)),"INITIAL_SESSION"!==e&&v(!1)});return()=>e.unsubscribe()},[]);let p=async e=>{var r;let o=new Date().toISOString(),n=null===(r=Error().stack)||void 0===r?void 0:r.split("\n").slice(1,4).join(" -> ");if(console.log("\uD83D\uDD0D [".concat(o,"] fetchUserProfile: 開始"),{authUserId:e,fetchingRef:b.current,callStack:n}),b.current===e){console.log("⚠️ [".concat(o,"] fetchUserProfile: 既に実行中のためスキップ"),{authUserId:e});return}b.current=e,console.log("\uD83C\uDFC3 [".concat(o,"] fetchUserProfile: 実行開始"),{authUserId:e});try{console.log("fetchUserProfile: ユーザープロフィール取得開始");let{data:r,error:o}=await i.OQ.from("users").select("*").eq("auth_user_id",e).single();if(console.log("fetchUserProfile: ユーザープロフィール結果",{profile:null==r?void 0:r.id,error:null==o?void 0:o.message}),o&&"PGRST116"!==o.code){console.error("Error fetching user profile:",o);return}if(u(r),r){console.log("fetchUserProfile: メンバーシップ取得開始",{profileId:r.id});let{data:e,error:o}=await i.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(console.log("fetchUserProfile: メンバーシップ結果",{role:null==e?void 0:e.role,org_id:null==e?void 0:e.org_id,error:null==o?void 0:o.message}),o&&"PGRST116"!==o.code){console.error("Error fetching user role:",o);return}if(d((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:r,error:o}=await i.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();o?(console.error("Error fetching organization:",o),f(null)):f({id:r.id,name:r.name})}else f(null);console.log("fetchUserProfile: 完了",{role:null==e?void 0:e.role,organization:null==e?void 0:e.org_id})}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{b.current=null,console.log("✅ [".concat(o,"] fetchUserProfile: 実行完了"),{authUserId:e})}},m=async(e,r)=>{console.log("signIn: 開始",{email:e}),v(!0);try{var o;console.log("signIn: Supabase認証開始");let n=i.OQ.auth.signInWithPassword({email:e,password:r}),t=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:l,error:s}=await Promise.race([n,t]);if(console.log("signIn: Supabase認証結果",{data:null==l?void 0:null===(o=l.user)||void 0===o?void 0:o.id,error:null==s?void 0:s.message}),s)throw s;console.log("signIn: 認証成功"),(null==l?void 0:l.user)&&(console.log("signIn: ユーザープロフィール取得開始"),setTimeout(()=>{p(l.user.id)},50),console.log("signIn: ユーザープロフィール取得完了"))}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{console.log("signIn: 終了"),v(!1)}},y=async(e,r,o)=>{v(!0);try{let{data:n,error:t}=await i.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:o.display_name,specialties:o.specialties||[],qualifications:o.qualifications||[]}}});if(t)throw t;if(n.user){let{error:e}=await i.OQ.from("users").insert({auth_user_id:n.user.id,email:n.user.email,display_name:o.display_name||"",specialties:o.specialties||[],qualifications:o.qualifications||[],experience_years:o.experience_years});e&&console.error("Error creating user profile:",e)}}finally{v(!1)}},w=async()=>{v(!0);try{let{error:e}=await i.OQ.auth.signOut();if(e)throw e;s(null),u(null),d(null)}finally{v(!1)}},x=async e=>{if(!a)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{console.log("updateProfile: 更新開始",{userId:a.id,updates:e});let{data:r,error:o}=await i.OQ.from("users").update(e).eq("id",a.id).select().single();if(o)throw console.error("updateProfile: Supabaseエラー",o),o;console.log("updateProfile: 更新成功",r),u({...a,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,n.jsx)(l.Provider,{value:{user:o,userProfile:a,userRole:c,userOrganization:g,loading:h,signIn:m,signUp:y,signOut:w,updateProfile:x,getRedirectPath:()=>{if(!c)return"/dashboard";switch(c){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:r})}},14958:function(e,r,o){o.d(r,{OQ:function(){return t}});var n=o(37440);o(62601);let t=(0,n.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,r,o){o.d(r,{XO:function(){return a},cn:function(){return i},xG:function(){return l},z2:function(){return s}});var n=o(57042),t=o(74769);function i(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return(0,t.m6)((0,n.W)(r))}function l(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function s(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function a(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}}}]);