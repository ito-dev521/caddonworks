(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{22187:function(e,r,t){Promise.resolve().then(t.bind(t,22665))},22665:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return d}});var n=t(57437),s=t(2265),i=t(66210),l=t(14958),a=t(15671),o=t(575);function d(){var e;let{user:r,userProfile:t,userRole:d,userOrganization:u,loading:c}=(0,i.useAuth)(),[h,f]=(0,s.useState)(null),[g,m]=(0,s.useState)(null),[x,b]=(0,s.useState)(!1),v=async()=>{b(!0),m(null);try{let{data:{session:e},error:r}=await l.OQ.auth.getSession();if(r||!e){m("セッションが見つかりません: "+((null==r?void 0:r.message)||"セッションなし"));return}let t=await fetch("/api/jobs",{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}}),n=await t.json();t.ok?f(n):m(n.message||"APIエラー")}catch(e){console.error("Debug: エラー:",e),m("ネットワークエラー: "+e.message)}finally{b(!1)}};return(0,s.useEffect)(()=>{!c&&t&&d&&v()},[c,t,d]),(0,n.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"案件一覧デバッグ"}),(0,n.jsxs)(a.Zb,{className:"mb-6",children:[(0,n.jsx)(a.Ol,{children:(0,n.jsx)(a.ll,{children:"認証状態"})}),(0,n.jsx)(a.aY,{children:(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Loading:"})," ",c?"true":"false"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User:"})," ",r?"あり":"なし"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User ID:"})," ",(null==r?void 0:r.id)||"なし"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Email:"})," ",(null==r?void 0:r.email)||"なし"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Profile:"})," ",t?"あり":"なし"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Role:"})," ",d||"なし"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Organization:"})," ",u?u.name:"なし"]})]})})]}),(0,n.jsxs)(a.Zb,{className:"mb-6",children:[(0,n.jsx)(a.Ol,{children:(0,n.jsx)(a.ll,{children:"案件データ"})}),(0,n.jsx)(a.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(o.z,{onClick:v,disabled:x,children:x?"読み込み中...":"案件データを取得"}),g&&(0,n.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-red-800",children:"エラー"}),(0,n.jsx)("p",{className:"text-red-700",children:g})]}),h&&(0,n.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-green-800",children:"成功"}),(0,n.jsxs)("p",{className:"text-green-700",children:["案件数: ",(null===(e=h.jobs)||void 0===e?void 0:e.length)||0]}),(0,n.jsx)("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-auto max-h-96",children:JSON.stringify(h,null,2)})]})]})})]}),(0,n.jsxs)(a.Zb,{children:[(0,n.jsx)(a.Ol,{children:(0,n.jsx)(a.ll,{children:"ナビゲーション"})}),(0,n.jsx)(a.aY,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("a",{href:"/jobs",className:"block text-blue-600 hover:underline",children:"案件一覧ページ"}),(0,n.jsx)("a",{href:"/auth/login",className:"block text-blue-600 hover:underline",children:"ログインページ"}),(0,n.jsx)("a",{href:"/debug-auth",className:"block text-blue-600 hover:underline",children:"認証デバッグページ"})]})})]})]})})}},575:function(e,r,t){"use strict";t.d(r,{z:function(){return d}});var n=t(57437),s=t(2265),i=t(54949),l=t(96061),a=t(22169);let o=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,r)=>{let{className:t,variant:s,size:l,asChild:d=!1,...u}=e,c=d?i.g7:"button";return(0,n.jsx)(c,{className:(0,a.cn)(o({variant:s,size:l,className:t})),ref:r,...u})});d.displayName="Button"},15671:function(e,r,t){"use strict";t.d(r,{Ol:function(){return a},SZ:function(){return d},Zb:function(){return l},aY:function(){return u},ll:function(){return o}});var n=t(57437),s=t(2265),i=t(22169);let l=s.forwardRef((e,r)=>{let{className:t,variant:s="default",...l}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow-sm","glass"===s&&"glass backdrop-blur-md","gradient"===s&&"gradient-engineering text-white border-0","engineering"===s&&"border-engineering-blue/20 bg-gradient-to-br from-white to-engineering-blue/5 hover-lift",t),...l})});l.displayName="Card";let a=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...s})});a.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("h3",{ref:r,className:(0,i.cn)("font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});d.displayName="CardDescription";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...s})});u.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},66210:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return o},useAuth:function(){return a}});var n=t(57437),s=t(2265),i=t(14958);let l=(0,s.createContext)(void 0);function a(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function o(e){let{children:r}=e,[t,a]=(0,s.useState)(null),[o,d]=(0,s.useState)(null),[u,c]=(0,s.useState)(null),[h,f]=(0,s.useState)(null),[g,m]=(0,s.useState)(!0),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{try{var e;let{data:{session:r},error:t}=await i.OQ.auth.getSession();if(t){console.error("AuthProvider: セッション取得エラー:",t),m(!1);return}a(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&(null==r?void 0:r.access_token)?setTimeout(()=>{b(r.user.id)},0):m(!1)}catch(e){console.error("AuthProvider: 初期化エラー:",e),a(null),d(null),c(null),f(null),m(!1)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,r)=>{var t;a(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)&&"SIGNED_IN"===e?setTimeout(()=>{b(r.user.id)},0):"SIGNED_OUT"===e&&(d(null),c(null),f(null)),"INITIAL_SESSION"!==e&&m(!1)});return()=>e.unsubscribe()},[]);let b=async e=>{if(x.current!==e){x.current=e;try{let{data:r,error:t}=await i.OQ.from("users").select("*").eq("auth_user_id",e).single();if(t&&"PGRST116"!==t.code){console.error("Error fetching user profile:",t);return}if(d(r),r){let{data:e,error:t}=await i.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(t&&"PGRST116"!==t.code){console.error("Error fetching user role:",t);return}if(c((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:r,error:t}=await i.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();t?(console.error("Error fetching organization:",t),f(null)):f({id:r.id,name:r.name})}else f(null)}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{x.current=null,m(!1)}}},v=async(e,r)=>{m(!0);try{let t=i.OQ.auth.signInWithPassword({email:e,password:r}),n=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:s,error:l}=await Promise.race([t,n]);if(l)throw l;(null==s?void 0:s.user)&&setTimeout(()=>{b(s.user.id)},50)}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{m(!1)}},p=async(e,r,t)=>{m(!0);try{let{data:n,error:s}=await i.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:t.display_name,specialties:t.specialties||[],qualifications:t.qualifications||[]}}});if(s)throw s;if(n.user){let{error:e}=await i.OQ.from("users").insert({auth_user_id:n.user.id,email:n.user.email,display_name:t.display_name||"",specialties:t.specialties||[],qualifications:t.qualifications||[],experience_years:t.experience_years});e&&console.error("Error creating user profile:",e)}}finally{m(!1)}},y=async()=>{m(!0);try{let{error:e}=await i.OQ.auth.signOut();if(e)throw e;a(null),d(null),c(null)}finally{m(!1)}},j=async e=>{if(!o)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{let{data:r,error:t}=await i.OQ.from("users").update(e).eq("id",o.id).select().single();if(t)throw console.error("updateProfile: Supabaseエラー",t),t;d({...o,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,n.jsx)(l.Provider,{value:{user:t,userProfile:o,userRole:u,userOrganization:h,loading:g,signIn:v,signUp:p,signOut:y,updateProfile:j,getRedirectPath:()=>{if(!u)return"/dashboard";switch(u){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:r})}},14958:function(e,r,t){"use strict";t.d(r,{OQ:function(){return s}});var n=t(37440);t(62601);let s=(0,n.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,r,t){"use strict";t.d(r,{XO:function(){return o},cn:function(){return i},xG:function(){return l},z2:function(){return a}});var n=t(57042),s=t(74769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}function l(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function a(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function o(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}}},function(e){e.O(0,[778,440,971,938,744],function(){return e(e.s=22187)}),_N_E=e.O()}]);