(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{22187:function(e,r,n){Promise.resolve().then(n.bind(n,22665))},22665:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return u}});var t=n(57437),l=n(2265),o=n(66210),s=n(14958),i=n(15671),a=n(575);function u(){var e;let{user:r,userProfile:n,userRole:u,userOrganization:d,loading:c}=(0,o.useAuth)(),[g,h]=(0,l.useState)(null),[f,v]=(0,l.useState)(null),[m,x]=(0,l.useState)(!1),b=async()=>{x(!0),v(null);try{var e;console.log("Debug: 案件データ取得開始");let{data:{session:r},error:n}=await s.OQ.auth.getSession();if(console.log("Debug: セッション取得結果:",{hasSession:!!r,userId:null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.id,error:null==n?void 0:n.message}),n||!r){v("セッションが見つかりません: "+((null==n?void 0:n.message)||"セッションなし"));return}let t=await fetch("/api/jobs",{headers:{Authorization:"Bearer ".concat(r.access_token),"Content-Type":"application/json"}});console.log("Debug: APIレスポンス:",{status:t.status,statusText:t.statusText});let l=await t.json();console.log("Debug: API結果:",l),t.ok?h(l):v(l.message||"APIエラー")}catch(e){console.error("Debug: エラー:",e),v("ネットワークエラー: "+e.message)}finally{x(!1)}};return(0,l.useEffect)(()=>{!c&&n&&u&&b()},[c,n,u]),(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"案件一覧デバッグ"}),(0,t.jsxs)(i.Zb,{className:"mb-6",children:[(0,t.jsx)(i.Ol,{children:(0,t.jsx)(i.ll,{children:"認証状態"})}),(0,t.jsx)(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Loading:"})," ",c?"true":"false"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User:"})," ",r?"あり":"なし"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User ID:"})," ",(null==r?void 0:r.id)||"なし"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User Email:"})," ",(null==r?void 0:r.email)||"なし"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User Profile:"})," ",n?"あり":"なし"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User Role:"})," ",u||"なし"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"User Organization:"})," ",d?d.name:"なし"]})]})})]}),(0,t.jsxs)(i.Zb,{className:"mb-6",children:[(0,t.jsx)(i.Ol,{children:(0,t.jsx)(i.ll,{children:"案件データ"})}),(0,t.jsx)(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(a.z,{onClick:b,disabled:m,children:m?"読み込み中...":"案件データを取得"}),f&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-semibold text-red-800",children:"エラー"}),(0,t.jsx)("p",{className:"text-red-700",children:f})]}),g&&(0,t.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-semibold text-green-800",children:"成功"}),(0,t.jsxs)("p",{className:"text-green-700",children:["案件数: ",(null===(e=g.jobs)||void 0===e?void 0:e.length)||0]}),(0,t.jsx)("pre",{className:"mt-2 text-xs bg-white p-2 rounded border overflow-auto max-h-96",children:JSON.stringify(g,null,2)})]})]})})]}),(0,t.jsxs)(i.Zb,{children:[(0,t.jsx)(i.Ol,{children:(0,t.jsx)(i.ll,{children:"ナビゲーション"})}),(0,t.jsx)(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("a",{href:"/jobs",className:"block text-blue-600 hover:underline",children:"案件一覧ページ"}),(0,t.jsx)("a",{href:"/auth/login",className:"block text-blue-600 hover:underline",children:"ログインページ"}),(0,t.jsx)("a",{href:"/debug-auth",className:"block text-blue-600 hover:underline",children:"認証デバッグページ"})]})})]})]})})}},575:function(e,r,n){"use strict";n.d(r,{z:function(){return u}});var t=n(57437),l=n(2265),o=n(54949),s=n(96061),i=n(22169);let a=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=l.forwardRef((e,r)=>{let{className:n,variant:l,size:s,asChild:u=!1,...d}=e,c=u?o.g7:"button";return(0,t.jsx)(c,{className:(0,i.cn)(a({variant:l,size:s,className:n})),ref:r,...d})});u.displayName="Button"},15671:function(e,r,n){"use strict";n.d(r,{Ol:function(){return i},SZ:function(){return u},Zb:function(){return s},aY:function(){return d},ll:function(){return a}});var t=n(57437),l=n(2265),o=n(22169);let s=l.forwardRef((e,r)=>{let{className:n,variant:l="default",...s}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("rounded-xl border bg-card text-card-foreground shadow-sm","glass"===l&&"glass backdrop-blur-md","gradient"===l&&"gradient-engineering text-white border-0","engineering"===l&&"border-engineering-blue/20 bg-gradient-to-br from-white to-engineering-blue/5 hover-lift",n),...s})});s.displayName="Card";let i=l.forwardRef((e,r)=>{let{className:n,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",n),...l})});i.displayName="CardHeader";let a=l.forwardRef((e,r)=>{let{className:n,...l}=e;return(0,t.jsx)("h3",{ref:r,className:(0,o.cn)("font-semibold leading-none tracking-tight",n),...l})});a.displayName="CardTitle";let u=l.forwardRef((e,r)=>{let{className:n,...l}=e;return(0,t.jsx)("p",{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",n),...l})});u.displayName="CardDescription";let d=l.forwardRef((e,r)=>{let{className:n,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("p-6 pt-0",n),...l})});d.displayName="CardContent",l.forwardRef((e,r)=>{let{className:n,...l}=e;return(0,t.jsx)("div",{ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",n),...l})}).displayName="CardFooter"},66210:function(e,r,n){"use strict";n.r(r),n.d(r,{AuthProvider:function(){return a},useAuth:function(){return i}});var t=n(57437),l=n(2265),o=n(14958);let s=(0,l.createContext)(void 0);function i(){let e=(0,l.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a(e){let{children:r}=e,[n,i]=(0,l.useState)(null),[a,u]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[g,h]=(0,l.useState)(null),[f,v]=(0,l.useState)(!0),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async()=>{try{var e,r,n;console.log("AuthProvider: 初期セッション取得開始");let{data:{session:t},error:l}=await o.OQ.auth.getSession();if(l){console.error("AuthProvider: セッション取得エラー:",l),v(!1);return}console.log("AuthProvider: セッション取得結果:",{hasSession:!!t,userId:null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id,hasAccessToken:!!(null==t?void 0:t.access_token),tokenLength:null==t?void 0:null===(r=t.access_token)||void 0===r?void 0:r.length}),i(null!==(n=null==t?void 0:t.user)&&void 0!==n?n:null),(null==t?void 0:t.user)&&(null==t?void 0:t.access_token)?(console.log("\uD83D\uDE80 AuthProvider: 初期セッション - ユーザープロフィール取得開始"),setTimeout(()=>{console.log("⏱️ setTimeout実行: fetchUserProfile呼び出し (初期セッション)"),x(t.user.id)},0)):console.log("AuthProvider: セッションまたはトークンなし、ローディング終了")}catch(e){console.error("AuthProvider: 初期化エラー:",e),i(null),u(null),c(null),h(null)}finally{v(!1)}})();let{data:{subscription:e}}=o.OQ.auth.onAuthStateChange(async(e,r)=>{var n,t;let l=new Date().toISOString();console.log("\uD83D\uDD04 [".concat(l,"] Auth state change:"),{event:e,userId:null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.id,hasToken:!!(null==r?void 0:r.access_token)}),i(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)&&"SIGNED_IN"===e?(console.log("\uD83D\uDD11 [".concat(l,"] Auth state change: SIGNED_IN, fetching profile")),setTimeout(()=>{console.log("⏱️ [".concat(l,"] setTimeout実行: fetchUserProfile呼び出し (SIGNED_IN)")),x(r.user.id)},0)):"SIGNED_OUT"===e&&(console.log("Auth state change: SIGNED_OUT, clearing profile"),u(null),c(null),h(null)),"INITIAL_SESSION"!==e&&v(!1)});return()=>e.unsubscribe()},[]);let x=async e=>{var r;let n=new Date().toISOString(),t=null===(r=Error().stack)||void 0===r?void 0:r.split("\n").slice(1,4).join(" -> ");if(console.log("\uD83D\uDD0D [".concat(n,"] fetchUserProfile: 開始"),{authUserId:e,fetchingRef:m.current,callStack:t}),m.current===e){console.log("⚠️ [".concat(n,"] fetchUserProfile: 既に実行中のためスキップ"),{authUserId:e});return}m.current=e,console.log("\uD83C\uDFC3 [".concat(n,"] fetchUserProfile: 実行開始"),{authUserId:e});try{console.log("fetchUserProfile: ユーザープロフィール取得開始");let{data:r,error:n}=await o.OQ.from("users").select("*").eq("auth_user_id",e).single();if(console.log("fetchUserProfile: ユーザープロフィール結果",{profile:null==r?void 0:r.id,error:null==n?void 0:n.message}),n&&"PGRST116"!==n.code){console.error("Error fetching user profile:",n);return}if(u(r),r){console.log("fetchUserProfile: メンバーシップ取得開始",{profileId:r.id});let{data:e,error:n}=await o.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(console.log("fetchUserProfile: メンバーシップ結果",{role:null==e?void 0:e.role,org_id:null==e?void 0:e.org_id,error:null==n?void 0:n.message}),n&&"PGRST116"!==n.code){console.error("Error fetching user role:",n);return}if(c((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:r,error:n}=await o.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();n?(console.error("Error fetching organization:",n),h(null)):h({id:r.id,name:r.name})}else h(null);console.log("fetchUserProfile: 完了",{role:null==e?void 0:e.role,organization:null==e?void 0:e.org_id})}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{m.current=null,console.log("✅ [".concat(n,"] fetchUserProfile: 実行完了"),{authUserId:e})}},b=async(e,r)=>{console.log("signIn: 開始",{email:e}),v(!0);try{var n;console.log("signIn: Supabase認証開始");let t=o.OQ.auth.signInWithPassword({email:e,password:r}),l=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:s,error:i}=await Promise.race([t,l]);if(console.log("signIn: Supabase認証結果",{data:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.id,error:null==i?void 0:i.message}),i)throw i;console.log("signIn: 認証成功"),(null==s?void 0:s.user)&&(console.log("signIn: ユーザープロフィール取得開始"),setTimeout(()=>{x(s.user.id)},50),console.log("signIn: ユーザープロフィール取得完了"))}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{console.log("signIn: 終了"),v(!1)}},p=async(e,r,n)=>{v(!0);try{let{data:t,error:l}=await o.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:n.display_name,specialties:n.specialties||[],qualifications:n.qualifications||[]}}});if(l)throw l;if(t.user){let{error:e}=await o.OQ.from("users").insert({auth_user_id:t.user.id,email:t.user.email,display_name:n.display_name||"",specialties:n.specialties||[],qualifications:n.qualifications||[],experience_years:n.experience_years});e&&console.error("Error creating user profile:",e)}}finally{v(!1)}},y=async()=>{v(!0);try{let{error:e}=await o.OQ.auth.signOut();if(e)throw e;i(null),u(null),c(null)}finally{v(!1)}},j=async e=>{if(!a)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{console.log("updateProfile: 更新開始",{userId:a.id,updates:e});let{data:r,error:n}=await o.OQ.from("users").update(e).eq("id",a.id).select().single();if(n)throw console.error("updateProfile: Supabaseエラー",n),n;console.log("updateProfile: 更新成功",r),u({...a,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,t.jsx)(s.Provider,{value:{user:n,userProfile:a,userRole:d,userOrganization:g,loading:f,signIn:b,signUp:p,signOut:y,updateProfile:j,getRedirectPath:()=>{if(!d)return"/dashboard";switch(d){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:r})}},14958:function(e,r,n){"use strict";n.d(r,{OQ:function(){return l}});var t=n(37440);n(62601);let l=(0,t.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,r,n){"use strict";n.d(r,{XO:function(){return a},cn:function(){return o},xG:function(){return s},z2:function(){return i}});var t=n(57042),l=n(74769);function o(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return(0,l.m6)((0,t.W)(r))}function s(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function i(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function a(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}}},function(e){e.O(0,[14,440,971,938,744],function(){return e(e.s=22187)}),_N_E=e.O()}]);