(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{11981:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},68291:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},22812:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},13008:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},86264:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5589:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},1295:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(62898).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},46571:function(e,r,t){Promise.resolve().then(t.bind(t,10133))},10133:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return y}});var n=t(57437),s=t(2265),i=t(65251),l=t(24033),o=t(61396),a=t.n(o),c=t(13008),d=t(22812),u=t(68291),g=t(1295),h=t(5589),m=t(11981),f=t(86264),x=t(575),p=t(15671),v=t(66210);function y(){let[e,r]=(0,s.useState)(""),[t,o]=(0,s.useState)(""),[y,b]=(0,s.useState)(null),[w,j]=(0,s.useState)(null),[N,k]=(0,s.useState)(!1),{signIn:I,getRedirectPath:D,userRole:C,loading:P}=(0,v.useAuth)(),z=(0,l.useRouter)();(0,s.useEffect)(()=>{if(!P&&C&&w){console.log("Login page: 認証状態変更を検知",{userRole:C});let e=D();console.log("Login page: リダイレクト実行",{redirectPath:e});let r=sessionStorage.getItem("redirectAfterLogin");r&&"/auth/login"!==r?(console.log("Login page: 保存されたリダイレクト先を使用",{savedRedirect:r}),sessionStorage.removeItem("redirectAfterLogin"),z.push(r)):z.push(e)}},[C,P,w]);let S=async r=>{r.preventDefault(),b(null),j(null),k(!0);try{console.log("Login form: ログイン開始",{email:e});let r=I(e,t),n=new Promise((e,r)=>{setTimeout(()=>r(Error("ログイン処理がタイムアウトしました（60秒）")),6e4)});await Promise.race([r,n]),console.log("Login form: ログイン成功"),j("ログインに成功しました")}catch(e){console.error("Login form: ログインエラー",e),b(e.message||"ログインに失敗しました")}finally{console.log("Login form: ログイン処理終了"),k(!1)}},_=e=>{let t={admin:{email:"admin@demo.com",password:"demo123"},orgadmin:{email:"orgadmin@demo.com",password:"demo123"},contractor:{email:"contractor@demo.com",password:"demo123"},reviewer:{email:"reviewer@demo.com",password:"demo123"}};r(t[e].email),o(t[e].password)};return(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-8 items-center",children:[(0,n.jsx)(i.E.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.8},className:"hidden lg:block",children:(0,n.jsxs)("div",{className:"text-center lg:text-left",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 justify-center lg:justify-start mb-8",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white font-bold text-2xl",children:"土"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-engineering-blue",children:"土木設計業務プラットフォーム"}),(0,n.jsx)("p",{className:"text-lg text-gray-600",children:"Civil Engineering Platform"})]})]}),(0,n.jsxs)("div",{className:"space-y-6 mb-8",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)(c.Z,{className:"w-6 h-6 text-green-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900",children:"セキュアなファイル管理"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Box API連携によるVDR機能"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)(d.Z,{className:"w-6 h-6 text-blue-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900",children:"プロジェクト管理"}),(0,n.jsx)("p",{className:"text-gray-600",children:"発注から完了まで一元管理"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,n.jsx)(u.Z,{className:"w-6 h-6 text-purple-600"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900",children:"自動化ワークフロー"}),(0,n.jsx)("p",{className:"text-gray-600",children:"AI検査・評価・請求処理"})]})]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"デモアカウントでログイン:"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("admin"),className:"hover:border-red-500",children:"運営者デモ"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("orgadmin"),className:"hover:border-engineering-blue",children:"発注者デモ"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("contractor"),className:"hover:border-engineering-green",children:"受注者デモ"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("reviewer"),className:"hover:border-purple-500",children:"監督員デモ"})]})]})]})}),(0,n.jsxs)(i.E.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.8,delay:.2},children:[(0,n.jsxs)(p.Zb,{className:"w-full max-w-md mx-auto hover-lift",children:[(0,n.jsxs)(p.Ol,{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-engineering-blue rounded-lg flex items-center justify-center mx-auto mb-4 lg:hidden",children:(0,n.jsx)("span",{className:"text-white font-bold text-xl",children:"土"})}),(0,n.jsx)(p.ll,{className:"text-2xl font-bold text-gray-900",children:"ログイン"}),(0,n.jsx)(p.SZ,{children:"アカウントにサインインしてご利用ください"})]}),(0,n.jsx)(p.aY,{children:(0,n.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,n.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent transition-colors",placeholder:"example@company.com",required:!0})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(h.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,n.jsx)("input",{id:"password",type:"password",value:t,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent transition-colors",placeholder:"••••••••",required:!0})]})]}),y&&(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[(0,n.jsx)(m.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"text-sm",children:y})]}),w&&(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700",children:[(0,n.jsx)(c.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"text-sm",children:w})]}),(0,n.jsx)(x.z,{type:"submit",variant:"engineering",size:"lg",className:"w-full",disabled:N,children:N?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"ログイン中..."]}):(0,n.jsxs)(n.Fragment,{children:["ログイン",(0,n.jsx)(u.Z,{className:"w-4 h-4 ml-2"})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsx)(a(),{href:"/auth/forgot-password",className:"text-engineering-blue hover:underline",children:"パスワードを忘れた方"}),(0,n.jsx)(a(),{href:"/auth/signup",className:"text-engineering-blue hover:underline",children:"新規登録"})]})]})})]}),(0,n.jsxs)("div",{className:"mt-6 lg:hidden",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"デモアカウント:"}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-center gap-2",children:[(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("admin"),children:"運営者"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("orgadmin"),children:"発注者"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("contractor"),children:"受注者"}),(0,n.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>_("reviewer"),children:"監督員"})]})]})]})]})})}},575:function(e,r,t){"use strict";t.d(r,{z:function(){return c}});var n=t(57437),s=t(2265),i=t(54949),l=t(96061),o=t(22169);let a=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,r)=>{let{className:t,variant:s,size:l,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,n.jsx)(u,{className:(0,o.cn)(a({variant:s,size:l,className:t})),ref:r,...d})});c.displayName="Button"},15671:function(e,r,t){"use strict";t.d(r,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},ll:function(){return a}});var n=t(57437),s=t(2265),i=t(22169);let l=s.forwardRef((e,r)=>{let{className:t,variant:s="default",...l}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow-sm","glass"===s&&"glass backdrop-blur-md","gradient"===s&&"gradient-engineering text-white border-0","engineering"===s&&"border-engineering-blue/20 bg-gradient-to-br from-white to-engineering-blue/5 hover-lift",t),...l})});l.displayName="Card";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...s})});o.displayName="CardHeader";let a=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("h3",{ref:r,className:(0,i.cn)("font-semibold leading-none tracking-tight",t),...s})});a.displayName="CardTitle";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...s})});d.displayName="CardContent",s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,n.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...s})}).displayName="CardFooter"},66210:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return a},useAuth:function(){return o}});var n=t(57437),s=t(2265),i=t(14958);let l=(0,s.createContext)(void 0);function o(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a(e){let{children:r}=e,[t,o]=(0,s.useState)(null),[a,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{try{var e,r,t;console.log("AuthProvider: 初期セッション取得開始");let{data:{session:n},error:s}=await i.OQ.auth.getSession();if(s){console.error("AuthProvider: セッション取得エラー:",s),f(!1);return}console.log("AuthProvider: セッション取得結果:",{hasSession:!!n,userId:null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.id,hasAccessToken:!!(null==n?void 0:n.access_token),tokenLength:null==n?void 0:null===(r=n.access_token)||void 0===r?void 0:r.length}),o(null!==(t=null==n?void 0:n.user)&&void 0!==t?t:null),(null==n?void 0:n.user)&&(null==n?void 0:n.access_token)?(console.log("\uD83D\uDE80 AuthProvider: 初期セッション - ユーザープロフィール取得開始"),setTimeout(()=>{console.log("⏱️ setTimeout実行: fetchUserProfile呼び出し (初期セッション)"),p(n.user.id)},0)):console.log("AuthProvider: セッションまたはトークンなし、ローディング終了")}catch(e){console.error("AuthProvider: 初期化エラー:",e),o(null),c(null),u(null),h(null)}finally{f(!1)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,r)=>{var t,n;let s=new Date().toISOString();console.log("\uD83D\uDD04 [".concat(s,"] Auth state change:"),{event:e,userId:null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id,hasToken:!!(null==r?void 0:r.access_token)}),o(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),(null==r?void 0:r.user)&&"SIGNED_IN"===e?(console.log("\uD83D\uDD11 [".concat(s,"] Auth state change: SIGNED_IN, fetching profile")),setTimeout(()=>{console.log("⏱️ [".concat(s,"] setTimeout実行: fetchUserProfile呼び出し (SIGNED_IN)")),p(r.user.id)},0)):"SIGNED_OUT"===e&&(console.log("Auth state change: SIGNED_OUT, clearing profile"),c(null),u(null),h(null)),"INITIAL_SESSION"!==e&&f(!1)});return()=>e.unsubscribe()},[]);let p=async e=>{var r;let t=new Date().toISOString(),n=null===(r=Error().stack)||void 0===r?void 0:r.split("\n").slice(1,4).join(" -> ");if(console.log("\uD83D\uDD0D [".concat(t,"] fetchUserProfile: 開始"),{authUserId:e,fetchingRef:x.current,callStack:n}),x.current===e){console.log("⚠️ [".concat(t,"] fetchUserProfile: 既に実行中のためスキップ"),{authUserId:e});return}x.current=e,console.log("\uD83C\uDFC3 [".concat(t,"] fetchUserProfile: 実行開始"),{authUserId:e});try{console.log("fetchUserProfile: ユーザープロフィール取得開始");let{data:r,error:t}=await i.OQ.from("users").select("*").eq("auth_user_id",e).single();if(console.log("fetchUserProfile: ユーザープロフィール結果",{profile:null==r?void 0:r.id,error:null==t?void 0:t.message}),t&&"PGRST116"!==t.code){console.error("Error fetching user profile:",t);return}if(c(r),r){console.log("fetchUserProfile: メンバーシップ取得開始",{profileId:r.id});let{data:e,error:t}=await i.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(console.log("fetchUserProfile: メンバーシップ結果",{role:null==e?void 0:e.role,org_id:null==e?void 0:e.org_id,error:null==t?void 0:t.message}),t&&"PGRST116"!==t.code){console.error("Error fetching user role:",t);return}if(u((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:r,error:t}=await i.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();t?(console.error("Error fetching organization:",t),h(null)):h({id:r.id,name:r.name})}else h(null);console.log("fetchUserProfile: 完了",{role:null==e?void 0:e.role,organization:null==e?void 0:e.org_id})}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{x.current=null,console.log("✅ [".concat(t,"] fetchUserProfile: 実行完了"),{authUserId:e})}},v=async(e,r)=>{console.log("signIn: 開始",{email:e}),f(!0);try{var t;console.log("signIn: Supabase認証開始");let n=i.OQ.auth.signInWithPassword({email:e,password:r}),s=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:l,error:o}=await Promise.race([n,s]);if(console.log("signIn: Supabase認証結果",{data:null==l?void 0:null===(t=l.user)||void 0===t?void 0:t.id,error:null==o?void 0:o.message}),o)throw o;console.log("signIn: 認証成功"),(null==l?void 0:l.user)&&(console.log("signIn: ユーザープロフィール取得開始"),setTimeout(()=>{p(l.user.id)},50),console.log("signIn: ユーザープロフィール取得完了"))}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{console.log("signIn: 終了"),f(!1)}},y=async(e,r,t)=>{f(!0);try{let{data:n,error:s}=await i.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:t.display_name,specialties:t.specialties||[],qualifications:t.qualifications||[]}}});if(s)throw s;if(n.user){let{error:e}=await i.OQ.from("users").insert({auth_user_id:n.user.id,email:n.user.email,display_name:t.display_name||"",specialties:t.specialties||[],qualifications:t.qualifications||[],experience_years:t.experience_years});e&&console.error("Error creating user profile:",e)}}finally{f(!1)}},b=async()=>{f(!0);try{let{error:e}=await i.OQ.auth.signOut();if(e)throw e;o(null),c(null),u(null)}finally{f(!1)}},w=async e=>{if(!a)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{console.log("updateProfile: 更新開始",{userId:a.id,updates:e});let{data:r,error:t}=await i.OQ.from("users").update(e).eq("id",a.id).select().single();if(t)throw console.error("updateProfile: Supabaseエラー",t),t;console.log("updateProfile: 更新成功",r),c({...a,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,n.jsx)(l.Provider,{value:{user:t,userProfile:a,userRole:d,userOrganization:g,loading:m,signIn:v,signUp:y,signOut:b,updateProfile:w,getRedirectPath:()=>{if(!d)return"/dashboard";switch(d){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:r})}},14958:function(e,r,t){"use strict";t.d(r,{OQ:function(){return s}});var n=t(37440);t(62601);let s=(0,n.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,r,t){"use strict";t.d(r,{XO:function(){return a},cn:function(){return i},xG:function(){return l},z2:function(){return o}});var n=t(57042),s=t(74769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}function l(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function o(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function a(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}},61396:function(e,r,t){e.exports=t(25250)},24033:function(e,r,t){e.exports=t(15313)}},function(e){e.O(0,[14,402,440,250,971,938,744],function(){return e(e.s=46571)}),_N_E=e.O()}]);