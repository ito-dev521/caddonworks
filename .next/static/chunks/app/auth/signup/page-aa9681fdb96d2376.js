(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{9883:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,s(62898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},82549:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,s(62898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},35917:function(e,r,s){Promise.resolve().then(s.bind(s,9971))},9971:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return I}});var t=s(57437),a=s(2265),i=s(65251),n=s(24033),l=s(61396),o=s.n(l),c=s(1295),d=s(67972),u=s(5589),m=s(77216),g=s(99670),x=s(22812),h=s(9883),p=s(82549),f=s(11981),b=s(13008),y=s(86264),v=s(68291),j=s(575),N=s(15671),w=s(33277),_=s(49430),C=s(66210);function I(){let[e,r]=(0,a.useState)({email:"",password:"",confirmPassword:"",displayName:"",organization:"",specialties:[],qualifications:[],experienceYears:""}),[s,l]=(0,a.useState)(!1),[I,S]=(0,a.useState)(null),[k,Z]=(0,a.useState)(null),[q,P]=(0,a.useState)(!1),[E,O]=(0,a.useState)(1),{signUp:z}=(0,C.useAuth)(),A=(0,n.useRouter)(),Q=(e,s)=>{r(r=>({...r,[e]:s}))},M=s=>{e.specialties.includes(s)||r(e=>({...e,specialties:[...e.specialties,s]}))},T=e=>{r(r=>({...r,specialties:r.specialties.filter(r=>r!==e)}))},J=s=>{e.qualifications.includes(s)||r(e=>({...e,qualifications:[...e.qualifications,s]}))},R=e=>{r(r=>({...r,qualifications:r.qualifications.filter(r=>r!==e)}))},Y=()=>e.email&&e.password&&e.confirmPassword&&e.displayName?e.password!==e.confirmPassword?(S("パスワードが一致しません"),!1):e.password.length<6?(S("パスワードは6文字以上で入力してください"),!1):(S(null),!0):(S("必須項目を入力してください"),!1),F=async r=>{if(r.preventDefault(),1===E){Y()&&O(2);return}S(null),Z(null),P(!0);try{await z(e.email,e.password,{display_name:e.displayName,specialties:e.specialties,qualifications:e.qualifications,experience_years:e.experienceYears||void 0}),Z("アカウントを作成しました。確認メールをご確認ください。"),setTimeout(()=>{A.push("/auth/login")},3e3)}catch(e){S(e.message||"アカウント作成に失敗しました")}finally{P(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"w-full max-w-4xl",children:(0,t.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},children:(0,t.jsxs)(N.Zb,{className:"hover-lift",children:[(0,t.jsxs)(N.Ol,{className:"text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-engineering-blue rounded-lg flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("span",{className:"text-white font-bold text-xl",children:"土"})}),(0,t.jsx)(N.ll,{className:"text-2xl font-bold text-gray-900",children:"アカウント作成"}),(0,t.jsx)(N.SZ,{children:"土木設計業務プラットフォームへようこそ"})]}),(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(E>=1?"bg-engineering-blue text-white":"bg-gray-200 text-gray-600"),children:"1"}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm font-medium ".concat(E>=1?"text-gray-900":"text-gray-500"),children:"基本情報"})})]}),(0,t.jsx)("div",{className:"w-12 h-0.5 mx-4 ".concat(E>=2?"bg-engineering-blue":"bg-gray-200")}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(E>=2?"bg-engineering-blue text-white":"bg-gray-200 text-gray-600"),children:"2"}),(0,t.jsx)("div",{className:"ml-3",children:(0,t.jsx)("p",{className:"text-sm font-medium ".concat(E>=2?"text-gray-900":"text-gray-500"),children:"専門情報"})})]})]})}),(0,t.jsx)(N.aY,{className:"p-8",children:(0,t.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[1===E&&(0,t.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"メールアドレス *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,t.jsx)("input",{type:"email",value:e.email,onChange:e=>Q("email",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"example@company.com",required:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"表示名 *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,t.jsx)("input",{type:"text",value:e.displayName,onChange:e=>Q("displayName",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"田中 太郎",required:!0})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(_.Z,{value:e.password,onChange:e=>Q("password",e),label:"パスワード *",placeholder:"••••••••",required:!0,showStrengthIndicator:!0}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード確認 *"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,t.jsx)("input",{type:s?"text":"password",value:e.confirmPassword,onChange:e=>Q("confirmPassword",e.target.value),className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"••••••••",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>l(!s),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:s?(0,t.jsx)(m.Z,{className:"w-5 h-5"}):(0,t.jsx)(g.Z,{className:"w-5 h-5"})})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"屋号及び所属組織"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,t.jsx)("input",{type:"text",value:e.organization,onChange:e=>Q("organization",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"株式会社 土木設計"})]})]})]}),2===E&&(0,t.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"専門分野"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mb-3",children:["未経験","道路設計","橋梁設計","河川工事","上下水道設計","トンネル設計","地下構造","構造物点検","測量業務","地質調査","環境評価","施工管理"].map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>M(e),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:border-engineering-blue hover:bg-engineering-blue/5 transition-colors",children:[(0,t.jsx)(h.Z,{className:"w-3 h-3 inline mr-1"}),e]},e))}),e.specialties.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.specialties.map(e=>(0,t.jsxs)(w.C,{variant:"engineering",className:"cursor-pointer",onClick:()=>T(e),children:[e,(0,t.jsx)(p.Z,{className:"w-3 h-3 ml-1"})]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"資格・免許"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-3",children:["技術士（建設部門）","技術士（上下水道部門）","技術士（その他）","技術士補","一級建築士","測量士","土木施工管理技士","管工事施工管理技士","造園施工管理技士","土地家屋調査士"].map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>J(e),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:border-engineering-blue hover:bg-engineering-blue/5 transition-colors text-left",children:[(0,t.jsx)(h.Z,{className:"w-3 h-3 inline mr-1"}),e]},e))}),e.qualifications.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.qualifications.map(e=>(0,t.jsxs)(w.C,{variant:"success",className:"cursor-pointer",onClick:()=>R(e),children:[e,(0,t.jsx)(p.Z,{className:"w-3 h-3 ml-1"})]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経験年数 ",e.specialties.some(e=>"未経験"!==e)&&"*"]}),(0,t.jsx)("input",{type:"number",min:"0",max:"50",value:e.experienceYears,onChange:e=>Q("experienceYears",e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"5",required:e.specialties.some(e=>"未経験"!==e)}),e.specialties.some(e=>"未経験"!==e)&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"未経験以外の専門分野を選択した場合は必須です"})]})]}),I&&(0,t.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[(0,t.jsx)(f.Z,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm",children:I})]}),k&&(0,t.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700",children:[(0,t.jsx)(b.Z,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm",children:k})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[2===E&&(0,t.jsx)(j.z,{type:"button",variant:"outline",onClick:()=>O(1),children:"戻る"}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(j.z,{type:"submit",variant:"engineering",size:"lg",disabled:q,children:q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"作成中..."]}):1===E?(0,t.jsxs)(t.Fragment,{children:["次へ",(0,t.jsx)(v.Z,{className:"w-4 h-4 ml-2"})]}):(0,t.jsxs)(t.Fragment,{children:["アカウント作成",(0,t.jsx)(b.Z,{className:"w-4 h-4 ml-2"})]})})})]}),(0,t.jsxs)("div",{className:"text-center text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"すでにアカウントをお持ちですか？"}),(0,t.jsx)(o(),{href:"/auth/login",className:"text-engineering-blue hover:underline ml-1",children:"ログイン"})]})]})})]})})})})}},33277:function(e,r,s){"use strict";s.d(r,{C:function(){return l}});var t=s(57437);s(2265);var a=s(96061),i=s(22169);let n=(0,a.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600",engineering:"border-engineering-blue bg-engineering-blue/10 text-engineering-blue",glass:"glass text-gray-700 border-white/30"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:s,...a}=e;return(0,t.jsx)("div",{className:(0,i.cn)(n({variant:s}),r),...a})}},66210:function(e,r,s){"use strict";s.r(r),s.d(r,{AuthProvider:function(){return o},useAuth:function(){return l}});var t=s(57437),a=s(2265),i=s(14958);let n=(0,a.createContext)(void 0);function l(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function o(e){let{children:r}=e,[s,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,g]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0),p=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{try{var e;let{data:{session:r},error:s}=await i.OQ.auth.getSession();if(s){console.error("AuthProvider: セッション取得エラー:",s),h(!1);return}l(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&(null==r?void 0:r.access_token)?setTimeout(()=>{f(r.user.id)},0):h(!1)}catch(e){console.error("AuthProvider: 初期化エラー:",e),l(null),c(null),u(null),g(null),h(!1)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,r)=>{var s;l(null!==(s=null==r?void 0:r.user)&&void 0!==s?s:null),(null==r?void 0:r.user)&&"SIGNED_IN"===e?setTimeout(()=>{f(r.user.id)},0):"SIGNED_OUT"===e&&(c(null),u(null),g(null)),"INITIAL_SESSION"!==e&&h(!1)});return()=>e.unsubscribe()},[]);let f=async e=>{if(p.current!==e){p.current=e;try{let{data:r,error:s}=await i.OQ.from("users").select("*").eq("auth_user_id",e).single();if(s&&"PGRST116"!==s.code){console.error("Error fetching user profile:",s);return}if(c(r),r){let{data:e,error:s}=await i.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(s&&"PGRST116"!==s.code){console.error("Error fetching user role:",s);return}if(u((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:r,error:s}=await i.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();s?(console.error("Error fetching organization:",s),g(null)):g({id:r.id,name:r.name})}else g(null)}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{p.current=null,h(!1)}}},b=async(e,r)=>{h(!0);try{let s=i.OQ.auth.signInWithPassword({email:e,password:r}),t=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:a,error:n}=await Promise.race([s,t]);if(n)throw n;(null==a?void 0:a.user)&&setTimeout(()=>{f(a.user.id)},50)}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{h(!1)}},y=async(e,r,s)=>{h(!0);try{let{data:t,error:a}=await i.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:s.display_name,specialties:s.specialties||[],qualifications:s.qualifications||[]}}});if(a)throw a;if(t.user){let{error:e}=await i.OQ.from("users").insert({auth_user_id:t.user.id,email:t.user.email,display_name:s.display_name||"",specialties:s.specialties||[],qualifications:s.qualifications||[],experience_years:s.experience_years});e&&console.error("Error creating user profile:",e)}}finally{h(!1)}},v=async()=>{h(!0);try{let{error:e}=await i.OQ.auth.signOut();if(e)throw e;l(null),c(null),u(null)}finally{h(!1)}},j=async e=>{if(!o)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{let{data:r,error:s}=await i.OQ.from("users").update(e).eq("id",o.id).select().single();if(s)throw console.error("updateProfile: Supabaseエラー",s),s;c({...o,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,t.jsx)(n.Provider,{value:{user:s,userProfile:o,userRole:d,userOrganization:m,loading:x,signIn:b,signUp:y,signOut:v,updateProfile:j,getRedirectPath:()=>{if(!d)return"/dashboard";switch(d){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:r})}},14958:function(e,r,s){"use strict";s.d(r,{OQ:function(){return a}});var t=s(37440);s(62601);let a=(0,t.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")}},function(e){e.O(0,[778,402,440,250,980,971,938,744],function(){return e(e.s=35917)}),_N_E=e.O()}]);