(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[895],{22812:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},28203:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},13008:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6141:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},41298:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},99670:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},28734:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]])},42482:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},86264:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2882:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},53714:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]])},49617:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},9883:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},41827:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},45367:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},31541:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(62898).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},91897:function(e,t,a){Promise.resolve().then(a.bind(a,64380))},64380:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return T}});var r=a(57437),s=a(2265),n=a(65251),i=a(62167),l=a(22812),c=a(9883),o=a(41827),d=a(42482),u=a(6141),x=a(41298),m=a(28203),g=a(67972),h=a(99670),p=a(49617),f=a(45367),y=a(53714),b=a(62898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let j=(0,b.Z)("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);var v=a(13008);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let N=(0,b.Z)("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]);var w=a(2882),k=a(31541),_=a(28734),C=a(82549),Z=a(13332),S=a(15671),z=a(14440),q=a(33277),A=a(575),P=a(66210),O=a(14958),E=a(7403),M=a(14374);function D(){var e,t;let{userProfile:a,userRole:b,loading:E}=(0,P.useAuth)(),[D,T]=(0,s.useState)([]),[L,I]=(0,s.useState)([]),[B,R]=(0,s.useState)("active"),[$,F]=(0,s.useState)(""),[J,Q]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(null),[U,V]=(0,s.useState)(!0),[G,W]=(0,s.useState)({title:"",description:"",budget:"",start_date:"",end_date:"",bidding_deadline:"",category:"",contractor_id:"",assignee_name:"",required_contractors:1,required_level:"beginner"}),[K,X]=(0,s.useState)(!1),[ee,et]=(0,s.useState)([]),[ea,er]=(0,s.useState)(""),[es,en]=(0,s.useState)(!1),[ei,el]=(0,s.useState)(!1),[ec,eo]=(0,s.useState)(null),[ed,eu]=(0,s.useState)(null),[ex,em]=(0,s.useState)(null),[eg,eh]=(0,s.useState)([]),[ep,ef]=(0,s.useState)(!1),[ey,eb]=(0,s.useState)(!1),ej=(0,s.useRef)(null),ev=e=>e.replace(/[^\d]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,","),eN=e=>parseInt(e.replace(/[^\d]/g,""),10)||0,ew=(0,s.useCallback)(async()=>{try{V(!0);let{data:{session:t}}=await O.OQ.auth.getSession();if(!t){console.error("セッションが見つかりません"),V(!1);return}console.log("fetchProjects: APIリクエスト開始");let a=await fetch("/api/projects",{method:"GET",headers:{Authorization:"Bearer ".concat(t.access_token)}});console.log("fetchProjects: APIレスポンス",a.status,a.statusText);let r=await a.json();if(console.log("fetchProjects: API結果",r),a.ok){var e;console.log("fetchProjects: 成功, 案件数:",(null===(e=r.projects)||void 0===e?void 0:e.length)||0),T(r.projects||[]),I(r.projects||[])}else console.error("fetchProjects: 案件データの取得に失敗:",r.message),T([]),I([])}catch(e){console.error("データ取得エラー:",e),T([]),I([])}finally{V(!1)}},[]);(0,s.useEffect)(()=>{if(!a||"OrgAdmin"!==b){V(!1);return}let e="".concat(a.id,":").concat(b);ej.current!==e&&(ej.current=e,ew())},[a,b,ew]),(0,s.useEffect)(()=>{let e=D;"active"===B?e=e.filter(e=>"in_progress"===e.status||"bidding"===e.status):"completed"===B&&(e=e.filter(e=>"completed"===e.status||"cancelled"===e.status)),$&&(e=e.filter(e=>e.title.toLowerCase().includes($.toLowerCase())||e.contractor_name.toLowerCase().includes($.toLowerCase())||e.category.toLowerCase().includes($.toLowerCase()))),I(e)},[D,B,$]);let ek=async e=>{e.preventDefault(),X(!0);try{let{data:{session:e}}=await O.OQ.auth.getSession();if(!e){alert("ログインが必要です");return}let t=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({...G,budget:eN(G.budget)})}),a=await t.json();t.ok?(alert("案件が正常に作成されました"),Q(!1),W({title:"",description:"",budget:"",start_date:"",end_date:"",bidding_deadline:"",category:"",contractor_id:"",assignee_name:"",required_contractors:1,required_level:"beginner"}),await ew()):alert("案件の作成に失敗しました: "+a.message)}catch(e){console.error("案件作成エラー:",e),alert("ネットワークエラーが発生しました")}finally{X(!1)}},e_=async e=>{en(!0);try{let{data:{session:t}}=await O.OQ.auth.getSession();if(!t){alert("ログインが必要です");return}let a=await fetch("/api/chat?project_id=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t.access_token)}}),r=await a.json();a.ok?et(r.messages):(console.error("メッセージ取得エラー:",r.message),et([]))}catch(e){console.error("メッセージ取得エラー:",e),et([])}finally{en(!1)}},eC=async e=>{if(ea.trim()){el(!0);try{let{data:{session:t}}=await O.OQ.auth.getSession();if(!t){alert("ログインが必要です");return}let a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({project_id:e,message:ea,sender_type:"client"})}),r=await a.json();a.ok?(er(""),await e_(e)):alert("メッセージの送信に失敗しました: "+r.message)}catch(e){console.error("メッセージ送信エラー:",e),alert("ネットワークエラーが発生しました")}finally{el(!1)}}},eZ=e=>{H(e),e_(e)},eS=e=>{D.find(t=>t.id===e)&&eo(e)},ez=e=>{let t=D.find(t=>t.id===e);t&&eu(t)},eq=async e=>{if(e.preventDefault(),ed){X(!0);try{let{data:{session:e}}=await O.OQ.auth.getSession();if(!e){alert("ログインが必要です");return}let t=await fetch("/api/projects/".concat(ed.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({title:ed.title,description:ed.description,budget:ed.budget,start_date:ed.start_date,end_date:ed.end_date,category:ed.category,required_contractors:ed.required_contractors,required_level:ed.required_level,assignee_name:ed.assignee_name})}),a=await t.json();t.ok?(alert("案件が正常に更新されました"),eu(null),await ew()):alert("案件の更新に失敗しました: "+a.message)}catch(e){console.error("案件更新エラー:",e),alert("ネットワークエラーが発生しました")}finally{X(!1)}}},eA=async e=>{if(confirm("この案件を削除してもよろしいですか？"))try{let{data:{session:t}}=await O.OQ.auth.getSession();if(!t){alert("ログインが必要です");return}let a=await fetch("/api/projects/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t.access_token)}}),r=await a.json();a.ok?(alert("案件が削除されました"),await ew()):alert("案件の削除に失敗しました: "+r.message)}catch(e){console.error("案件削除エラー:",e),alert("ネットワークエラーが発生しました")}},eP=async(e,t)=>{let a={bidding:"入札受付中",in_progress:"進行中",completed:"完了",cancelled:"キャンセル"};if(confirm("この案件のステータスを「".concat(a[t],"」に変更してもよろしいですか？")))try{let{data:{session:r}}=await O.OQ.auth.getSession();if(!r){alert("ログインが必要です");return}let s=D.find(t=>t.id===e);if(!s){alert("案件が見つかりません");return}let n=await fetch("/api/projects/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r.access_token)},body:JSON.stringify({title:s.title,description:s.description,budget:s.budget,start_date:s.start_date,end_date:s.end_date,category:s.category,required_contractors:s.required_contractors,status:t})}),i=await n.json();n.ok?(alert("案件のステータスが「".concat(a[t],"」に変更されました")),await ew(),"completed"===t&&await eO(e)):alert("ステータスの変更に失敗しました: "+i.message)}catch(e){console.error("ステータス変更エラー:",e),alert("ネットワークエラーが発生しました")}},eO=async e=>{try{let{data:{session:t}}=await O.OQ.auth.getSession();if(!t)return;(await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({project_id:e,type:"completion"})})).ok&&console.log("請求書が作成されました")}catch(e){console.error("請求書作成エラー:",e)}},eE=async e=>{ef(!0);try{let{data:{session:t}}=await O.OQ.auth.getSession();if(!t){alert("ログインが必要です");return}let a=await fetch("/api/projects/".concat(e,"/attachments"),{method:"GET",headers:{Authorization:"Bearer ".concat(t.access_token)}}),r=await a.json();a.ok?eh(r.attachments):(console.error("添付資料取得エラー:",r.message),eh([]))}catch(e){console.error("添付資料取得エラー:",e),eh([])}finally{ef(!1)}},eM=async(e,t)=>{eb(!0),console.log("=== フロントエンド: ファイルアップロード開始 ===",{projectId:e,fileName:t.name,fileSize:t.size,fileType:t.type,timestamp:new Date().toISOString()});try{var a;console.log("セッション取得開始");let{data:{session:r}}=await O.OQ.auth.getSession();if(!r){console.error("セッションがありません"),alert("ログインが必要です");return}console.log("セッション取得成功:",{hasAccessToken:!!r.access_token,tokenLength:null===(a=r.access_token)||void 0===a?void 0:a.length}),console.log("FormData作成開始");let s=new FormData;s.append("file",t),console.log("FormData作成完了"),console.log("APIリクエスト送信開始:",{url:"/api/projects/".concat(e,"/attachments"),method:"POST",hasAuthHeader:!!r.access_token});let n=new AbortController,i=setTimeout(()=>{console.error("リクエストタイムアウト（5分）"),n.abort()},3e5),l=await fetch("/api/projects/".concat(e,"/attachments"),{method:"POST",headers:{Authorization:"Bearer ".concat(r.access_token)},body:s,signal:n.signal});clearTimeout(i),console.log("=== フロントエンド: APIレスポンス受信 ===",{status:l.status,statusText:l.statusText,headers:Object.fromEntries(l.headers.entries())}),console.log("レスポンスJSON解析開始");let c=await l.json();if(console.log("=== フロントエンド: APIレスポンス解析完了 ===",c),l.ok)alert("ファイルが正常にアップロードされました"),await eE(e);else{console.error("ファイルアップロードエラー:",c);let e="ファイルのアップロードに失敗しました";c.message&&(e+=": "+c.message),c.details&&(e+="\n詳細: "+c.details),c.duration&&(e+="\n処理時間: ".concat(c.duration)),alert(e)}}catch(e){console.error("=== フロントエンド: ファイルアップロードエラー ===",{error:e,errorName:e instanceof Error?e.name:"Unknown",errorMessage:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()}),e instanceof Error&&"AbortError"===e.name?alert("ファイルアップロードがタイムアウトしました（5分）"):e instanceof Error&&e.message.includes("fetch")?alert("ネットワークエラーが発生しました。サーバーが起動しているか確認してください。"):alert("エラーが発生しました: "+(e instanceof Error?e.message:"Unknown error"))}finally{eb(!1),console.log("=== フロントエンド: ファイルアップロード処理完了 ===",{timestamp:new Date().toISOString()})}},eD=async(e,t)=>{if(confirm("この添付資料を削除してもよろしいですか？"))try{let{data:{session:a}}=await O.OQ.auth.getSession();if(!a){alert("ログインが必要です");return}let r=await fetch("/api/projects/".concat(e,"/attachments/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a.access_token)}}),s=await r.json();r.ok?(alert("添付資料が削除されました"),await eE(e)):alert("添付資料の削除に失敗しました: "+s.message)}catch(e){console.error("添付資料削除エラー:",e),alert("ネットワークエラーが発生しました")}},eT=e=>{em(e),eE(e)},eL=e=>{switch(e){case"bidding":return"text-blue-600 bg-blue-100";case"in_progress":return"text-green-600 bg-green-100";case"completed":default:return"text-gray-600 bg-gray-100";case"cancelled":return"text-red-600 bg-red-100"}},eI=e=>{switch(e){case"bidding":return"入札中";case"in_progress":return"進行中";case"completed":return"完了";case"cancelled":return"キャンセル";default:return e}};return E||U?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):"OrgAdmin"!==b?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,r.jsx)(S.Zb,{className:"w-full max-w-md",children:(0,r.jsxs)(S.aY,{className:"p-6 text-center",children:[(0,r.jsx)(l.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),(0,r.jsx)("p",{className:"text-gray-600",children:"このページは発注者（組織管理者）のみアクセス可能です。"})]})})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-mesh",children:[(0,r.jsx)(Z.W,{}),(0,r.jsxs)("div",{className:"md:ml-64 transition-all duration-300",children:[(0,r.jsx)(n.E.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-30",children:(0,r.jsx)("div",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,r.jsx)(l.Z,{className:"w-6 h-6 text-engineering-blue"}),"案件管理"]}),(0,r.jsx)("p",{className:"text-gray-600",children:"新規案件登録と過去案件の管理"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)(A.z,{variant:"engineering",onClick:()=>Q(!0),children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"新規案件登録"]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"総案件数"}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:[D.length,"件"]})]})]})]})})}),(0,r.jsxs)("main",{className:"px-6 py-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[(0,r.jsx)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"active",label:"進行中",count:D.filter(e=>"in_progress"===e.status||"bidding"===e.status).length},{id:"completed",label:"完了済み",count:D.filter(e=>"completed"===e.status||"cancelled"===e.status).length},{id:"all",label:"すべて",count:D.length}].map(e=>(0,r.jsxs)("button",{onClick:()=>R(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(B===e.id?"bg-white text-engineering-blue shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.label,(0,r.jsx)(q.C,{variant:"outline",className:"text-xs",children:e.count})]},e.id))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,r.jsx)("input",{type:"text",placeholder:"案件名・受注者で検索...",value:$,onChange:e=>F(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent w-64"})]}),(0,r.jsxs)(A.z,{variant:"outline",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"フィルター"]})]})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:(0,r.jsx)(i.M,{children:L.map((e,t)=>(0,r.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.1*t},children:(0,r.jsxs)(S.Zb,{className:"hover-lift cursor-pointer group",children:[(0,r.jsx)(S.Ol,{className:"pb-3",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(S.ll,{className:"text-lg text-gray-900 group-hover:text-engineering-blue transition-colors",children:e.title}),(0,r.jsxs)(S.SZ,{className:"mt-1",children:[e.contractor_name," • ",e.category]})]}),(0,r.jsx)(q.C,{className:eL(e.status),children:eI(e.status)})]})}),(0,r.jsxs)(S.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"進捗"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[e.progress,"%"]})]}),(0,r.jsx)(z.E,{value:e.progress,variant:"engineering",className:"mb-3"})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[e.bidding_deadline&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-orange-600 font-medium",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),"入札締切: ",new Date(e.bidding_deadline).toLocaleDateString("ja-JP")]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4"}),e.budget?e.budget.toLocaleString("ja-JP"):"未設定","円"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4"}),"納期: ",new Date(e.end_date).toLocaleDateString("ja-JP")]}),e.required_contractors&&e.required_contractors>1&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4"}),"募集人数: ",e.required_contractors,"名"]}),e.required_level&&(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)(q.C,{className:M.DY[e.required_level].color,children:["必要レベル: ",M.DY[e.required_level].label]})})]}),(0,r.jsxs)("div",{className:"pt-3 border-t border-gray-100 space-y-3",children:[e.assignee_name&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"w-4 h-4 text-green-600"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"担当者"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.assignee_name})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-engineering-blue/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"w-4 h-4 text-engineering-blue"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"受注者"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.contractor_name}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:e.contractor_email})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["案件ID: ",e.id.slice(0,8).toUpperCase()]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eS(e.id),children:(0,r.jsx)(h.Z,{className:"w-4 h-4"})}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>ez(e.id),children:(0,r.jsx)(p.Z,{className:"w-4 h-4"})}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eA(e.id),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(f.Z,{className:"w-4 h-4"})}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eT(e.id),children:(0,r.jsx)(y.Z,{className:"w-4 h-4"})}),"bidding"===e.status&&(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eP(e.id,"in_progress"),className:"text-blue-600 hover:text-blue-700",children:(0,r.jsx)(j,{className:"w-4 h-4"})}),"in_progress"===e.status&&(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eP(e.id,"completed"),className:"text-green-600 hover:text-green-700",children:(0,r.jsx)(v.Z,{className:"w-4 h-4"})}),("bidding"===e.status||"in_progress"===e.status)&&(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>eP(e.id,"cancelled"),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(N,{className:"w-4 h-4"})}),("in_progress"===e.status||"bidding"===e.status)&&(0,r.jsxs)(A.z,{variant:"engineering",size:"sm",onClick:()=>eZ(e.id),children:[(0,r.jsx)(w.Z,{className:"w-4 h-4 mr-1"}),"チャット"]})]})]})]})]})},e.id))})}),0===L.length&&(0,r.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[(0,r.jsx)(l.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"案件が見つかりません"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:$?"検索条件に一致する案件がありません。":"まだ案件が登録されていません。"}),(0,r.jsxs)(A.z,{variant:"engineering",onClick:()=>Q(!0),children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"新規案件登録"]})]})]})]}),(0,r.jsx)(i.M,{children:J&&(0,r.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsx)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)(S.Zb,{children:[(0,r.jsxs)(S.Ol,{children:[(0,r.jsxs)(S.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-5 h-5 text-engineering-blue"}),"新規案件登録"]}),(0,r.jsx)(S.SZ,{children:"新しい案件の詳細を入力してください"})]}),(0,r.jsx)(S.aY,{children:(0,r.jsxs)("form",{onSubmit:ek,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"案件名 *"}),(0,r.jsx)("input",{type:"text",value:G.title,onChange:e=>W({...G,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリ *"}),(0,r.jsxs)("select",{value:G.category,onChange:e=>W({...G,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),(0,r.jsx)("option",{value:"道路設計",children:"道路設計"}),(0,r.jsx)("option",{value:"橋梁設計",children:"橋梁設計"}),(0,r.jsx)("option",{value:"河川工事",children:"河川工事"}),(0,r.jsx)("option",{value:"構造物点検",children:"構造物点検"}),(0,r.jsx)("option",{value:"地下構造",children:"地下構造"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"案件説明 *"}),(0,r.jsx)("textarea",{value:G.description,onChange:e=>W({...G,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"予算 * (円)"}),(0,r.jsx)("input",{type:"text",value:G.budget,onChange:e=>{let t=ev(e.target.value);W({...G,budget:t})},placeholder:"例: 10,000",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"募集人数 *"}),(0,r.jsx)("select",{value:G.required_contractors,onChange:e=>W({...G,required_contractors:Number(e.target.value)}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0,children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,r.jsxs)("option",{value:e,children:[e,"名"]},e))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"必要な会員レベル *"}),(0,r.jsx)("select",{value:G.required_level,onChange:e=>W({...G,required_level:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0,children:Object.values(M.DY).map(e=>(0,r.jsxs)("option",{value:e.level,children:[e.label," - ",e.description]},e.level))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"開始日 *"}),(0,r.jsx)("input",{type:"date",value:G.start_date,onChange:e=>W({...G,start_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"納期 *"}),(0,r.jsx)("input",{type:"date",value:G.end_date,onChange:e=>W({...G,end_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"入札締切日 *"}),(0,r.jsx)("input",{type:"date",value:G.bidding_deadline,onChange:e=>W({...G,bidding_deadline:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"担当者名"}),(0,r.jsx)("input",{type:"text",value:G.assignee_name,onChange:e=>W({...G,assignee_name:e.target.value}),placeholder:"例: 田中太郎",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"案件の社内担当者を指定できます（任意）"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,r.jsx)(A.z,{type:"button",variant:"outline",onClick:()=>Q(!1),disabled:K,children:"キャンセル"}),(0,r.jsx)(A.z,{type:"submit",variant:"engineering",disabled:K,children:K?"作成中...":"案件を登録"})]})]})})]})})})}),(0,r.jsx)(i.M,{children:Y&&(0,r.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-engineering-blue/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(w.Z,{className:"w-5 h-5 text-engineering-blue"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"受注者とのチャット"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:null===(e=D.find(e=>e.id===Y))||void 0===e?void 0:e.contractor_name})]})]}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>H(null),children:"\xd7"})]}),(0,r.jsx)("div",{className:"flex-1 p-4 overflow-y-auto",children:(0,r.jsx)("div",{className:"space-y-4",children:es?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,r.jsx)("p",{children:"メッセージを読み込み中..."})]}):0===ee.length?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)(w.Z,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"まだメッセージがありません"}),(0,r.jsx)("p",{className:"text-sm",children:"受注者とのコミュニケーションを開始しましょう"})]}):ee.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("client"===e.sender_type?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("client"===e.sender_type?"bg-engineering-blue text-white":"bg-gray-100 text-gray-900"),children:[(0,r.jsx)("p",{className:"text-sm",children:e.message}),(0,r.jsx)("p",{className:"text-xs mt-1 ".concat("client"===e.sender_type?"text-blue-100":"text-gray-500"),children:new Date(e.created_at).toLocaleString("ja-JP")})]})},e.id))})}),(0,r.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"メッセージを入力...",value:ea,onChange:e=>er(e.target.value),onKeyPress:e=>{"Enter"===e.key&&Y&&eC(Y)},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",disabled:ei}),(0,r.jsx)(A.z,{variant:"engineering",onClick:()=>Y&&eC(Y),disabled:ei||!ea.trim(),children:ei?"送信中...":"送信"})]})})]})})}),(0,r.jsx)(i.M,{children:ex&&(0,r.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-engineering-blue/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(y.Z,{className:"w-5 h-5 text-engineering-blue"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"添付資料管理"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:null===(t=D.find(e=>e.id===ex))||void 0===t?void 0:t.title})]})]}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>em(null),children:"\xd7"})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,r.jsx)(k.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"ファイルをドラッグ&ドロップまたはクリックしてアップロード"}),(0,r.jsx)("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&ex&&eM(ex,a)},accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.webp,.txt,.zip,.rar,.dwg,.p21,.sfc,.bfo",disabled:ey}),(0,r.jsx)(A.z,{variant:"outline",onClick:()=>{var e;return null===(e=document.getElementById("file-upload"))||void 0===e?void 0:e.click()},disabled:ey,children:ey?"アップロード中...":"ファイルを選択"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"対応形式: PDF, Word, Excel, PowerPoint, 画像, ZIP, RAR, DWG, P21, SFC, BFO (最大200MB)"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-4",children:"添付資料一覧"}),ep?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,r.jsx)("p",{children:"添付資料を読み込み中..."})]}):0===eg.length?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)(_.Z,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"まだ添付資料がありません"}),(0,r.jsx)("p",{className:"text-sm",children:"ファイルをアップロードしてください"})]}):(0,r.jsx)("div",{className:"space-y-3",children:eg.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:(0,r.jsx)(_.Z,{className:"w-4 h-4 text-gray-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.file_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[(e.file_size/1024/1024).toFixed(2)," MB •",new Date(e.created_at).toLocaleDateString("ja-JP")]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>{alert("ダウンロード機能は準備中です")},children:"ダウンロード"}),(0,r.jsx)(A.z,{variant:"outline",size:"sm",onClick:()=>ex&&eD(ex,e.id),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(C.Z,{className:"w-4 h-4"})})]})]},e.id))})]})]})]})})}),(0,r.jsx)(i.M,{children:ed&&(0,r.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsx)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)(S.Zb,{children:[(0,r.jsxs)(S.Ol,{children:[(0,r.jsxs)(S.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"w-5 h-5 text-engineering-blue"}),"案件編集"]}),(0,r.jsx)(S.SZ,{children:"案件の詳細を編集してください"})]}),(0,r.jsx)(S.aY,{children:(0,r.jsxs)("form",{onSubmit:eq,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"案件名 *"}),(0,r.jsx)("input",{type:"text",value:ed.title,onChange:e=>eu({...ed,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カテゴリ *"}),(0,r.jsxs)("select",{value:ed.category,onChange:e=>eu({...ed,category:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"",children:"選択してください"}),(0,r.jsx)("option",{value:"道路設計",children:"道路設計"}),(0,r.jsx)("option",{value:"橋梁設計",children:"橋梁設計"}),(0,r.jsx)("option",{value:"河川工事",children:"河川工事"}),(0,r.jsx)("option",{value:"構造物点検",children:"構造物点検"}),(0,r.jsx)("option",{value:"地下構造",children:"地下構造"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"案件説明 *"}),(0,r.jsx)("textarea",{value:ed.description,onChange:e=>eu({...ed,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"予算 *"}),(0,r.jsx)("input",{type:"number",value:ed.budget,onChange:e=>eu({...ed,budget:Number(e.target.value)}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"開始日 *"}),(0,r.jsx)("input",{type:"date",value:ed.start_date,onChange:e=>eu({...ed,start_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"納期 *"}),(0,r.jsx)("input",{type:"date",value:ed.end_date,onChange:e=>eu({...ed,end_date:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"募集人数 *"}),(0,r.jsx)("input",{type:"number",min:"1",max:"10",value:ed.required_contractors||1,onChange:e=>eu({...ed,required_contractors:Number(e.target.value)}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"この案件に必要な受注者の人数"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"担当者名"}),(0,r.jsx)("input",{type:"text",value:ed.assignee_name||"",onChange:e=>eu({...ed,assignee_name:e.target.value}),placeholder:"例: 田中太郎",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"案件の社内担当者を指定できます（任意）"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"必要な会員レベル *"}),(0,r.jsx)("select",{value:ed.required_level||"beginner",onChange:e=>eu({...ed,required_level:e.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",required:!0,children:Object.values(M.DY).map(e=>(0,r.jsxs)("option",{value:e.level,children:[e.label," - ",e.description]},e.level))})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,r.jsx)(A.z,{type:"button",variant:"outline",onClick:()=>eu(null),disabled:K,children:"キャンセル"}),(0,r.jsx)(A.z,{type:"submit",variant:"engineering",disabled:K,children:K?"更新中...":"更新"})]})]})})]})})})})]})}function T(){return(0,r.jsx)(E.AuthGuard,{requiredRole:"OrgAdmin",children:(0,r.jsx)(D,{})})}},7403:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthGuard:function(){return o},useRoleAccess:function(){return u},withAuth:function(){return d}});var r=a(57437),s=a(2265),n=a(24033),i=a(65251),l=a(86264),c=a(66210);function o(e){let{children:t,requiredRole:a,allowedRoles:o,redirectTo:d="/auth/login"}=e,{user:u,userRole:x,loading:m}=(0,c.useAuth)(),g=(0,n.useRouter)(),h=(0,n.usePathname)(),p=(0,s.useRef)(!1);return((0,s.useEffect)(()=>{if(!m&&!p.current){if(!u){sessionStorage.setItem("redirectAfterLogin",h),h!==d&&(p.current=!0,g.push(d));return}if(a&&x!==a||o&&o.length>0&&(!x||!o.includes(x))){"/unauthorized"!==h&&(p.current=!0,g.push("/unauthorized"));return}}},[u,x,m,a,o]),m)?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,r.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,r.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!u||a&&x!==a||o&&o.length>0&&(!x||!o.includes(x))?null:(0,r.jsx)(r.Fragment,{children:t})}function d(e,t){return function(a){return(0,r.jsx)(o,{requiredRole:t,children:(0,r.jsx)(e,{...a})})}}function u(){let{userRole:e}=(0,c.useAuth)(),t=t=>e===t,a=t=>!!e&&t.includes(e);return{hasRole:t,hasAnyRole:a,isAdmin:()=>t("OrgAdmin"),isStaff:()=>t("Staff"),isContractor:()=>t("Contractor"),isReviewer:()=>t("Reviewer"),isAuditor:()=>t("Auditor"),canManageProjects:()=>a(["OrgAdmin","Staff"]),canViewFinancials:()=>a(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>a(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>a(["Auditor","OrgAdmin"])}}},14440:function(e,t,a){"use strict";a.d(t,{E:function(){return l}});var r=a(57437),s=a(2265),n=a(15946),i=a(22169);let l=s.forwardRef((e,t)=>{let{className:a,value:s,variant:l="default",...c}=e;return(0,r.jsx)(n.fC,{ref:t,className:(0,i.cn)("relative h-2 w-full overflow-hidden rounded-full","default"===l&&"bg-primary/20","engineering"===l&&"bg-engineering-blue/20","gradient"===l&&"bg-gradient-to-r from-engineering-blue/20 to-engineering-green/20",a),...c,children:(0,r.jsx)(n.z$,{className:(0,i.cn)("h-full w-full flex-1 transition-all","default"===l&&"bg-primary","engineering"===l&&"bg-engineering-blue","gradient"===l&&"gradient-engineering"),style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});l.displayName=n.fC.displayName},14374:function(e,t,a){"use strict";a.d(t,{$9:function(){return s},DY:function(){return r},qf:function(){return n}});let r={beginner:{level:"beginner",label:"初級",description:"経験年数3年未満、未経験",color:"bg-green-100 text-green-800"},intermediate:{level:"intermediate",label:"中級",description:"経験年数3年以上7年未満",color:"bg-yellow-100 text-yellow-800"},advanced:{level:"advanced",label:"上級",description:"経験年数7年以上",color:"bg-red-100 text-red-800"}};function s(e,t){if(0===t.length||t.every(e=>"未経験"===e))return"beginner";let a=parseInt(e||"0",10);return a<3?"beginner":a<7?"intermediate":"advanced"}function n(e){return r[e]}},15946:function(e,t,a){"use strict";a.d(t,{z$:function(){return v},fC:function(){return j}});var r=a(2265),s=a(57437);a(54887);var n=a(54949),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=(0,n.Z8)(`Primitive.${t}`),i=r.forwardRef((e,r)=>{let{asChild:n,...i}=e,l=n?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(l,{...i,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),l="Progress",[c,o]=function(e,t=[]){let a=[],n=()=>{let t=a.map(e=>r.createContext(e));return function(a){let s=a?.[e]||t;return r.useMemo(()=>({[`__scope${e}`]:{...a,[e]:s}}),[a,s])}};return n.scopeName=e,[function(t,n){let i=r.createContext(n),l=a.length;a=[...a,n];let c=t=>{let{scope:a,children:n,...c}=t,o=a?.[e]?.[l]||i,d=r.useMemo(()=>c,Object.values(c));return(0,s.jsx)(o.Provider,{value:d,children:n})};return c.displayName=t+"Provider",[c,function(a,s){let c=s?.[e]?.[l]||i,o=r.useContext(c);if(o)return o;if(void 0!==n)return n;throw Error(`\`${a}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let a=()=>{let a=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=a.reduce((t,{useScope:a,scopeName:r})=>{let s=a(e)[`__scope${r}`];return{...t,...s}},{});return r.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return a.scopeName=t.scopeName,a}(n,...t)]}(l),[d,u]=c(l),x=r.forwardRef((e,t)=>{var a,r;let{__scopeProgress:n,value:l=null,max:c,getValueLabel:o=h,...u}=e;(c||0===c)&&!y(c)&&console.error((a=`${c}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let x=y(c)?c:100;null===l||b(l,x)||console.error((r=`${l}`,`Invalid prop \`value\` of value \`${r}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let m=b(l,x)?l:null,g=f(m)?o(m,x):void 0;return(0,s.jsx)(d,{scope:n,value:m,max:x,children:(0,s.jsx)(i.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":f(m)?m:void 0,"aria-valuetext":g,role:"progressbar","data-state":p(m,x),"data-value":m??void 0,"data-max":x,...u,ref:t})})});x.displayName=l;var m="ProgressIndicator",g=r.forwardRef((e,t)=>{let{__scopeProgress:a,...r}=e,n=u(m,a);return(0,s.jsx)(i.div,{"data-state":p(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:t})});function h(e,t){return`${Math.round(e/t*100)}%`}function p(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function f(e){return"number"==typeof e}function y(e){return f(e)&&!isNaN(e)&&e>0}function b(e,t){return f(e)&&!isNaN(e)&&e<=t&&e>=0}g.displayName=m;var j=x,v=g}},function(e){e.O(0,[14,402,440,250,228,97,643,971,938,744],function(){return e(e.s=91897)}),_N_E=e.O()}]);