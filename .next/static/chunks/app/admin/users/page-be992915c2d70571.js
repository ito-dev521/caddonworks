(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{28203:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},86264:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},96142:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},49617:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},12741:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},92295:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},41827:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},49036:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,s(62898).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},30670:function(e,t,s){Promise.resolve().then(s.bind(s,14882))},14882:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Z}});var n=s(57437),a=s(2265),r=s(65251),i=s(49036),l=s(41827),c=s(67972),d=s(12741),o=s(96142),u=s(28203),m=s(92295),x=s(82549),h=s(49617),f=s(25750),g=s(65592),p=s(15671),j=s(33277),y=s(575),v=s(66210),b=s(14958),N=s(7403),w=s(14374);function Z(){return(0,n.jsx)(N.AuthGuard,{children:(0,n.jsx)(k,{})})}function k(){let{userProfile:e,userRole:t,loading:s}=(0,v.useAuth)(),[N,Z]=(0,a.useState)([]),[k,A]=(0,a.useState)([]),[_,C]=(0,a.useState)(""),[S,z]=(0,a.useState)(null),[E,L]=(0,a.useState)("beginner"),[O,q]=(0,a.useState)(!0),[M,P]=(0,a.useState)(!1);if("Admin"!==t)return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(g.W,{}),(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"アクセス拒否"}),(0,n.jsx)("p",{className:"text-gray-600",children:"このページにアクセスするには運営者権限が必要です。"})]})})]});let R=async()=>{try{q(!0);let{data:{session:e}}=await b.OQ.auth.getSession();if(!e)throw Error("セッションが見つかりません");let t=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}});if(!t.ok)throw Error("ユーザー一覧の取得に失敗しました");let s=await t.json();Z(s.users||[]),A(s.users||[])}catch(e){console.error("ユーザー一覧取得エラー:",e),alert("ユーザー一覧の取得に失敗しました")}finally{q(!1)}},Y=async(e,t)=>{try{P(!0);let{data:{session:s}}=await b.OQ.auth.getSession();if(!s)throw Error("セッションが見つかりません");if(!(await fetch("/api/admin/users",{method:"PUT",headers:{Authorization:"Bearer ".concat(s.access_token),"Content-Type":"application/json"},body:JSON.stringify({userId:e,memberLevel:t})})).ok)throw Error("会員レベルの更新に失敗しました");Z(s=>s.map(s=>s.id===e?{...s,member_level:t}:s)),A(s=>s.map(s=>s.id===e?{...s,member_level:t}:s)),z(null),alert("会員レベルが正常に更新されました")}catch(e){console.error("会員レベル更新エラー:",e),alert("会員レベルの更新に失敗しました")}finally{P(!1)}};return((0,a.useEffect)(()=>{_?A(N.filter(e=>{var t;return e.display_name.toLowerCase().includes(_.toLowerCase())||e.email.toLowerCase().includes(_.toLowerCase())||(null===(t=e.formal_name)||void 0===t?void 0:t.toLowerCase().includes(_.toLowerCase()))})):A(N)},[_,N]),(0,a.useEffect)(()=>{R()},[]),s||O)?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(g.W,{}),(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]})})]}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(g.W,{}),(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3",children:[(0,n.jsx)(i.Z,{className:"w-8 h-8 text-engineering-blue"}),"ユーザー管理"]}),(0,n.jsx)("p",{className:"text-gray-600",children:"全ユーザーの会員レベルを管理できます"})]}),(0,n.jsx)(p.Zb,{className:"mb-6",children:(0,n.jsx)(p.aY,{className:"p-6",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(l.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,n.jsx)("input",{type:"text",placeholder:"ユーザー名、メールアドレス、氏名で検索...",value:_,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"})]})})}),(0,n.jsx)("div",{className:"grid gap-6",children:k.map(e=>{var t;return(0,n.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,n.jsx)(p.Zb,{className:"hover:shadow-lg transition-shadow",children:(0,n.jsx)(p.aY,{className:"p-6",children:(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-engineering-blue rounded-full flex items-center justify-center text-white font-bold text-lg",children:e.display_name.charAt(0).toUpperCase()}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.display_name}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:e.email})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.formal_name&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,n.jsx)(c.Z,{className:"w-4 h-4"}),e.formal_name]}),e.phone_number&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,n.jsx)(d.Z,{className:"w-4 h-4"}),e.phone_number]}),e.address&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,n.jsx)(o.Z,{className:"w-4 h-4"}),e.address]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,n.jsx)(u.Z,{className:"w-4 h-4"}),"登録日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:null===(t=e.specialties)||void 0===t?void 0:t.map((e,t)=>(0,n.jsx)(j.C,{variant:"outline",className:"text-xs",children:e},t))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"会員レベル:"}),S===e.id?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("select",{value:E,onChange:e=>L(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:Object.values(w.DY).map(e=>(0,n.jsx)("option",{value:e.level,children:e.label},e.level))}),(0,n.jsx)(y.z,{size:"sm",onClick:()=>Y(e.id,E),disabled:M,className:"bg-green-600 hover:bg-green-700",children:(0,n.jsx)(m.Z,{className:"w-4 h-4"})}),(0,n.jsx)(y.z,{size:"sm",variant:"outline",onClick:()=>z(null),disabled:M,children:(0,n.jsx)(x.Z,{className:"w-4 h-4"})})]}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(j.C,{className:w.DY[e.member_level||"beginner"].color,children:w.DY[e.member_level||"beginner"].label}),(0,n.jsx)(y.z,{size:"sm",variant:"outline",onClick:()=>{z(e.id),L(e.member_level||"beginner")},children:(0,n.jsx)(h.Z,{className:"w-4 h-4"})})]})]})]})})})})},e.id)})}),0===k.length&&(0,n.jsx)(p.Zb,{children:(0,n.jsxs)(p.aY,{className:"p-8 text-center",children:[(0,n.jsx)(f.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ユーザーが見つかりません"}),(0,n.jsx)("p",{className:"text-gray-600",children:_?"検索条件に一致するユーザーがありません":"ユーザーが登録されていません"})]})})]})})]})}},7403:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthGuard:function(){return d},useRoleAccess:function(){return u},withAuth:function(){return o}});var n=s(57437),a=s(2265),r=s(24033),i=s(65251),l=s(86264),c=s(66210);function d(e){let{children:t,requiredRole:s,allowedRoles:d,redirectTo:o="/auth/login"}=e,{user:u,userRole:m,loading:x}=(0,c.useAuth)(),h=(0,r.useRouter)(),f=(0,r.usePathname)(),g=(0,a.useRef)(!1);return((0,a.useEffect)(()=>{if(!x&&!g.current){if(!u){sessionStorage.setItem("redirectAfterLogin",f),f!==o&&(g.current=!0,h.push(o));return}if(s&&m!==s||d&&d.length>0&&(!m||!d.includes(m))){"/unauthorized"!==f&&(g.current=!0,h.push("/unauthorized"));return}}},[u,m,x,s,d,h,o,f]),x)?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,n.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!u||s&&m!==s||d&&d.length>0&&(!m||!d.includes(m))?null:(0,n.jsx)(n.Fragment,{children:t})}function o(e,t){return function(s){return(0,n.jsx)(d,{requiredRole:t,children:(0,n.jsx)(e,{...s})})}}function u(){let{userRole:e}=(0,c.useAuth)(),t=t=>e===t,s=t=>!!e&&t.includes(e);return{hasRole:t,hasAnyRole:s,isAdmin:()=>t("OrgAdmin"),isStaff:()=>t("Staff"),isContractor:()=>t("Contractor"),isReviewer:()=>t("Reviewer"),isAuditor:()=>t("Auditor"),canManageProjects:()=>s(["OrgAdmin","Staff"]),canViewFinancials:()=>s(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>s(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>s(["Auditor","OrgAdmin"])}}},14374:function(e,t,s){"use strict";s.d(t,{$9:function(){return a},DY:function(){return n},qf:function(){return r}});let n={beginner:{level:"beginner",label:"初級",description:"経験年数3年未満、未経験",color:"bg-green-100 text-green-800"},intermediate:{level:"intermediate",label:"中級",description:"経験年数3年以上7年未満",color:"bg-yellow-100 text-yellow-800"},advanced:{level:"advanced",label:"上級",description:"経験年数7年以上",color:"bg-red-100 text-red-800"}};function a(e,t){if(0===t.length||t.every(e=>"未経験"===e))return"beginner";let s=parseInt(e||"0",10);return s<3?"beginner":s<7?"intermediate":"advanced"}function r(e){return n[e]}}},function(e){e.O(0,[778,402,440,250,677,650,971,938,744],function(){return e(e.s=30670)}),_N_E=e.O()}]);