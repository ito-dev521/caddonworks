(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[760],{13008:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6141:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},86264:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},76020:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},59491:function(e,s,t){Promise.resolve().then(t.bind(t,94224))},94224:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(57437),i=t(2265),n=t(65251),r=t(11981),l=t(6141),c=t(13008),d=t(76637),o=t(82549),x=t(76020),m=t(32176),u=t(7403),h=t(65592),j=t(575),g=t(15671),f=t(33277),y=t(66210),b=t(14958);function p(){return(0,a.jsx)(u.AuthGuard,{children:(0,a.jsx)(N,{})})}function N(){let{userProfile:e,userRole:s}=(0,y.useAuth)(),[t,u]=(0,i.useState)([]),[p,N]=(0,i.useState)(!0),[v,w]=(0,i.useState)(null),[k,C]=(0,i.useState)(!1),[S,Z]=(0,i.useState)({subject:"",message:""}),[_,A]=(0,i.useState)(!1),z=async()=>{if(e)try{N(!0);let{data:{session:s}}=await b.OQ.auth.getSession();if(!s)return;let t=await fetch("/api/invoices/contractor/".concat(e.id),{headers:{Authorization:"Bearer ".concat(s.access_token)}});if(t.ok){let e=await t.json();u(e.invoices||[])}}catch(e){console.error("請求書取得エラー:",e)}finally{N(!1)}},O=async e=>{try{let{data:{session:s}}=await b.OQ.auth.getSession();if(!s)return;let t=await fetch("/api/invoices/".concat(e,"/issue"),{method:"POST",headers:{Authorization:"Bearer ".concat(s.access_token)}}),a=await t.json();t.ok?(alert("請求書を発行しました。"),await z(),w(null)):alert("請求書発行に失敗しました: "+a.message)}catch(e){console.error("請求書発行エラー:",e),alert("ネットワークエラーが発生しました")}},E=async()=>{if(!S.subject.trim()||!S.message.trim()){alert("件名とメッセージを入力してください");return}try{A(!0);let{data:{session:e}}=await b.OQ.auth.getSession();if(!e)return;let s=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({subject:S.subject,message:S.message,related_invoice_id:null==v?void 0:v.id,type:"invoice_inquiry"})}),t=await s.json();s.ok?(alert("問い合わせを送信しました。"),C(!1),Z({subject:"",message:""})):alert("問い合わせ送信に失敗しました: "+t.message)}catch(e){console.error("問い合わせ送信エラー:",e),alert("ネットワークエラーが発生しました")}finally{A(!1)}};if((0,i.useEffect)(()=>{e&&"Contractor"===s&&z()},[e,s]),"Contractor"!==s)return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(h.W,{}),(0,a.jsx)("div",{className:"md:ml-64 transition-all duration-300",children:(0,a.jsx)("main",{className:"px-6 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(g.Zb,{children:(0,a.jsxs)(g.aY,{className:"p-8 text-center",children:[(0,a.jsx)(r.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"このページは受注者のみアクセス可能です。"})]})})})})})]});let L=e=>{switch(e){case"draft":return(0,a.jsx)(f.C,{variant:"outline",className:"text-gray-600",children:"下書き"});case"issued":return(0,a.jsx)(f.C,{variant:"default",className:"bg-green-600",children:"発行済み"});case"paid":return(0,a.jsx)(f.C,{variant:"default",className:"bg-blue-600",children:"支払済み"});default:return(0,a.jsx)(f.C,{variant:"outline",children:e})}},P=e=>{switch(e){case"draft":return(0,a.jsx)(l.Z,{className:"w-5 h-5 text-gray-600"});case"issued":return(0,a.jsx)(c.Z,{className:"w-5 h-5 text-green-600"});case"paid":return(0,a.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"});default:return(0,a.jsx)(r.Z,{className:"w-5 h-5 text-gray-600"})}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-mesh",children:[(0,a.jsx)(h.W,{}),(0,a.jsx)("div",{className:"md:ml-64 transition-all duration-300",children:(0,a.jsx)("main",{className:"px-6 py-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"請求書管理"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"発注者から作成された請求書を確認し、発行してください"})]})})}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,a.jsxs)(g.Zb,{children:[(0,a.jsx)(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),"請求書一覧"]})}),(0,a.jsx)(g.aY,{children:p?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue mx-auto"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"読み込み中..."})]}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(d.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"請求書はありません"})]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[P(e.status),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.invoice_number}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.project.title}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.client_org.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["\xa5",e.total_amount.toLocaleString()]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.issue_date).toLocaleDateString("ja-JP")})]}),L(e.status),(0,a.jsx)(j.z,{variant:"outline",size:"sm",onClick:()=>w(e),children:"詳細"})]})]})},e.id))})})]})}),v&&(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>w(null),children:(0,a.jsx)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"請求書詳細"}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",onClick:()=>w(null),children:(0,a.jsx)(o.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"請求書番号"}),(0,a.jsx)("p",{className:"text-gray-900",children:v.invoice_number})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ステータス"}),L(v.status)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発行日"}),(0,a.jsx)("p",{className:"text-gray-900",children:new Date(v.issue_date).toLocaleDateString("ja-JP")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支払期限"}),(0,a.jsx)("p",{className:"text-gray-900",children:new Date(v.due_date).toLocaleDateString("ja-JP")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"案件名"}),(0,a.jsx)("p",{className:"text-gray-900",children:v.project.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発注者"}),(0,a.jsx)("p",{className:"text-gray-900",children:v.client_org.name})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"金額詳細"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"契約金額"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",v.base_amount.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"システム手数料"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",v.system_fee.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[(0,a.jsx)("span",{className:"text-gray-900",children:"合計金額"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",v.total_amount.toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4 border-t",children:["draft"===v.status&&(0,a.jsxs)(j.z,{onClick:()=>O(v.id),className:"bg-engineering-blue hover:bg-engineering-blue/90",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"請求書を発行"]}),(0,a.jsxs)(j.z,{variant:"outline",onClick:()=>C(!0),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"問い合わせ"]})]})]})]})})}),k&&(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>C(!1),children:(0,a.jsx)(n.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-xl max-w-md w-full",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"問い合わせ"}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",onClick:()=>C(!1),children:(0,a.jsx)(o.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"件名 *"}),(0,a.jsx)("input",{type:"text",value:S.subject,onChange:e=>Z(s=>({...s,subject:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"件名を入力してください"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メッセージ *"}),(0,a.jsx)("textarea",{value:S.message,onChange:e=>Z(s=>({...s,message:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"問い合わせ内容を入力してください"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)(j.z,{onClick:E,disabled:_,className:"bg-engineering-blue hover:bg-engineering-blue/90",children:_?"送信中...":"送信"}),(0,a.jsx)(j.z,{variant:"outline",onClick:()=>C(!1),children:"キャンセル"})]})]})]})})})]})})})]})}},7403:function(e,s,t){"use strict";t.r(s),t.d(s,{AuthGuard:function(){return d},useRoleAccess:function(){return x},withAuth:function(){return o}});var a=t(57437),i=t(2265),n=t(24033),r=t(65251),l=t(86264),c=t(66210);function d(e){let{children:s,requiredRole:t,allowedRoles:d,redirectTo:o="/auth/login"}=e,{user:x,userRole:m,loading:u}=(0,c.useAuth)(),h=(0,n.useRouter)(),j=(0,n.usePathname)(),g=(0,i.useRef)(!1);return((0,i.useEffect)(()=>{if(!u&&!g.current){if(!x){sessionStorage.setItem("redirectAfterLogin",j),j!==o&&(g.current=!0,h.push(o));return}if(t&&m!==t||d&&d.length>0&&(!m||!d.includes(m))){"/unauthorized"!==j&&(g.current=!0,h.push("/unauthorized"));return}}},[x,m,u,t,d,h,o,j]),u)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,a.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!x||t&&m!==t||d&&d.length>0&&(!m||!d.includes(m))?null:(0,a.jsx)(a.Fragment,{children:s})}function o(e,s){return function(t){return(0,a.jsx)(d,{requiredRole:s,children:(0,a.jsx)(e,{...t})})}}function x(){let{userRole:e}=(0,c.useAuth)(),s=s=>e===s,t=s=>!!e&&s.includes(e);return{hasRole:s,hasAnyRole:t,isAdmin:()=>s("OrgAdmin"),isStaff:()=>s("Staff"),isContractor:()=>s("Contractor"),isReviewer:()=>s("Reviewer"),isAuditor:()=>s("Auditor"),canManageProjects:()=>t(["OrgAdmin","Staff"]),canViewFinancials:()=>t(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>t(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>t(["Auditor","OrgAdmin"])}}}},function(e){e.O(0,[778,402,440,250,677,650,971,938,744],function(){return e(e.s=59491)}),_N_E=e.O()}]);