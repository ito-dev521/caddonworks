(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{22812:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},28203:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},6141:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},41298:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},99670:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},42482:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},86264:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},96142:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},41827:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(62898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},99836:function(e,s,t){Promise.resolve().then(t.bind(t,50204))},50204:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return z}});var a=t(57437),n=t(2265),i=t(65251),l=t(62167),r=t(22812),c=t(37006),d=t(41827),o=t(42482),u=t(6141),x=t(41298),m=t(28203),h=t(67972),g=t(11981),p=t(96142),f=t(99670),j=t(76637),b=t(82549),y=t(13332),v=t(15671),N=t(33277),w=t(575),_=t(22169),k=t(66210),D=t(14958),C=t(7403),Z=t(14374);function S(){var e,s;let{userProfile:t,userRole:C,loading:S}=(0,k.useAuth)(),[z,A]=(0,n.useState)([]),[M,E]=(0,n.useState)([]),[P,J]=(0,n.useState)("available"),[L,q]=(0,n.useState)(""),[O,R]=(0,n.useState)(""),[T,B]=(0,n.useState)(null),[I,F]=(0,n.useState)(!0),[Y,G]=(0,n.useState)({project_id:"",bid_amount:"",proposal:"",budget_approved:!1}),[Q,U]=(0,n.useState)(!1),[H,K]=(0,n.useState)(null),[V,W]=(0,n.useState)([]),[$,X]=(0,n.useState)(!1),ee=(0,n.useRef)(null),es=e=>null==e?"0":String(e).replace(/[^\d]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,","),et=e=>null==e?0:parseInt(String(e).replace(/[^\d]/g,""),10)||0,ea=e=>{if(!e)return null;let s=new Date;return Math.ceil((new Date(e).getTime()-s.getTime())/864e5)},en=e=>{let s=ea(e);return null===s?"text-gray-600":s<=0?"text-red-600":s<=3?"text-orange-600 font-medium":"text-gray-600"},ei=async()=>{try{var e,s,t;console.log("fetchJobs: 開始"),F(!0);let{data:{session:a}}=await D.OQ.auth.getSession();if(console.log("fetchJobs: セッション確認",a?"あり":"なし"),!a){console.error("fetchJobs: セッションが見つかりません"),F(!1),window.location.href="/auth/login";return}console.log("fetchJobs: APIリクエスト開始",{hasAccessToken:!!a.access_token,tokenLength:null===(e=a.access_token)||void 0===e?void 0:e.length,tokenPreview:(null===(s=a.access_token)||void 0===s?void 0:s.substring(0,20))+"..."});let n=await fetch("/api/jobs",{method:"GET",headers:{Authorization:"Bearer ".concat(a.access_token),"Content-Type":"application/json"}});console.log("fetchJobs: APIレスポンス",n.status,n.statusText);let i=await n.json();if(console.log("fetchJobs: API結果",i),n.ok)console.log("fetchJobs: 成功, 案件数:",(null===(t=i.jobs)||void 0===t?void 0:t.length)||0),A(i.jobs),E(i.jobs);else{if(console.error("fetchJobs: 案件データの取得に失敗:",{status:n.status,statusText:n.statusText,message:i.message}),401===n.status){console.log("fetchJobs: 認証エラー、ログインページにリダイレクト"),window.location.href="/auth/login";return}A([]),E([])}}catch(e){if(console.error("fetchJobs: データ取得エラー:",e),e instanceof Error&&e.message.includes("401")){console.log("fetchJobs: 認証エラー、ログインページにリダイレクト"),window.location.href="/auth/login";return}A([]),E([])}finally{console.log("fetchJobs: 終了"),F(!1)}};(0,n.useEffect)(()=>{if(console.log("useEffect: 認証状態確認",{userProfile:t?"あり":"なし",userRole:C,loading:S,userProfileId:null==t?void 0:t.id,userEmail:null==t?void 0:t.email}),!t||"Contractor"!==C){console.log("useEffect: 認証条件未満のため、データ取得をスキップ",{hasUserProfile:!!t,userRole:C,expectedRole:"Contractor"}),F(!1),t&&C&&"Contractor"!==C&&(console.log("useEffect: 権限不足でリダイレクト",{userRole:C}),alert("このページにアクセスするには受注者権限が必要です"),window.location.href="/dashboard");return}let e="".concat(t.id,":").concat(C);ee.current!==e&&(ee.current=e,console.log("useEffect: 認証OK、データ取得開始",{userRole:C,userProfileId:t.id}),ei())},[t,C]),(0,n.useEffect)(()=>{let e=z;if("available"===P){e=e.filter(e=>"bidding"===e.status);let s=new Date;e=e.filter(e=>!e.bidding_deadline||new Date(e.bidding_deadline)>s)}else"awarded"===P&&(e=e.filter(e=>"bidding"!==e.status));O&&(e=e.filter(e=>e.category===O)),L&&(e=e.filter(e=>e.title.toLowerCase().includes(L.toLowerCase())||e.org_name.toLowerCase().includes(L.toLowerCase())||e.category.toLowerCase().includes(L.toLowerCase())||e.description.toLowerCase().includes(L.toLowerCase()))),E(e)},[z,P,O,L]);let el=async e=>{if(e.preventDefault(),!T)return;let s=z.find(e=>e.id===T);if(s&&!s.can_bid){alert("この案件の募集人数に達しているため、入札できません");return}if(!Y.budget_approved){alert("発注者側の予算に同意してください");return}if(!Y.budget_approved&&(!Y.bid_amount||0>=et(Y.bid_amount))){alert("有効な入札金額を入力してください");return}U(!0);try{var t;let{data:{session:e}}=await D.OQ.auth.getSession();if(!e){alert("ログインが必要です");return}let s=await fetch("/api/bids",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.access_token)},body:JSON.stringify({project_id:T,bid_amount:Y.budget_approved?et(es((null===(t=z.find(e=>e.id===T))||void 0===t?void 0:t.budget)||0)):et(Y.bid_amount),proposal:Y.proposal,budget_approved:Y.budget_approved})}),a=await s.json();s.ok?(alert("入札が正常に送信されました"),B(null),G({project_id:"",bid_amount:"",proposal:"",budget_approved:!1}),ei()):alert("入札の送信に失敗しました: "+a.message)}catch(e){console.error("入札送信エラー:",e),alert("ネットワークエラーが発生しました")}finally{U(!1)}},er=e=>{B(e),G({project_id:e,bid_amount:"",proposal:"",budget_approved:!1})},ec=async e=>{X(!0);try{let{data:{session:s}}=await D.OQ.auth.getSession();if(!s){console.error("セッションが見つかりません");return}let t=await fetch("/api/contractor/projects/".concat(e,"/attachments"),{method:"GET",headers:{Authorization:"Bearer ".concat(s.access_token),"Content-Type":"application/json"}}),a=await t.json();t.ok?W(a.attachments||[]):(console.error("添付資料の取得に失敗:",a.message),W([]))}catch(e){console.error("添付資料取得エラー:",e),W([])}finally{X(!1)}},ed=e=>{if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},eo=e=>e.includes("pdf")?"\uD83D\uDCC4":e.includes("image")?"\uD83D\uDDBC️":e.includes("word")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.includes("zip")||e.includes("rar")?"\uD83D\uDDDC️":e.includes("text")||e.includes("plain")?"\uD83D\uDCC3":e.includes("dwg")?"\uD83C\uDFD7️":e.includes("step")||e.includes("p21")?"\uD83D\uDD27":e.includes("sfc")?"⚙️":e.includes("bfo")?"\uD83D\uDCD0":"\uD83D\uDCCE",eu=e=>{K(e),ec(e)},ex=e=>{switch(e){case"bidding":return"text-blue-600 bg-blue-100";case"in_progress":return"text-green-600 bg-green-100";case"completed":default:return"text-gray-600 bg-gray-100";case"cancelled":return"text-red-600 bg-red-100"}},em=e=>{switch(e){case"bidding":return"入札受付中";case"in_progress":return"進行中";case"completed":return"完了";case"cancelled":return"キャンセル";default:return e}};return S||I?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:S?"認証情報を読み込み中...":"案件データを読み込み中..."}),(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:[(0,a.jsxs)("p",{children:["Loading: ",S?"true":"false"]}),(0,a.jsxs)("p",{children:["DataLoading: ",I?"true":"false"]}),(0,a.jsxs)("p",{children:["User: ",t?"あり":"なし"]}),(0,a.jsxs)("p",{children:["Role: ",C||"なし"]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"text-blue-600 hover:underline text-sm",children:"ページを再読み込み"})})]})}):"Contractor"!==C?(console.log("JobsPage: 権限チェック失敗",{userRole:C,userProfile:!!t}),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsx)(v.Zb,{className:"w-full max-w-md",children:(0,a.jsxs)(v.aY,{className:"p-6 text-center",children:[(0,a.jsx)(r.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"このページは受注者（Contractor）のみアクセス可能です。"}),(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:[(0,a.jsxs)("p",{children:["現在のロール: ",C||"なし"]}),(0,a.jsxs)("p",{children:["ユーザープロフィール: ",t?"あり":"なし"]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsx)("a",{href:"/auth/login",className:"block text-blue-600 hover:underline",children:"ログインページへ"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"block text-blue-600 hover:underline",children:"ページを再読み込み"})]})]})})})):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-mesh",children:[(0,a.jsx)(y.W,{}),(0,a.jsxs)("div",{className:"md:ml-64 transition-all duration-300",children:[(0,a.jsx)(i.E.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-sm border-b border-gray-200 sticky top-0 z-30",children:(0,a.jsx)("div",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-6 h-6 text-engineering-blue"}),"案件一覧"]}),(0,a.jsx)("p",{className:"text-gray-600",children:"受注可能な案件を検索・入札"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"入札可能案件"}),(0,a.jsxs)("p",{className:"text-sm font-medium",children:[z.filter(e=>"bidding"===e.status).length,"件"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"落札案件"}),(0,a.jsxs)("p",{className:"text-sm font-medium",children:[z.filter(e=>"bidding"!==e.status).length,"件"]})]})]})]})})}),(0,a.jsxs)("main",{className:"px-6 py-8",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[(0,a.jsx)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"available",label:"入札可能",count:z.filter(e=>"bidding"===e.status).length},{id:"awarded",label:"落札案件",count:z.filter(e=>"bidding"!==e.status).length},{id:"all",label:"すべて",count:z.length}].map(e=>(0,a.jsxs)("button",{onClick:()=>J(e.id),className:"flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(P===e.id?"bg-white text-engineering-blue shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.label,(0,a.jsx)(N.C,{variant:"outline",className:"text-xs",children:e.count})]},e.id))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"案件名・発注者で検索...",value:L,onChange:e=>q(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent w-64"})]}),(0,a.jsxs)("select",{value:O,onChange:e=>R(e.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"すべてのカテゴリ"}),Array.from(new Set(z.map(e=>e.category))).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)(w.z,{variant:"outline",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"詳細フィルター"]})]})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:(0,a.jsx)(l.M,{children:M.map((e,s)=>(0,a.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.1*s},children:(0,a.jsxs)(v.Zb,{className:"hover-lift cursor-pointer group",children:[(0,a.jsx)(v.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(v.ll,{className:"text-lg text-gray-900 group-hover:text-engineering-blue transition-colors",children:e.title}),(0,a.jsxs)(v.SZ,{className:"mt-1",children:[e.org_name," • ",e.category]})]}),(0,a.jsx)(N.C,{className:ex(e.status),children:em(e.status)})]})}),(0,a.jsxs)(v.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[e.bidding_deadline&&(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(en(e.bidding_deadline)),children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"入札締切: ",new Date(e.bidding_deadline).toLocaleDateString("ja-JP"),(()=>{let s=ea(e.bidding_deadline);return null!==s&&s>0?(0,a.jsxs)("span",{className:"text-xs",children:["(",s,"日後)"]}):null})()]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),es(e.budget)]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"納期: ",new Date(e.end_date).toLocaleDateString("ja-JP")]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),"募集人数: ",e.required_contractors,"名",e.current_bid_count>0&&(0,a.jsxs)("span",{className:"text-sm",children:["(入札済み: ",e.current_bid_count,"名)"]})]}),e.required_level&&(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(N.C,{className:Z.DY[e.required_level].color,children:["必要レベル: ",Z.DY[e.required_level].label]})}),e.is_full&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-600 font-medium",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"募集人数に達しました"]}),e.location&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),e.location]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-lg",children:(0,a.jsx)("p",{className:"line-clamp-3",children:e.description})}),(0,a.jsx)("div",{className:"pt-3 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-engineering-blue/10 rounded-full flex items-center justify-center",children:(0,a.jsx)(r.Z,{className:"w-4 h-4 text-engineering-blue"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"発注者"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.org_name}),e.assignee_name&&(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["担当: ",e.assignee_name]})]})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["案件ID: ",e.id.slice(0,8).toUpperCase()]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(w.z,{variant:"outline",size:"sm",onClick:()=>eu(e.id),children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})}),"bidding"===e.status&&(0,a.jsxs)(w.z,{variant:"engineering",size:"sm",onClick:()=>er(e.id),disabled:!e.can_bid,className:e.can_bid?"":"opacity-50 cursor-not-allowed",title:e.is_full?"募集人数に達しました":"入札する",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),e.is_full?"募集終了":"入札"]}),"bidding"!==e.status&&(0,a.jsx)(N.C,{variant:"secondary",className:"bg-green-100 text-green-800",children:"落札済み"})]})]})]})]})},e.id))})}),0===M.length&&(0,a.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"案件が見つかりません"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:L||O?"検索条件に一致する案件がありません。":"現在、入札可能な案件はありません。"}),(0,a.jsx)(w.z,{variant:"outline",onClick:()=>{q(""),R(""),J("all")},children:"フィルターをリセット"})]})]})]}),(0,a.jsx)(l.M,{children:T&&(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)(v.Zb,{children:[(0,a.jsxs)(v.Ol,{children:[(0,a.jsxs)(v.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-engineering-blue"}),"入札フォーム"]}),(0,a.jsx)(v.SZ,{children:(()=>{let e=z.find(e=>e.id===T);return e?"".concat(e.title," への入札"):"入札フォーム"})()})]}),(0,a.jsx)(v.aY,{children:(0,a.jsxs)("form",{onSubmit:el,className:"space-y-4",children:[(()=>{let e=z.find(e=>e.id===T);return e&&e.is_full?(0,a.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(g.Z,{className:"w-5 h-5 text-red-600"}),(0,a.jsx)("span",{className:"font-medium text-red-900",children:"募集終了"})]}),(0,a.jsxs)("div",{className:"text-sm text-red-700",children:["この案件の募集人数（",e.required_contractors,"名）に達しているため、入札できません。"]})]}):null})(),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium text-blue-900",children:"発注者側の予算"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:(()=>{let e=z.find(e=>e.id===T);return e?es(e.budget)+"円":"読み込み中..."})()})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,a.jsx)("input",{type:"checkbox",id:"budget_approved",checked:Y.budget_approved,onChange:e=>{let s=e.target.checked,t=z.find(e=>e.id===T);G({...Y,budget_approved:s,bid_amount:s?es((null==t?void 0:t.budget)||0):Y.bid_amount})},className:"w-4 h-4 text-engineering-blue border-gray-300 rounded focus:ring-engineering-blue"}),(0,a.jsx)("label",{htmlFor:"budget_approved",className:"text-sm font-medium text-gray-700",children:"上記の予算で問題ありません"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"入札金額 * (円)"}),(0,a.jsx)("input",{type:"text",value:Y.budget_approved?es((null===(e=z.find(e=>e.id===T))||void 0===e?void 0:e.budget)||0):Y.bid_amount,onChange:e=>{if(!Y.budget_approved){let s=es(e.target.value);G({...Y,bid_amount:s})}},placeholder:"例: 500,000",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent ".concat(Y.budget_approved?"border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed":"border-gray-200"),disabled:Y.budget_approved,required:!0}),Y.budget_approved&&(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"予算承認済みのため、発注者側の予算と同じ金額で入札されます"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"コメント"}),(0,a.jsx)("textarea",{value:Y.proposal,onChange:e=>G({...Y,proposal:e.target.value}),rows:4,placeholder:"案件に対する提案やアプローチ方法を記入してください（任意）...",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)(w.z,{type:"button",variant:"outline",onClick:()=>B(null),disabled:Q,children:"キャンセル"}),(0,a.jsx)(w.z,{type:"submit",variant:"engineering",disabled:Q||(()=>{let e=z.find(e=>e.id===T);return!!e&&!e.can_bid})(),children:(()=>{let e=z.find(e=>e.id===T);return e&&!e.can_bid?"募集終了":Q?"送信中...":"入札を送信"})()})]})]})})]})})})}),(0,a.jsx)(l.M,{children:H&&(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)(v.Zb,{children:[(0,a.jsx)(v.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(v.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-engineering-blue"}),"案件詳細"]}),(0,a.jsx)(v.SZ,{children:null===(s=z.find(e=>e.id===H))||void 0===s?void 0:s.title})]}),(0,a.jsx)(w.z,{variant:"outline",size:"sm",onClick:()=>K(null),children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})}),(0,a.jsx)(v.aY,{children:(()=>{let e=z.find(e=>e.id===H);return e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"基本情報"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"案件名:"}),(0,a.jsx)("span",{className:"font-medium",children:e.title})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"カテゴリ:"}),(0,a.jsx)("span",{className:"font-medium",children:e.category})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"予算:"}),(0,a.jsx)("span",{className:"font-medium text-engineering-blue",children:(0,_.xG)(e.budget)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"納期:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(e.end_date).toLocaleDateString("ja-JP")})]}),e.bidding_deadline&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"入札締切:"}),(0,a.jsxs)("span",{className:"font-medium ".concat(en(e.bidding_deadline)),children:[new Date(e.bidding_deadline).toLocaleDateString("ja-JP"),(()=>{let s=ea(e.bidding_deadline);return null!==s&&s>0?(0,a.jsxs)("span",{className:"text-xs ml-1",children:["(",s,"日後)"]}):null})()]})]}),e.location&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"場所:"}),(0,a.jsx)("span",{className:"font-medium",children:e.location})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"発注者情報"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"発注者:"}),(0,a.jsx)("span",{className:"font-medium",children:e.org_name})]}),e.assignee_name&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"担当者:"}),(0,a.jsx)("span",{className:"font-medium",children:e.assignee_name})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"案件ID:"}),(0,a.jsx)("span",{className:"font-mono text-xs",children:e.id})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"案件説明"}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.description})})]}),e.requirements&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"要件・条件"}),(0,a.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.requirements})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"添付資料"}),$?(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"添付資料を読み込み中..."})}):V.length>0?(0,a.jsx)("div",{className:"space-y-2",children:V.map(e=>(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-lg",children:eo(e.file_type)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.file_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[ed(e.file_size)," •",new Date(e.created_at).toLocaleDateString("ja-JP")," •",e.uploaded_by_name]})]})]}),(0,a.jsxs)(w.z,{variant:"outline",size:"sm",onClick:()=>window.open(e.download_url,"_blank"),children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),"ダウンロード"]})]})},e.id))}):(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"添付資料はありません"})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)(w.z,{variant:"outline",onClick:()=>K(null),children:"閉じる"}),"bidding"===e.status&&(0,a.jsxs)(w.z,{variant:"engineering",onClick:()=>{K(null),er(e.id)},disabled:!e.can_bid,className:e.can_bid?"":"opacity-50 cursor-not-allowed",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),e.is_full?"募集人数に達しました":"入札する"]}),"bidding"!==e.status&&(0,a.jsx)(N.C,{variant:"secondary",className:"bg-green-100 text-green-800",children:"落札済み"})]})]}):null})()})]})})})})]})}function z(){return(0,a.jsx)(C.AuthGuard,{requiredRole:"Contractor",children:(0,a.jsx)(S,{})})}},7403:function(e,s,t){"use strict";t.r(s),t.d(s,{AuthGuard:function(){return d},useRoleAccess:function(){return u},withAuth:function(){return o}});var a=t(57437),n=t(2265),i=t(24033),l=t(65251),r=t(86264),c=t(66210);function d(e){let{children:s,requiredRole:t,allowedRoles:d,redirectTo:o="/auth/login"}=e,{user:u,userRole:x,loading:m}=(0,c.useAuth)(),h=(0,i.useRouter)(),g=(0,i.usePathname)(),p=(0,n.useRef)(!1);return((0,n.useEffect)(()=>{if(!m&&!p.current){if(!u){sessionStorage.setItem("redirectAfterLogin",g),g!==o&&(p.current=!0,h.push(o));return}if(t&&x!==t||d&&d.length>0&&(!x||!d.includes(x))){"/unauthorized"!==g&&(p.current=!0,h.push("/unauthorized"));return}}},[u,x,m,t,d]),m)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)(l.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(r.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,a.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!u||t&&x!==t||d&&d.length>0&&(!x||!d.includes(x))?null:(0,a.jsx)(a.Fragment,{children:s})}function o(e,s){return function(t){return(0,a.jsx)(d,{requiredRole:s,children:(0,a.jsx)(e,{...t})})}}function u(){let{userRole:e}=(0,c.useAuth)(),s=s=>e===s,t=s=>!!e&&s.includes(e);return{hasRole:s,hasAnyRole:t,isAdmin:()=>s("OrgAdmin"),isStaff:()=>s("Staff"),isContractor:()=>s("Contractor"),isReviewer:()=>s("Reviewer"),isAuditor:()=>s("Auditor"),canManageProjects:()=>t(["OrgAdmin","Staff"]),canViewFinancials:()=>t(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>t(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>t(["Auditor","OrgAdmin"])}}},14374:function(e,s,t){"use strict";t.d(s,{$9:function(){return n},DY:function(){return a},qf:function(){return i}});let a={beginner:{level:"beginner",label:"初級",description:"経験年数3年未満、未経験",color:"bg-green-100 text-green-800"},intermediate:{level:"intermediate",label:"中級",description:"経験年数3年以上7年未満",color:"bg-yellow-100 text-yellow-800"},advanced:{level:"advanced",label:"上級",description:"経験年数7年以上",color:"bg-red-100 text-red-800"}};function n(e,s){if(0===s.length||s.every(e=>"未経験"===e))return"beginner";let t=parseInt(e||"0",10);return t<3?"beginner":t<7?"intermediate":"advanced"}function i(e){return a[e]}}},function(e){e.O(0,[14,402,440,250,228,97,643,971,938,744],function(){return e(e.s=99836)}),_N_E=e.O()}]);