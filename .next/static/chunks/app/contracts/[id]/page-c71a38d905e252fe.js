(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589,97],{11981:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(62898).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},73067:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(62898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},13008:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(62898).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},76637:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(62898).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},86264:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},83288:function(e,t,r){Promise.resolve().then(r.bind(r,87323))},87323:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return j}});var n=r(57437),s=r(2265),a=r(65251),i=r(11981),l=r(73067),o=r(76637),c=r(13008);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,r(62898).Z)("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var u=r(575),h=r(15671),x=r(33277),g=r(66210),m=r(7403),f=r(24033),b=r(14958);function p(){let{userProfile:e,userRole:t}=(0,g.useAuth)(),r=(0,f.useRouter)(),m=(0,f.useParams)().id,[p,j]=(0,s.useState)(null),[y,v]=(0,s.useState)(!0),[w,N]=(0,s.useState)(null),[D,_]=(0,s.useState)(!1),k=async()=>{if(!m){N("契約IDが指定されていません"),v(!1);return}try{v(!0);let{data:{session:e},error:t}=await b.OQ.auth.getSession();if(t||!e){console.error("セッション取得エラー:",t),N("認証が必要です");return}let r=await fetch("/api/contracts/".concat(m),{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}});if(r.ok){let e=await r.json();j(e.contract)}else{let e=await r.json();N(e.message||"契約情報の取得に失敗しました")}}catch(e){console.error("データ取得エラー:",e),N("データの取得に失敗しました")}finally{v(!1)}};(0,s.useEffect)(()=>{e&&t&&m&&k()},[e,t,m]);let C=async()=>{if(!p){N("契約情報が見つかりません");return}try{_(!0);let{data:{session:e},error:t}=await b.OQ.auth.getSession();if(t||!e){console.error("セッション取得エラー:",t),N("認証が必要です");return}let r=await fetch("/api/contracts/".concat(m,"/sign"),{method:"POST",headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}}),n=await r.json();r.ok?(await k(),alert("契約に署名しました")):N(n.message||"署名に失敗しました")}catch(e){console.error("署名エラー:",e),N("サーバーエラーが発生しました")}finally{_(!1)}};return y?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"契約情報を読み込み中..."})]})}):e&&t?w?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,n.jsx)(i.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:w}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(u.z,{onClick:k,variant:"engineering",children:"再試行"}),(0,n.jsx)(u.z,{onClick:()=>r.push("/contracts"),variant:"outline",children:"契約一覧に戻る"})]})]})}):p?"Contractor"===t&&p.contractor_id!==e.id?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,n.jsx)(i.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"この契約にアクセスする権限がありません。"}),(0,n.jsx)(u.z,{onClick:()=>r.push("/contracts"),variant:"engineering",children:"契約一覧に戻る"})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh",children:(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)(a.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)(u.z,{variant:"ghost",onClick:()=>r.push("/contracts"),className:"mb-4",children:[(0,n.jsx)(l.Z,{className:"w-4 h-4 mr-2"}),"契約一覧に戻る"]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"契約詳細"}),(0,n.jsx)("p",{className:"text-gray-600",children:p.project_title})]}),(e=>{switch(e){case"pending":return(0,n.jsx)(x.C,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"署名待ち"});case"signed":return(0,n.jsx)(x.C,{variant:"default",className:"bg-green-100 text-green-800",children:"署名済み"});case"completed":return(0,n.jsx)(x.C,{variant:"default",className:"bg-blue-100 text-blue-800",children:"完了"});default:return(0,n.jsx)(x.C,{variant:"outline",children:e})}})(p.status)]})]}),(0,n.jsxs)("div",{className:"grid gap-6",children:[(0,n.jsxs)(h.Zb,{className:"p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,n.jsx)(o.Z,{className:"w-5 h-5 mr-2"}),"契約基本情報"]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"契約金額:"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-engineering-blue",children:["\xa5",p.bid_amount.toLocaleString()]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"契約期間:"}),(0,n.jsxs)("p",{className:"text-gray-900",children:[new Date(p.start_date).toLocaleDateString("ja-JP")," - ",new Date(p.end_date).toLocaleDateString("ja-JP")]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"発注者:"}),(0,n.jsx)("p",{className:"font-medium text-gray-900",children:p.org_name})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"受注者:"}),(0,n.jsx)("p",{className:"font-medium text-gray-900",children:p.contractor_name})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"契約作成日:"}),(0,n.jsx)("p",{className:"text-gray-900",children:new Date(p.created_at).toLocaleString("ja-JP")})]}),p.signed_at&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"署名日:"}),(0,n.jsx)("p",{className:"text-gray-900",children:new Date(p.signed_at).toLocaleString("ja-JP")})]})]})]})]}),(0,n.jsxs)(h.Zb,{className:"p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,n.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"契約内容"]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"契約条件"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-blue-700",children:"案件名:"}),(0,n.jsx)("span",{className:"text-blue-900",children:p.contract_title})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-blue-700",children:"契約金額:"}),(0,n.jsxs)("span",{className:"font-medium text-blue-900",children:["\xa5",p.bid_amount.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-blue-700",children:"契約期間:"}),(0,n.jsxs)("span",{className:"text-blue-900",children:[new Date(p.start_date).toLocaleDateString("ja-JP")," - ",new Date(p.end_date).toLocaleDateString("ja-JP")]})]})]})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"契約書内容"}),(0,n.jsx)("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:p.contract_content})]}),(0,n.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-yellow-900 mb-2",children:"契約条項"}),(0,n.jsxs)("ul",{className:"text-sm text-yellow-800 space-y-1",children:[(0,n.jsx)("li",{children:"• 受注者は契約期間内に案件を完了する義務があります"}),(0,n.jsx)("li",{children:"• 発注者は契約金額を契約完了後に支払います"}),(0,n.jsx)("li",{children:"• 品質基準に満たない場合は再作業が必要です"}),(0,n.jsx)("li",{children:"• 契約の変更は双方の合意が必要です"})]})]})]})]}),"Contractor"===t&&"pending_contractor"===p.status&&(0,n.jsxs)(h.Zb,{className:"p-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,n.jsx)(d,{className:"w-5 h-5 mr-2"}),"署名"]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-yellow-900 mb-2",children:"署名前の確認"}),(0,n.jsxs)("ul",{className:"text-sm text-yellow-800 space-y-1",children:[(0,n.jsx)("li",{children:"• 契約内容を十分に確認してください"}),(0,n.jsx)("li",{children:"• 署名後は契約が有効になります"}),(0,n.jsx)("li",{children:"• 署名後はチャットルームでやりとりが可能になります"})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.z,{onClick:C,disabled:D,variant:"engineering",className:"min-w-[120px]",children:D?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"署名中..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d,{className:"w-4 h-4 mr-2"}),"契約に署名"]})})})]})]}),"signed"===p.status&&(0,n.jsx)(h.Zb,{className:"p-6",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(c.Z,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"契約が署名済みです"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"この契約は有効です。チャットルームでやりとりを開始できます。"}),(0,n.jsx)(u.z,{onClick:()=>r.push("/chat"),variant:"engineering",children:"チャットルームへ"})]})})]})]})})}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,n.jsx)(i.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"契約が見つかりません"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"指定された契約が見つかりません。"}),(0,n.jsx)(u.z,{onClick:()=>r.push("/contracts"),variant:"engineering",children:"契約一覧に戻る"})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"ログインが必要です"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"契約詳細ページにアクセスするにはログインしてください。"}),(0,n.jsx)(u.z,{onClick:()=>window.location.href="/auth/login",variant:"engineering",children:"ログインページへ"})]})})}function j(){return(0,n.jsx)(m.AuthGuard,{children:(0,n.jsx)(p,{})})}},7403:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthGuard:function(){return c},useRoleAccess:function(){return u},withAuth:function(){return d}});var n=r(57437),s=r(2265),a=r(24033),i=r(65251),l=r(86264),o=r(66210);function c(e){let{children:t,requiredRole:r,allowedRoles:c,redirectTo:d="/auth/login"}=e,{user:u,userRole:h,loading:x}=(0,o.useAuth)(),g=(0,a.useRouter)(),m=(0,a.usePathname)(),f=(0,s.useRef)(!1);return((0,s.useEffect)(()=>{if(!x&&!f.current){if(!u){sessionStorage.setItem("redirectAfterLogin",m),m!==d&&(f.current=!0,g.push(d));return}if(r&&h!==r||c&&c.length>0&&(!h||!c.includes(h))){"/unauthorized"!==m&&(f.current=!0,g.push("/unauthorized"));return}}},[u,h,x,r,c]),x)?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,n.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,n.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!u||r&&h!==r||c&&c.length>0&&(!h||!c.includes(h))?null:(0,n.jsx)(n.Fragment,{children:t})}function d(e,t){return function(r){return(0,n.jsx)(c,{requiredRole:t,children:(0,n.jsx)(e,{...r})})}}function u(){let{userRole:e}=(0,o.useAuth)(),t=t=>e===t,r=t=>!!e&&t.includes(e);return{hasRole:t,hasAnyRole:r,isAdmin:()=>t("OrgAdmin"),isStaff:()=>t("Staff"),isContractor:()=>t("Contractor"),isReviewer:()=>t("Reviewer"),isAuditor:()=>t("Auditor"),canManageProjects:()=>r(["OrgAdmin","Staff"]),canViewFinancials:()=>r(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>r(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>r(["Auditor","OrgAdmin"])}}},33277:function(e,t,r){"use strict";r.d(t,{C:function(){return l}});var n=r(57437);r(2265);var s=r(96061),a=r(22169);let i=(0,s.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600",engineering:"border-engineering-blue bg-engineering-blue/10 text-engineering-blue",glass:"glass text-gray-700 border-white/30"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...s}=e;return(0,n.jsx)("div",{className:(0,a.cn)(i({variant:r}),t),...s})}},575:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(57437),s=r(2265),a=r(54949),i=r(96061),l=r(22169);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:i,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:s,size:i,className:r})),ref:t,...d})});c.displayName="Button"},15671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var n=r(57437),s=r(2265),a=r(22169);let i=s.forwardRef((e,t)=>{let{className:r,variant:s="default",...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow-sm","glass"===s&&"glass backdrop-blur-md","gradient"===s&&"gradient-engineering text-white border-0","engineering"===s&&"border-engineering-blue/20 bg-gradient-to-br from-white to-engineering-blue/5 hover-lift",r),...i})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},66210:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return o},useAuth:function(){return l}});var n=r(57437),s=r(2265),a=r(14958);let i=(0,s.createContext)(void 0);function l(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function o(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[h,x]=(0,s.useState)(null),[g,m]=(0,s.useState)(!0),f=(0,s.useRef)(null);(0,s.useEffect)(()=>{(async()=>{try{var e,t,r;console.log("AuthProvider: 初期セッション取得開始");let{data:{session:n},error:s}=await a.OQ.auth.getSession();if(s){console.error("AuthProvider: セッション取得エラー:",s),m(!1);return}console.log("AuthProvider: セッション取得結果:",{hasSession:!!n,userId:null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.id,hasAccessToken:!!(null==n?void 0:n.access_token),tokenLength:null==n?void 0:null===(t=n.access_token)||void 0===t?void 0:t.length}),l(null!==(r=null==n?void 0:n.user)&&void 0!==r?r:null),(null==n?void 0:n.user)&&(null==n?void 0:n.access_token)?(console.log("\uD83D\uDE80 AuthProvider: 初期セッション - ユーザープロフィール取得開始"),setTimeout(()=>{console.log("⏱️ setTimeout実行: fetchUserProfile呼び出し (初期セッション)"),b(n.user.id)},0)):console.log("AuthProvider: セッションまたはトークンなし、ローディング終了")}catch(e){console.error("AuthProvider: 初期化エラー:",e),l(null),c(null),u(null),x(null)}finally{m(!1)}})();let{data:{subscription:e}}=a.OQ.auth.onAuthStateChange(async(e,t)=>{var r,n;let s=new Date().toISOString();console.log("\uD83D\uDD04 [".concat(s,"] Auth state change:"),{event:e,userId:null==t?void 0:null===(r=t.user)||void 0===r?void 0:r.id,hasToken:!!(null==t?void 0:t.access_token)}),l(null!==(n=null==t?void 0:t.user)&&void 0!==n?n:null),(null==t?void 0:t.user)&&"SIGNED_IN"===e?(console.log("\uD83D\uDD11 [".concat(s,"] Auth state change: SIGNED_IN, fetching profile")),setTimeout(()=>{console.log("⏱️ [".concat(s,"] setTimeout実行: fetchUserProfile呼び出し (SIGNED_IN)")),b(t.user.id)},0)):"SIGNED_OUT"===e&&(console.log("Auth state change: SIGNED_OUT, clearing profile"),c(null),u(null),x(null)),"INITIAL_SESSION"!==e&&m(!1)});return()=>e.unsubscribe()},[]);let b=async e=>{var t;let r=new Date().toISOString(),n=null===(t=Error().stack)||void 0===t?void 0:t.split("\n").slice(1,4).join(" -> ");if(console.log("\uD83D\uDD0D [".concat(r,"] fetchUserProfile: 開始"),{authUserId:e,fetchingRef:f.current,callStack:n}),f.current===e){console.log("⚠️ [".concat(r,"] fetchUserProfile: 既に実行中のためスキップ"),{authUserId:e});return}f.current=e,console.log("\uD83C\uDFC3 [".concat(r,"] fetchUserProfile: 実行開始"),{authUserId:e});try{console.log("fetchUserProfile: ユーザープロフィール取得開始");let{data:t,error:r}=await a.OQ.from("users").select("*").eq("auth_user_id",e).single();if(console.log("fetchUserProfile: ユーザープロフィール結果",{profile:null==t?void 0:t.id,error:null==r?void 0:r.message}),r&&"PGRST116"!==r.code){console.error("Error fetching user profile:",r);return}if(c(t),t){console.log("fetchUserProfile: メンバーシップ取得開始",{profileId:t.id});let{data:e,error:r}=await a.OQ.from("memberships").select("role, org_id").eq("user_id",t.id).single();if(console.log("fetchUserProfile: メンバーシップ結果",{role:null==e?void 0:e.role,org_id:null==e?void 0:e.org_id,error:null==r?void 0:r.message}),r&&"PGRST116"!==r.code){console.error("Error fetching user role:",r);return}if(u((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:t,error:r}=await a.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();r?(console.error("Error fetching organization:",r),x(null)):x({id:t.id,name:t.name})}else x(null);console.log("fetchUserProfile: 完了",{role:null==e?void 0:e.role,organization:null==e?void 0:e.org_id})}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{f.current=null,console.log("✅ [".concat(r,"] fetchUserProfile: 実行完了"),{authUserId:e})}},p=async(e,t)=>{console.log("signIn: 開始",{email:e}),m(!0);try{var r;console.log("signIn: Supabase認証開始");let n=a.OQ.auth.signInWithPassword({email:e,password:t}),s=new Promise((e,t)=>{setTimeout(()=>t(Error("認証タイムアウト（30秒）")),3e4)}),{data:i,error:l}=await Promise.race([n,s]);if(console.log("signIn: Supabase認証結果",{data:null==i?void 0:null===(r=i.user)||void 0===r?void 0:r.id,error:null==l?void 0:l.message}),l)throw l;console.log("signIn: 認証成功"),(null==i?void 0:i.user)&&(console.log("signIn: ユーザープロフィール取得開始"),setTimeout(()=>{b(i.user.id)},50),console.log("signIn: ユーザープロフィール取得完了"))}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{console.log("signIn: 終了"),m(!1)}},j=async(e,t,r)=>{m(!0);try{let{data:n,error:s}=await a.OQ.auth.signUp({email:e,password:t,options:{data:{display_name:r.display_name,specialties:r.specialties||[],qualifications:r.qualifications||[]}}});if(s)throw s;if(n.user){let{error:e}=await a.OQ.from("users").insert({auth_user_id:n.user.id,email:n.user.email,display_name:r.display_name||"",specialties:r.specialties||[],qualifications:r.qualifications||[],experience_years:r.experience_years});e&&console.error("Error creating user profile:",e)}}finally{m(!1)}},y=async()=>{m(!0);try{let{error:e}=await a.OQ.auth.signOut();if(e)throw e;l(null),c(null),u(null)}finally{m(!1)}},v=async e=>{if(!o)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{console.log("updateProfile: 更新開始",{userId:o.id,updates:e});let{data:t,error:r}=await a.OQ.from("users").update(e).eq("id",o.id).select().single();if(r)throw console.error("updateProfile: Supabaseエラー",r),r;console.log("updateProfile: 更新成功",t),c({...o,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,n.jsx)(i.Provider,{value:{user:r,userProfile:o,userRole:d,userOrganization:h,loading:g,signIn:p,signUp:j,signOut:y,updateProfile:v,getRedirectPath:()=>{if(!d)return"/dashboard";switch(d){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:t})}},14958:function(e,t,r){"use strict";r.d(t,{OQ:function(){return s}});var n=r(37440);r(62601);let s=(0,n.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,t,r){"use strict";r.d(t,{XO:function(){return o},cn:function(){return a},xG:function(){return i},z2:function(){return l}});var n=r(57042),s=r(74769);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}function i(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function l(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function o(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}},24033:function(e,t,r){e.exports=r(15313)}},function(e){e.O(0,[14,402,440,971,938,744],function(){return e(e.s=83288)}),_N_E=e.O()}]);