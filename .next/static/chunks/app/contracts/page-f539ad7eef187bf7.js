(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{28203:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(62898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},6141:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(62898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},99670:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(62898).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},86264:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(62898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2882:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(62898).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},99742:function(e,t,s){Promise.resolve().then(s.bind(s,78036))},78036:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(57437),n=s(2265),r=s(65251),i=s(11981),c=s(76637),l=s(28203),d=s(99670),o=s(2882),x=s(6141),m=s(575),h=s(15671),g=s(33277),u=s(66210),j=s(7403),p=s(13332),y=s(24033),b=s(14958);function N(){let{userProfile:e,userRole:t}=(0,u.useAuth)(),s=(0,y.useRouter)(),[j,N]=(0,n.useState)([]),[f,v]=(0,n.useState)([]),[w,_]=(0,n.useState)([]),[k,S]=(0,n.useState)([]),[A,C]=(0,n.useState)(!0),[Z,z]=(0,n.useState)(null),[D,O]=(0,n.useState)("signed"),P=(0,n.useRef)(null),L=async()=>{try{C(!0);let{data:{session:e},error:t}=await b.OQ.auth.getSession();if(t||!e){console.error("セッション取得エラー:",t),z("認証が必要です");return}let s=await fetch("/api/contracts",{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}}),a=await s.json();if(s.ok){let e=a.contracts||[];if(0===e.length)N([]),v([]);else{let t=e.filter(e=>"signed"===e.status||"completed"===e.status),s=e.filter(e=>"pending_contractor"===e.status||"pending_org"===e.status);N(t),v(s)}}else console.error("契約取得エラー:",a.message),z(a.message||"契約データの取得に失敗しました")}catch(e){console.error("契約取得エラー:",e),z("サーバーエラーが発生しました")}finally{C(!1)}},J=async()=>{try{let{data:{session:e},error:t}=await b.OQ.auth.getSession();if(t||!e){console.error("セッション取得エラー:",t);return}let s=await fetch("/api/projects?status=completed",{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}});if(s.ok){let e=await s.json();_(e.projects||[])}}catch(e){console.error("完了案件取得エラー:",e)}},R=async()=>{try{let{data:{session:e},error:t}=await b.OQ.auth.getSession();if(t||!e){console.error("セッション取得エラー:",t);return}let s=await fetch("/api/invoices",{headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"}});if(s.ok){let e=await s.json();S(e.invoices||[])}}catch(e){console.error("請求書取得エラー:",e)}};(0,n.useEffect)(()=>{if(!e||!t){C(!1);return}let s="".concat(e.id,":").concat(t);P.current!==s&&(P.current=s,L(),"OrgAdmin"===t?J():"Contractor"===t&&R())},[e,t]);let E=async e=>{try{let{data:{session:t},error:s}=await b.OQ.auth.getSession();if(s||!t){console.error("セッション取得エラー:",s),z("認証が必要です");return}let a=await fetch("/api/contracts/".concat(e,"/sign"),{method:"POST",headers:{Authorization:"Bearer ".concat(t.access_token),"Content-Type":"application/json"}}),n=await a.json();a.ok?await L():z(n.message||"契約の署名に失敗しました")}catch(e){console.error("契約署名エラー:",e),z("サーバーエラーが発生しました")}},F=async e=>{try{let{data:{session:t},error:s}=await b.OQ.auth.getSession();if(s||!t){console.error("セッション取得エラー:",s),alert("認証が必要です");return}let a=await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t.access_token)},body:JSON.stringify({project_id:e,type:"completion"})}),n=await a.json();a.ok?(alert("業務完了届が作成されました。受注者に通知が送信されます。"),await J()):alert("業務完了届作成に失敗しました: "+n.message)}catch(e){console.error("業務完了届作成エラー:",e),alert("ネットワークエラーが発生しました")}};return A?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e&&t?Z?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,a.jsx)(i.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:Z}),(0,a.jsx)(m.z,{onClick:L,variant:"engineering",children:"再試行"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-mesh",children:[(0,a.jsx)(p.W,{}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"契約管理"}),(0,a.jsx)("p",{className:"text-gray-600",children:"OrgAdmin"===t?"発注者としての契約一覧":"受注者としての契約一覧"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsxs)("button",{onClick:()=>O("signed"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("signed"===D?"border-engineering-blue text-engineering-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["署名済み契約",j.length>0&&(0,a.jsx)("span",{className:"ml-2 bg-engineering-blue text-white text-xs px-2 py-1 rounded-full",children:j.length})]}),(0,a.jsxs)("button",{onClick:()=>O("pending"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("pending"===D?"border-engineering-blue text-engineering-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["署名待ち契約",f.length>0&&(0,a.jsx)("span",{className:"ml-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded-full",children:f.length})]}),(0,a.jsxs)("button",{onClick:()=>O("invoices"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("invoices"===D?"border-engineering-blue text-engineering-blue":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["OrgAdmin"===t?"業務完了届発行":"請求書","OrgAdmin"===t&&w.length>0&&(0,a.jsx)("span",{className:"ml-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:w.length}),"Contractor"===t&&k.length>0&&(0,a.jsx)("span",{className:"ml-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:k.length})]})]})})}),"signed"===D&&(0===j.length?(0,a.jsxs)(h.Zb,{className:"p-8 text-center",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"署名済み契約がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"まだ署名済みの契約がありません。"})]}):(0,a.jsx)("div",{className:"space-y-8",children:Object.values(j.reduce((e,t)=>{let s=new Date(t.created_at),a="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"));return e[a]||(e[a]={monthName:s.toLocaleDateString("ja-JP",{year:"numeric",month:"long"}),contracts:[]}),e[a].contracts.push(t),e},{})).sort((e,t)=>t.monthName.localeCompare(e.monthName)).map((e,n)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5 mr-2"}),e.monthName,(0,a.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",e.contracts.length,"件)"]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:e.contracts.map(e=>(0,a.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsxs)(h.Zb,{className:"p-6 border-l-4 border-l-green-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.project_title}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["契約ID: ",e.id.slice(0,8).toUpperCase()]}),(0,a.jsx)(g.C,{variant:"default",className:"bg-green-100 text-green-800",children:"署名完了"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-engineering-blue",children:["\xa5",e.bid_amount.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["署名日: ",e.signed_at?new Date(e.signed_at).toLocaleDateString("ja-JP"):"不明"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["OrgAdmin"===t?"受注者":"発注者",":"]}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"OrgAdmin"===t?e.contractor_name:e.org_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"契約期間:"}),(0,a.jsxs)("p",{className:"text-gray-900",children:[new Date(e.start_date).toLocaleDateString("ja-JP")," - ",new Date(e.end_date).toLocaleDateString("ja-JP")]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>s.push("/contracts/".concat(e.id)),children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"詳細表示"]}),(0,a.jsxs)(m.z,{variant:"engineering",size:"sm",onClick:()=>s.push("/chat?contractId=".concat(e.id)),children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"チャット開始"]})]})]})},e.id))})]},n))})),"pending"===D&&(0===f.length?(0,a.jsxs)(h.Zb,{className:"p-8 text-center",children:[(0,a.jsx)(x.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"署名待ち契約がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"現在署名待ちの契約はありません。"})]}):(0,a.jsx)("div",{className:"space-y-6",children:f.map(e=>(0,a.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,a.jsxs)(h.Zb,{className:"p-6 border-l-4 border-l-yellow-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.project_title}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["契約ID: ",e.id.slice(0,8).toUpperCase()]}),(0,a.jsx)(g.C,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-300",children:"署名待ち"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-engineering-blue",children:["\xa5",e.bid_amount.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["作成日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["OrgAdmin"===t?"受注者":"発注者",":"]}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"OrgAdmin"===t?e.contractor_name:e.org_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"契約期間:"}),(0,a.jsxs)("p",{className:"text-gray-900",children:[new Date(e.start_date).toLocaleDateString("ja-JP")," - ",new Date(e.end_date).toLocaleDateString("ja-JP")]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>s.push("/contracts/".concat(e.id)),children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"詳細表示"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:["pending_contractor"===e.status&&"Contractor"===t&&(0,a.jsx)(m.z,{onClick:()=>E(e.id),variant:"engineering",size:"sm",children:"署名する"}),"pending_org"===e.status&&"OrgAdmin"===t&&(0,a.jsx)(m.z,{onClick:()=>E(e.id),variant:"engineering",size:"sm",children:"署名する"})]})]}),(0,a.jsx)("div",{className:"border-t pt-4 mt-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"発注者署名:"}),(0,a.jsx)("span",{className:"ml-2 ".concat(e.org_signed_at?"text-green-600":"text-gray-400"),children:e.org_signed_at?new Date(e.org_signed_at).toLocaleString("ja-JP"):"未署名"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"受注者署名:"}),(0,a.jsx)("span",{className:"ml-2 ".concat(e.contractor_signed_at?"text-green-600":"text-gray-400"),children:e.contractor_signed_at?new Date(e.contractor_signed_at).toLocaleString("ja-JP"):"未署名"})]})]})})]})},e.id))})),"invoices"===D&&("OrgAdmin"===t?0===w.length?(0,a.jsxs)(h.Zb,{className:"p-8 text-center",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"完了案件がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"業務完了届発行可能な完了案件がありません。"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"業務完了届発行について"}),(0,a.jsx)("p",{className:"text-sm text-blue-800",children:"完了した案件の業務完了届を発行できます。業務完了届は受注者に送信され、PDF形式でダウンロードも可能です。"})]}),(0,a.jsx)("div",{className:"grid gap-4",children:w.map(e=>(0,a.jsx)(h.Zb,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"受注者:"})," ",e.contractor_name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"完了日:"})," ",new Date(e.end_date).toLocaleDateString("ja-JP")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"契約金額:"})," \xa5",e.budget.toLocaleString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"カテゴリ:"})," ",e.category]})]}),(0,a.jsx)(g.C,{className:"bg-green-100 text-green-800",children:"完了済み"})]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>F(e.id),children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"業務完了届作成"]}),(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>s.push("/contracts/".concat(e.id)),children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"詳細"]})]})]})},e.id))})]}):0===k.length?(0,a.jsxs)(h.Zb,{className:"p-8 text-center",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"請求書がありません"}),(0,a.jsx)("p",{className:"text-gray-600",children:"まだ請求書が発行されていません。"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-green-900 mb-2",children:"請求書について"}),(0,a.jsx)("p",{className:"text-sm text-green-800",children:"発注者から発行された請求書の一覧です。支払い状況を確認し、PDF形式でダウンロードできます。"})]}),(0,a.jsx)("div",{className:"grid gap-4",children:k.map(e=>(0,a.jsx)(h.Zb,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["請求書番号: ",e.invoice_number]}),(0,a.jsx)(g.C,{className:"paid"===e.status?"bg-green-100 text-green-800":"overdue"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:"paid"===e.status?"支払済み":"overdue"===e.status?"支払期限超過":"sent"===e.status?"送信済み":"発行済み"})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"発行日:"})," ",new Date(e.issue_date).toLocaleDateString("ja-JP")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"支払期限:"})," ",new Date(e.due_date).toLocaleDateString("ja-JP")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"税抜金額:"})," \xa5",e.amount.toLocaleString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"税込金額:"})," \xa5",e.total_amount.toLocaleString()]})]}),e.paid_date&&(0,a.jsxs)("div",{className:"text-sm text-green-600 mb-2",children:["支払完了日: ",new Date(e.paid_date).toLocaleDateString("ja-JP")]})]}),(0,a.jsx)("div",{className:"flex gap-2 ml-4",children:(0,a.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>{alert("PDF生成機能は準備中です")},children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"PDF表示"]})})]})},e.id))})]}))]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center bg-white p-8 rounded-lg shadow-xl max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"ログインが必要です"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"契約管理ページにアクセスするにはログインしてください。"}),(0,a.jsx)(m.z,{onClick:()=>window.location.href="/auth/login",variant:"engineering",children:"ログインページへ"})]})})}function f(){return(0,a.jsx)(j.AuthGuard,{allowedRoles:["OrgAdmin","Contractor"],children:(0,a.jsx)(N,{})})}},7403:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthGuard:function(){return d},useRoleAccess:function(){return x},withAuth:function(){return o}});var a=s(57437),n=s(2265),r=s(24033),i=s(65251),c=s(86264),l=s(66210);function d(e){let{children:t,requiredRole:s,allowedRoles:d,redirectTo:o="/auth/login"}=e,{user:x,userRole:m,loading:h}=(0,l.useAuth)(),g=(0,r.useRouter)(),u=(0,r.usePathname)(),j=(0,n.useRef)(!1);return((0,n.useEffect)(()=>{if(!h&&!j.current){if(!x){sessionStorage.setItem("redirectAfterLogin",u),u!==o&&(j.current=!0,g.push(o));return}if(s&&m!==s||d&&d.length>0&&(!m||!d.includes(m))){"/unauthorized"!==u&&(j.current=!0,g.push("/unauthorized"));return}}},[x,m,h,s,d]),h)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(c.Z,{className:"w-8 h-8 text-white animate-spin"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),(0,a.jsx)("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!x||s&&m!==s||d&&d.length>0&&(!m||!d.includes(m))?null:(0,a.jsx)(a.Fragment,{children:t})}function o(e,t){return function(s){return(0,a.jsx)(d,{requiredRole:t,children:(0,a.jsx)(e,{...s})})}}function x(){let{userRole:e}=(0,l.useAuth)(),t=t=>e===t,s=t=>!!e&&t.includes(e);return{hasRole:t,hasAnyRole:s,isAdmin:()=>t("OrgAdmin"),isStaff:()=>t("Staff"),isContractor:()=>t("Contractor"),isReviewer:()=>t("Reviewer"),isAuditor:()=>t("Auditor"),canManageProjects:()=>s(["OrgAdmin","Staff"]),canViewFinancials:()=>s(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>s(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>s(["Auditor","OrgAdmin"])}}}},function(e){e.O(0,[14,402,440,250,228,97,643,971,938,744],function(){return e(e.s=99742)}),_N_E=e.O()}]);