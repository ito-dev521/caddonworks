"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[650],{65592:function(e,t,r){r.d(t,{W:function(){return P}});var a=r(57437),n=r(2265),i=r(61396),s=r.n(i),l=r(24033),o=r(65251),c=r(77480),d=r(25750),u=r(92457),h=r(29409),g=r(93167),f=r(32176),x=r(76637),m=r(55340),b=r(68004),p=r(83523),v=r(67972),y=r(65883),w=r(82549),j=r(575),N=r(33277),_=r(66210),k=r(14958),C=r(22169),Z=r(62167),z=r(37006),I=r(62442),S=r(11981),A=r(3021);function E(){let{user:e}=(0,_.useAuth)(),t=(0,l.useRouter)(),[r,i]=(0,n.useState)([]),[s,c]=(0,n.useState)(0),[d,u]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),f=async()=>{if(e)try{g(!0);let{data:{session:e}}=await k.OQ.auth.getSession();if(!e)return;let t=await fetch("/api/notifications",{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(t.ok){let e=await t.json();i(e.notifications||[]),c(e.unreadCount||0)}}catch(e){console.error("通知取得エラー:",e)}finally{g(!1)}},b=async t=>{if(e)try{let{data:{session:e}}=await k.OQ.auth.getSession();if(!e)return;(await fetch("/api/notifications",{method:"PUT",headers:{Authorization:"Bearer ".concat(e.access_token),"Content-Type":"application/json"},body:JSON.stringify({notificationId:t,action:"mark_read"})})).ok&&(i(e=>e.map(e=>e.id===t?{...e,read_at:new Date().toISOString()}:e)),c(e=>Math.max(0,e-1)))}catch(e){console.error("通知既読エラー:",e)}},p=e=>{switch(e){case"bid_received":return(0,a.jsx)(z.Z,{className:"w-4 h-4 text-blue-600"});case"contract_created":return(0,a.jsx)(x.Z,{className:"w-4 h-4 text-green-600"});case"contract_signed":return(0,a.jsx)(I.Z,{className:"w-4 h-4 text-green-600"});case"evaluation_received":return(0,a.jsx)(m.Z,{className:"w-4 h-4 text-yellow-600"});case"invoice_created":case"invoice":return(0,a.jsx)(x.Z,{className:"w-4 h-4 text-purple-600"});default:return(0,a.jsx)(S.Z,{className:"w-4 h-4 text-gray-600"})}},v=e=>{let t=new Date(e),r=new Date().getTime()-t.getTime();return r<6e4?"たった今":r<36e5?"".concat(Math.floor(r/6e4),"分前"):r<864e5?"".concat(Math.floor(r/36e5),"時間前"):"".concat(Math.floor(r/864e5),"日前")};if((0,n.useEffect)(()=>{if(e){f();let e=setInterval(f,3e4);return()=>clearInterval(e)}},[e]),!e)return null;let y=e=>{if(e.read_at||b(e.id),"bid_received"===e.type){var r,a;(null===(r=e.data)||void 0===r?void 0:r.project_id)&&(null===(a=e.data)||void 0===a?void 0:a.bid_id)?t.push("/contracts/create?projectId=".concat(e.data.project_id,"&bidId=").concat(e.data.bid_id)):t.push("/projects")}else"contract_created"===e.type?t.push("/contracts"):"contract_signed"===e.type?t.push("/contracts"):"evaluation_received"===e.type?t.push("/evaluations"):("invoice"===e.type||"invoice_created"===e.type)&&t.push("/contracts");u(!1)};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>{u(!d)},className:"relative","data-notification-bell":!0,children:[(0,a.jsx)(A.Z,{className:"w-5 h-5"}),s>0&&(0,a.jsx)(N.C,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:s>99?"99+":s})]}),(0,a.jsx)(Z.M,{children:d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>u(!1)}),(0,a.jsxs)(o.E.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:"fixed top-1/3 left-1/3 transform -translate-x-1/2 -translate-y-1/2 w-[28rem] max-w-[calc(100vw-2rem)] bg-white rounded-lg shadow-xl border border-gray-200 z-50",style:{maxHeight:"calc(100vh - 4rem)"},children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"通知"}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",onClick:()=>u(!1),className:"h-6 w-6",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]})}),(0,a.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(100vh - 12rem)"},children:h?(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"読み込み中..."}):0===r.length?(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"通知はありません"}):r.map(e=>(0,a.jsx)("div",{className:"p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ".concat(e.read_at?"":"bg-blue-50"),onClick:()=>y(e),children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-1",children:p(e.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 flex-1 min-w-0",children:(0,a.jsx)("span",{className:"truncate block",children:e.title})}),!e.read_at&&(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full flex-shrink-0"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1 break-words",children:e.message.length>100?"".concat(e.message.substring(0,100),"..."):e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:v(e.created_at)})]})]})},e.id))}),r.length>0&&(0,a.jsx)("div",{className:"p-3 border-t border-gray-200",children:(0,a.jsx)(j.z,{variant:"ghost",size:"sm",className:"w-full text-sm",onClick:()=>{r.forEach(e=>{e.read_at||b(e.id)})},children:"全て既読にする"})})]})]})})]})}let O=(e,t)=>{let r={Admin:[{icon:c.Z,label:"ダッシュボード",href:"/dashboard",badge:null},{icon:d.Z,label:"会員管理",href:"/admin/users",badge:null},{icon:u.Z,label:"統計・レポート",href:"/admin/reports",badge:null},{icon:h.Z,label:"システム設定",href:"/admin/settings",badge:null}],OrgAdmin:[{icon:c.Z,label:"ダッシュボード",href:"/dashboard",badge:null},{icon:g.Z,label:"案件管理",href:"/projects",badge:t.projects||null},{icon:f.Z,label:"チャット",href:"/chat",badge:t.chat||null},{icon:x.Z,label:"契約管理",href:"/contracts",badge:t.contracts||null},{icon:u.Z,label:"会計・請求",href:"/billing",badge:"新"},{icon:d.Z,label:"お気に入り会員",href:"/favorites",badge:null}],Contractor:[{icon:c.Z,label:"ダッシュボード",href:"/dashboard",badge:null},{icon:g.Z,label:"案件一覧",href:"/jobs",badge:t.jobs||null},{icon:f.Z,label:"チャット",href:"/chat",badge:t.chat||null},{icon:m.Z,label:"受注者評価",href:"/evaluations",badge:null},{icon:x.Z,label:"請求書管理",href:"/invoices",badge:null},{icon:x.Z,label:"提出物",href:"/deliverables",badge:t.deliverables||null},{icon:u.Z,label:"報酬・支払",href:"/payouts",badge:null}],Reviewer:[{icon:c.Z,label:"ダッシュボード",href:"/dashboard",badge:null},{icon:g.Z,label:"審査案件",href:"/reviews",badge:t.reviews||null},{icon:f.Z,label:"チャット",href:"/chat",badge:t.chat||null},{icon:x.Z,label:"評価履歴",href:"/evaluations",badge:null}],Auditor:[{icon:c.Z,label:"ダッシュボード",href:"/dashboard",badge:null},{icon:x.Z,label:"監査ログ",href:"/audit-logs",badge:null},{icon:f.Z,label:"チャット",href:"/chat",badge:null},{icon:u.Z,label:"レポート",href:"/reports",badge:null}]};return r[e]||r.Admin};function P(e){var t;let{userRole:r}=e,{user:i,userProfile:c,userRole:d,userOrganization:u,signOut:g}=(0,_.useAuth)(),{badges:f,loading:x}=function(){let{userRole:e,user:t}=(0,_.useAuth)(),[r,a]=(0,n.useState)({}),[i,s]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let r=async()=>{if(!t||!e){s(!1);return}try{var r,n,i,l,o,c,d,u;let{data:{session:t}}=await k.OQ.auth.getSession();if(!(null==t?void 0:t.access_token)){s(!1);return}let h={Authorization:"Bearer ".concat(t.access_token)},g={};switch(e){case"OrgAdmin":try{let[e,t,a]=await Promise.all([fetch("/api/projects",{headers:h}),fetch("/api/chat/rooms",{headers:h}),fetch("/api/contracts",{headers:h})]);if(e.ok){let t=await e.json();g.projects=(null===(r=t.projects)||void 0===r?void 0:r.length)||0}if(t.ok){let e=await t.json();g.chat=(null===(n=e.rooms)||void 0===n?void 0:n.filter(e=>e.unread_count>0).length)||0}if(a.ok){let e=await a.json();g.contracts=(null===(i=e.contracts)||void 0===i?void 0:i.length)||0}}catch(e){console.error("OrgAdmin badges fetch error:",e)}break;case"Contractor":try{let[e,t,r]=await Promise.all([fetch("/api/jobs",{headers:h}),fetch("/api/chat/rooms",{headers:h}),fetch("/api/deliverables",{headers:h})]);if(e.ok){let t=await e.json();g.jobs=(null===(l=t.jobs)||void 0===l?void 0:l.length)||0}if(t.ok){let e=await t.json();g.chat=(null===(o=e.rooms)||void 0===o?void 0:o.filter(e=>e.unread_count>0).length)||0}if(r.ok){let e=await r.json();g.deliverables=(null===(c=e.deliverables)||void 0===c?void 0:c.length)||0}}catch(e){console.error("Contractor badges fetch error:",e)}break;case"Reviewer":try{let[e,t]=await Promise.all([fetch("/api/reviews",{headers:h}),fetch("/api/chat/rooms",{headers:h})]);if(e.ok){let t=await e.json();g.reviews=(null===(d=t.reviews)||void 0===d?void 0:d.length)||0}if(t.ok){let e=await t.json();g.chat=(null===(u=e.rooms)||void 0===u?void 0:u.filter(e=>e.unread_count>0).length)||0}}catch(e){console.error("Reviewer badges fetch error:",e)}}a(g)}catch(e){console.error("Badges fetch error:",e)}finally{s(!1)}};r();let n=setInterval(r,3e4);return()=>clearInterval(n)},[t,e]),{badges:r,loading:i}}(),m=(0,l.useRouter)(),Z=(0,l.usePathname)(),[z,I]=(0,n.useState)(!0),[S,A]=(0,n.useState)(!1),[P,D]=(0,n.useState)(null),R=(0,n.useRef)(!1);(0,n.useEffect)(()=>{let e=sessionStorage.getItem("currentPage");sessionStorage.setItem("currentPage",Z),e&&e!==Z&&sessionStorage.setItem("previousPage",e)},[Z]),(0,n.useEffect)(()=>{let e=async()=>{if("OrgAdmin"===d&&(null==u?void 0:u.id)&&null===P&&!R.current){R.current=!0;try{let{data:{session:t}}=await k.OQ.auth.getSession();if(!(null==t?void 0:t.access_token)){console.error("認証トークンが取得できません"),R.current=!1;return}let r=await fetch("/api/organization/profile",{headers:{Authorization:"Bearer ".concat(t.access_token)}});if(r.ok){let t=await r.json();if(t.organization){var e;D((null===(e=t.organization)||void 0===e?void 0:e.contact_person)||null)}}else console.error("組織情報API失敗:",r.status),R.current=!1}catch(e){console.error("組織情報の取得に失敗しました:",e),R.current=!1}}};"OrgAdmin"===d&&(null==u?void 0:u.id)&&null===P&&!R.current&&e()},[d,null==u?void 0:u.id,P]);let Q=O(d||"Admin",f),T=()=>"OrgAdmin"===d?P||(null==c?void 0:c.display_name)||"ユーザー":(null==c?void 0:c.display_name)||"ユーザー";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.E.nav,{initial:{x:-250},animate:{x:0},className:(0,C.cn)("hidden md:flex fixed left-0 top-0 h-full bg-white border-r border-gray-200 z-40 transition-all duration-300",z?"w-64":"w-16"),children:(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)(o.E.div,{className:"flex items-center gap-3",animate:{opacity:z?1:0},transition:{duration:.2},children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-engineering-blue rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:"土"})}),z&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-bold text-lg text-engineering-blue",children:"土木プラットフォーム"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Civil Engineering"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[z&&(0,a.jsx)(E,{}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",onClick:()=>I(!z),className:"shrink-0",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("div",{className:"flex-1 px-2 py-4 space-y-2",children:Q.map((e,t)=>(0,a.jsx)(o.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},children:(0,a.jsx)(s(),{href:e.href,children:(0,a.jsxs)("div",{className:(0,C.cn)("flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-engineering-blue/10 transition-colors group relative","hover-lift"),children:[(0,a.jsx)(e.icon,{className:"w-5 h-5 text-gray-600 group-hover:text-engineering-blue"}),(0,a.jsx)(o.E.span,{className:"text-gray-700 group-hover:text-engineering-blue font-medium",animate:{opacity:z?1:0},transition:{duration:.2},children:z?e.label:""}),e.badge&&z&&("number"!=typeof e.badge||e.badge>0)&&(0,a.jsx)(N.C,{variant:"engineering",className:"ml-auto text-xs",children:e.badge}),!z&&(0,a.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50",children:e.label})]})})},e.href))}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsxs)(o.E.div,{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer",animate:{justifyContent:z?"flex-start":"center"},children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-engineering-blue rounded-full flex items-center justify-center overflow-hidden",children:(null==c?void 0:c.avatar_url)?(0,a.jsx)("img",{src:c.avatar_url,alt:T(),className:"w-full h-full object-cover"}):(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:T().charAt(0)||(null==i?void 0:null===(t=i.email)||void 0===t?void 0:t.charAt(0))||"U"})}),(0,a.jsx)(o.E.div,{animate:{opacity:z?1:0},transition:{duration:.2},className:"flex-1",children:z&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:T()}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:d}),u&&(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:u.name})]})}),z&&(0,a.jsx)(p.Z,{className:"w-4 h-4 text-gray-400 group-hover:text-gray-600"})]}),z&&(0,a.jsxs)("div",{className:"absolute bottom-full left-0 right-0 mb-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,a.jsx)(s(),{href:"/profile",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"プロフィール"})]})}),(0,a.jsx)(s(),{href:"/settings",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"設定"})]})}),(0,a.jsx)("hr",{className:"my-2"}),(0,a.jsxs)("button",{onClick:async()=>{await g(),m.push("/")},className:"w-full flex items-center gap-3 px-4 py-2 hover:bg-red-50 transition-colors text-red-600",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"ログアウト"})]})]}),!z&&(0,a.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:T()}),(0,a.jsx)("div",{className:"text-gray-300",children:d}),u&&(0,a.jsx)("div",{className:"text-gray-400",children:u.name})]})})]})})]})}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",className:"md:hidden fixed top-4 left-4 z-50",onClick:()=>A(!0),children:(0,a.jsx)(b.Z,{className:"w-5 h-5"})}),S&&(0,a.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"md:hidden fixed inset-0 bg-black/50 z-50",onClick:()=>A(!1),children:(0,a.jsxs)(o.E.div,{initial:{x:-300},animate:{x:0},exit:{x:-300},className:"w-64 h-full bg-white",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-engineering-blue rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:"土"})}),(0,a.jsx)("h1",{className:"font-bold text-lg text-engineering-blue",children:"土木プラットフォーム"})]}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon",onClick:()=>A(!1),children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"p-4 space-y-2",children:Q.map(e=>(0,a.jsx)(s(),{href:e.href,onClick:()=>A(!1),children:(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-engineering-blue/10 transition-colors",children:[(0,a.jsx)(e.icon,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:e.label}),e.badge&&("number"!=typeof e.badge||e.badge>0)&&(0,a.jsx)(N.C,{variant:"engineering",className:"ml-auto text-xs",children:e.badge})]})},e.href))})]})})]})}},33277:function(e,t,r){r.d(t,{C:function(){return l}});var a=r(57437);r(2265);var n=r(96061),i=r(22169);let s=(0,n.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600",engineering:"border-engineering-blue bg-engineering-blue/10 text-engineering-blue",glass:"glass text-gray-700 border-white/30"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...n}=e;return(0,a.jsx)("div",{className:(0,i.cn)(s({variant:r}),t),...n})}},575:function(e,t,r){r.d(t,{z:function(){return c}});var a=r(57437),n=r(2265),i=r(54949),s=r(96061),l=r(22169);let o=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:r,variant:n,size:s,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:n,size:s,className:r})),ref:t,...d})});c.displayName="Button"},15671:function(e,t,r){r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return s},aY:function(){return d},ll:function(){return o}});var a=r(57437),n=r(2265),i=r(22169);let s=n.forwardRef((e,t)=>{let{className:r,variant:n="default",...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow-sm","glass"===n&&"glass backdrop-blur-md","gradient"===n&&"gradient-engineering text-white border-0","engineering"===n&&"border-engineering-blue/20 bg-gradient-to-br from-white to-engineering-blue/5 hover-lift",r),...s})});s.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...n})});l.displayName="CardHeader";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,i.cn)("font-semibold leading-none tracking-tight",r),...n})});o.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},66210:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return o},useAuth:function(){return l}});var a=r(57437),n=r(2265),i=r(14958);let s=(0,n.createContext)(void 0);function l(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function o(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,g]=(0,n.useState)(null),[f,x]=(0,n.useState)(!0),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{try{var e;let{data:{session:t},error:r}=await i.OQ.auth.getSession();if(r){console.error("AuthProvider: セッション取得エラー:",r),x(!1);return}l(null!==(e=null==t?void 0:t.user)&&void 0!==e?e:null),(null==t?void 0:t.user)&&(null==t?void 0:t.access_token)?setTimeout(()=>{b(t.user.id)},0):x(!1)}catch(e){console.error("AuthProvider: 初期化エラー:",e),l(null),c(null),u(null),g(null),x(!1)}})();let{data:{subscription:e}}=i.OQ.auth.onAuthStateChange(async(e,t)=>{var r;l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),(null==t?void 0:t.user)&&"SIGNED_IN"===e?setTimeout(()=>{b(t.user.id)},0):"SIGNED_OUT"===e&&(c(null),u(null),g(null)),"INITIAL_SESSION"!==e&&x(!1)});return()=>e.unsubscribe()},[]);let b=async e=>{if(m.current!==e){m.current=e;try{let{data:t,error:r}=await i.OQ.from("users").select("*").eq("auth_user_id",e).single();if(r&&"PGRST116"!==r.code){console.error("Error fetching user profile:",r);return}if(c(t),t){let{data:e,error:r}=await i.OQ.from("memberships").select("role, org_id").eq("user_id",t.id).single();if(r&&"PGRST116"!==r.code){console.error("Error fetching user role:",r);return}if(u((null==e?void 0:e.role)||null),null==e?void 0:e.org_id){let{data:t,error:r}=await i.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();r?(console.error("Error fetching organization:",r),g(null)):g({id:t.id,name:t.name})}else g(null)}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{m.current=null,x(!1)}}},p=async(e,t)=>{x(!0);try{let r=i.OQ.auth.signInWithPassword({email:e,password:t}),a=new Promise((e,t)=>{setTimeout(()=>t(Error("認証タイムアウト（30秒）")),3e4)}),{data:n,error:s}=await Promise.race([r,a]);if(s)throw s;(null==n?void 0:n.user)&&setTimeout(()=>{b(n.user.id)},50)}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{x(!1)}},v=async(e,t,r)=>{x(!0);try{let{data:a,error:n}=await i.OQ.auth.signUp({email:e,password:t,options:{data:{display_name:r.display_name,specialties:r.specialties||[],qualifications:r.qualifications||[]}}});if(n)throw n;if(a.user){let{error:e}=await i.OQ.from("users").insert({auth_user_id:a.user.id,email:a.user.email,display_name:r.display_name||"",specialties:r.specialties||[],qualifications:r.qualifications||[],experience_years:r.experience_years});e&&console.error("Error creating user profile:",e)}}finally{x(!1)}},y=async()=>{x(!0);try{let{error:e}=await i.OQ.auth.signOut();if(e)throw e;l(null),c(null),u(null)}finally{x(!1)}},w=async e=>{if(!o)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{let{data:t,error:r}=await i.OQ.from("users").update(e).eq("id",o.id).select().single();if(r)throw console.error("updateProfile: Supabaseエラー",r),r;c({...o,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return(0,a.jsx)(s.Provider,{value:{user:r,userProfile:o,userRole:d,userOrganization:h,loading:f,signIn:p,signUp:v,signOut:y,updateProfile:w,getRedirectPath:()=>{if(!d)return"/dashboard";switch(d){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:t})}},14958:function(e,t,r){r.d(t,{OQ:function(){return n}});var a=r(37440);r(62601);let n=(0,a.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},22169:function(e,t,r){r.d(t,{XO:function(){return o},cn:function(){return i},xG:function(){return s},z2:function(){return l}});var a=r(57042),n=r(74769);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}function s(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function l(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function o(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}}}]);