(()=>{var e={};e.id=7640,e.ids=[7640],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},90241:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.ZP,__next_app__:()=>u,originalPathname:()=>d,pages:()=>o,routeModule:()=>m,tree:()=>c});var r=s(50482),a=s(69108),n=s(83543),i=s(68300),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);s.d(t,l);let c=["",{children:["(dashboard)",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,92524)),"/Users/sayuri/caddonworks/src/app/(dashboard)/chat/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,61623)),"/Users/sayuri/caddonworks/src/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,24117)),"/Users/sayuri/caddonworks/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,48206)),"/Users/sayuri/caddonworks/src/app/not-found.tsx"]}],o=["/Users/sayuri/caddonworks/src/app/(dashboard)/chat/page.tsx"],d="/(dashboard)/chat/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(dashboard)/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},23655:(e,t,s)=>{Promise.resolve().then(s.bind(s,76586)),Promise.resolve().then(s.bind(s,6898))},66138:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},63024:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},62312:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},25545:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},96885:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},56515:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]])},42739:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},35851:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},66062:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]])},28765:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},36135:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},13746:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},23485:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},38271:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},18822:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},89895:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},14513:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(69224).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},22254:(e,t,s)=>{e.exports=s(14767)},76586:(e,t,s)=>{"use strict";s.r(t),s.d(t,{AuthGuard:()=>o,useRoleAccess:()=>u,withAuth:()=>d});var r=s(95344),a=s(3729),n=s(22254),i=s(57916),l=s(42739),c=s(43750);function o({children:e,requiredRole:t,allowedRoles:s,redirectTo:o="/auth/login"}){let{user:d,userRole:u,loading:m}=(0,c.useAuth)(),h=(0,n.useRouter)(),x=(0,n.usePathname)(),g=(0,a.useRef)(!1);return((0,a.useEffect)(()=>{if(!m&&!g.current){if(!d){sessionStorage.setItem("redirectAfterLogin",x),x!==o&&(g.current=!0,h.push(o));return}if(t&&u!==t||s&&s.length>0&&(!u||!s.includes(u))){"/unauthorized"!==x&&(g.current=!0,h.push("/unauthorized"));return}}},[d,u,m,t,s]),m)?r.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,r.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:r.jsx(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),r.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!d||t&&u!==t||s&&s.length>0&&(!u||!s.includes(u))?null:r.jsx(r.Fragment,{children:e})}function d(e,t){return function(s){return r.jsx(o,{requiredRole:t,children:r.jsx(e,{...s})})}}function u(){let{userRole:e}=(0,c.useAuth)(),t=t=>e===t,s=t=>!!e&&t.includes(e);return{hasRole:t,hasAnyRole:s,isAdmin:()=>t("OrgAdmin"),isStaff:()=>t("Staff"),isContractor:()=>t("Contractor"),isReviewer:()=>t("Reviewer"),isAuditor:()=>t("Auditor"),canManageProjects:()=>s(["OrgAdmin","Staff"]),canViewFinancials:()=>s(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>s(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>s(["Auditor","OrgAdmin"])}}},6898:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ChatLayout:()=>L});var r=s(95344),a=s(3729),n=s.n(a),i=s(57916),l=s(89895),c=s(13746),o=s(5094),d=s(63024),u=s(28765),m=s(35851),h=s(19591),x=s(43750),g=s(18704),p=s(11453),f=s(22254);function y({selectedRoomId:e,onRoomSelect:t,className:s=""}){let{user:n}=(0,x.useAuth)(),c=(0,f.useRouter)(),[y,v]=(0,a.useState)([]),[j,b]=(0,a.useState)(!0),[w,N]=(0,a.useState)(""),[k,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{n&&(z(),S())},[n]),(0,a.useEffect)(()=>{_(sessionStorage.getItem("previousPage"))},[]);let z=async()=>{if(n)try{let{data:{session:e}}=await g.OQ.auth.getSession();if(!e){console.error("セッションが見つかりません"),b(!1);return}let t=await fetch("/api/chat/rooms",{method:"GET",headers:{Authorization:`Bearer ${e.access_token}`}}),s=await t.json();t.ok?v(s.rooms):(console.error("チャットルーム取得エラー:",s.message),v([]))}catch(e){console.error("チャットルーム取得エラー:",e),v([])}finally{b(!1)}},S=()=>{let e=g.OQ.channel("chat-rooms-changes").on("postgres_changes",{event:"*",schema:"public",table:"chat_rooms"},()=>z()).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages"},()=>z()).subscribe();return()=>{g.OQ.removeChannel(e)}},C=y.filter(e=>e.name.toLowerCase().includes(w.toLowerCase())||e.project_name?.toLowerCase().includes(w.toLowerCase())),Z=e=>{let t=new Date(e),s=new Date,r=Math.floor((s.getTime()-t.getTime())/36e5);return r<1?Math.floor((s.getTime()-t.getTime())/6e4)+"分前":r<24?r+"時間前":t.toLocaleDateString("ja-JP",{month:"numeric",day:"numeric"})};return j?r.jsx("div",{className:(0,p.cn)("flex items-center justify-center h-64",s),children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue"})}):(0,r.jsxs)("div",{className:(0,p.cn)("flex flex-col h-full bg-white",s),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)(o.z,{variant:"ghost",size:"sm",onClick:()=>{k&&"/chat"!==k?c.push(k):c.push("/projects")},className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[r.jsx(d.Z,{className:"w-4 h-4"}),"戻る"]}),r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"チャット"})]})}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"チャットルームを検索...",value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:0===C.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[r.jsx(m.Z,{className:"w-12 h-12 mb-4"}),r.jsx("p",{children:"チャットルームがありません"}),w&&r.jsx("p",{className:"text-sm",children:"検索条件に一致するルームが見つかりません"})]}):r.jsx("div",{className:"space-y-1 p-2",children:C.map(s=>(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,p.cn)("p-3 rounded-lg cursor-pointer transition-colors hover:bg-gray-50",e===s.id&&"bg-engineering-blue/10 border border-engineering-blue/20"),onClick:()=>t(s.id),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h3",{className:"font-medium text-gray-900 truncate",children:s.name}),(s.unread_count||0)>0&&r.jsx(h.C,{variant:"destructive",className:"text-xs px-2 py-0.5",children:(s.unread_count||0)>99?"99+":s.unread_count})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 truncate",children:["プロジェクト: ",s.project_name]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[r.jsx(l.Z,{className:"w-3 h-3"}),r.jsx("span",{children:s.participant_count})]})]}),s.last_message&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"text-xs text-gray-500 truncate",children:s.last_message.sender_name}),r.jsx("span",{className:"text-xs text-gray-400",children:Z(s.last_message.created_at)})]}),r.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.last_message.content})]}),!s.last_message&&r.jsx("p",{className:"text-xs text-gray-400",children:"メッセージがありません"})]},s.id))})})]})}var v=s(73644),j=s(96885),b=s(56515),w=s(69224);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let N=(0,w.Z)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);var k=s(38271);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let _=(0,w.Z)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var z=s(66062),S=s(25545),C=s(36135);function Z({roomId:e,className:t=""}){let{user:s}=(0,x.useAuth)(),[n,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(!0),[h,f]=(0,a.useState)(!1),[y,w]=(0,a.useState)(null),[Z,E]=(0,a.useState)(null),[P,A]=(0,a.useState)(""),[D,M]=(0,a.useState)(!1),[O,q]=(0,a.useState)(null),R=(0,a.useRef)(null),L=(0,a.useRef)(null);(0,a.useEffect)(()=>{e&&(T(),$(),U())},[e]),(0,a.useEffect)(()=>{I()},[n]);let T=async()=>{if(e)try{let{data:{session:t}}=await g.OQ.auth.getSession();if(!t){console.error("セッションが見つかりません"),m(!1);return}let s=await fetch(`/api/chat/messages?room_id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${t.access_token}`}}),r=await s.json();if(s.ok){let t=r.messages?.map(t=>({id:t.id,room_id:e,content:t.content,sender_id:t.sender_id,sender:{id:t.sender_id,display_name:t.sender_name||"Unknown",email:t.sender_email,avatar_url:t.sender_avatar_url},sender_type:t.sender_type,created_at:t.created_at,is_deleted:!1,message_type:t.message_type||"text",file_url:t.file_url,file_name:t.file_name,file_size:t.file_size}))||[];l(t)}else console.error("メッセージ取得エラー:",r.message),l([])}catch(e){console.error("Error fetching messages:",e),l([])}finally{m(!1)}},U=()=>{let t=g.OQ.channel(`chat-messages-${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${e}`},()=>T()).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chat_messages",filter:`room_id=eq.${e}`},()=>T()).subscribe();return()=>{g.OQ.removeChannel(t)}},$=async()=>{if(e&&s)try{await g.OQ.rpc("mark_messages_as_read",{p_room_id:e})}catch(e){console.error("Error marking messages as read:",e)}},I=()=>{R.current?.scrollIntoView({behavior:"smooth"})},B=async t=>{if(t.preventDefault(),c.trim()&&s&&!h){f(!0);try{let{data:{session:t}}=await g.OQ.auth.getSession();if(!t){console.error("セッションが見つかりません");return}let s={room_id:e,content:c.trim(),message_type:"text"},r=await fetch("/api/chat/messages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify(s)}),a=await r.json();r.ok?(d(""),w(null),T()):console.error("メッセージ送信エラー:",a.message)}catch(e){console.error("Error sending message:",e)}finally{f(!1)}}},F=e=>{q(e),A(""),M(!0)},Q=async(t,r="")=>{if(s&&t)try{f(!0);let{data:{session:s}}=await g.OQ.auth.getSession();if(!s){console.error("セッションが見つかりません");return}let a=new FormData;a.append("file",t),a.append("roomId",e),a.append("comment",r),console.log("ファイルアップロード開始:",{fileName:t.name,fileSize:t.size,fileType:t.type,roomId:e,comment:r});let n=await fetch("/api/chat/upload",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`},body:a}),i=await n.json();n.ok?(console.log("ファイルアップロード成功:",i),T(),M(!1),q(null),A("")):(console.error("ファイルアップロードエラー:",i.message),alert("ファイルのアップロードに失敗しました: "+i.message))}catch(e){console.error("Error uploading file:",e),alert("ファイルのアップロードに失敗しました: "+(e instanceof Error?e.message:"不明なエラー"))}finally{f(!1)}},V=async(e,t)=>{try{let{error:r}=await g.OQ.from("chat_messages").update({content:t,edited_at:new Date().toISOString()}).eq("id",e).eq("sender_id",s?.id);if(r)throw r;E(null)}catch(e){console.error("Error editing message:",e)}},G=async e=>{try{let{error:t}=await g.OQ.from("chat_messages").update({is_deleted:!0}).eq("id",e).eq("sender_id",s?.id);if(t)throw t}catch(e){console.error("Error deleting message:",e)}},H=e=>{let t=new Date(e),s=new Date;return t.toDateString()===s.toDateString()?t.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("ja-JP",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})},J=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]};return u?r.jsx("div",{className:(0,p.cn)("flex items-center justify-center h-64",t),children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue"})}):(0,r.jsxs)("div",{className:(0,p.cn)("flex flex-col h-full bg-white",t),children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.jsx(v.M,{children:n.map(e=>{let t=e.sender_id===s?.id,a=!t;return(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:(0,p.cn)("flex gap-3 group",t?"justify-end":"justify-start"),children:[a&&r.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium flex-shrink-0 overflow-hidden",children:e.sender?.avatar_url?r.jsx("img",{src:e.sender.avatar_url,alt:e.sender?.display_name||"User",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-engineering-blue flex items-center justify-center",children:e.sender?.display_name?.charAt(0)||e.sender?.email?.charAt(0)||"U"})}),(0,r.jsxs)("div",{className:(0,p.cn)("flex flex-col max-w-xs sm:max-w-md",t&&"items-end"),children:[(0,r.jsxs)("div",{className:(0,p.cn)("flex items-center gap-2 mb-1 text-xs text-gray-500",t?"flex-row-reverse":"flex-row"),children:[r.jsx("span",{className:"font-medium",children:t?"あなた":e.sender?.display_name||e.sender?.email||"不明"}),r.jsx("span",{children:H(e.created_at)}),e.edited_at&&r.jsx("span",{className:"text-xs text-gray-400",children:"(編集済み)"})]}),e.reply_message&&(0,r.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 border-l-2 border-engineering-blue rounded text-xs",children:[r.jsx("div",{className:"font-medium text-engineering-blue",children:e.reply_message.sender_name}),r.jsx("div",{className:"text-gray-600 truncate",children:e.reply_message.content})]}),(0,r.jsxs)("div",{className:(0,p.cn)("relative px-4 py-2 rounded-2xl max-w-full break-words",t?"bg-engineering-blue text-white":"bg-gray-100 text-gray-900"),children:[Z===e.id?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",defaultValue:e.content,className:"flex-1 bg-transparent border-none outline-none",onKeyDown:t=>{"Enter"===t.key?V(e.id,t.currentTarget.value):"Escape"===t.key&&E(null)},autoFocus:!0}),r.jsx(o.z,{size:"sm",variant:"ghost",onClick:()=>E(null),className:"text-current hover:bg-white/20",children:"キャンセル"})]}):(0,r.jsxs)(r.Fragment,{children:["text"===e.message_type&&r.jsx("p",{children:e.content}),("file"===e.message_type||"image"===e.message_type)&&(0,r.jsxs)("div",{className:"space-y-2",children:[e.content!==e.file_name&&r.jsx("p",{className:"text-sm",children:e.content}),"image"===e.message_type?(0,r.jsxs)("div",{children:[r.jsx("img",{src:e.file_url,alt:e.file_name,className:"max-w-xs rounded-lg"}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[r.jsx("p",{className:"text-xs opacity-75",children:e.file_name}),r.jsx(o.z,{size:"sm",variant:"ghost",className:"text-current hover:bg-white/20 h-6 px-2",onClick:()=>window.open(e.file_url,"_blank"),children:r.jsx(j.Z,{className:"w-3 h-3"})})]})]}):(0,r.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-white/10 rounded-lg",children:[r.jsx(b.Z,{className:"w-4 h-4"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium",children:e.file_name}),e.file_size&&r.jsx("p",{className:"text-xs opacity-75",children:J(e.file_size)})]}),r.jsx(o.z,{size:"sm",variant:"ghost",className:"text-current hover:bg-white/20",onClick:()=>window.open(e.file_url,"_blank"),children:r.jsx(j.Z,{className:"w-3 h-3"})})]})]})]}),t&&Z!==e.id&&r.jsx("div",{className:"absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,r.jsxs)("div",{className:"flex gap-1",children:[r.jsx(o.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white text-gray-600 hover:text-engineering-blue",onClick:()=>E(e.id),children:r.jsx(N,{className:"w-3 h-3"})}),r.jsx(o.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 bg-white text-gray-600 hover:text-red-600",onClick:()=>G(e.id),children:r.jsx(k.Z,{className:"w-3 h-3"})})]})})]}),!t&&(0,r.jsxs)(o.z,{size:"sm",variant:"ghost",className:"mt-1 opacity-0 group-hover:opacity-100 transition-opacity text-xs text-gray-500 hover:text-engineering-blue",onClick:()=>w(e),children:[r.jsx(_,{className:"w-3 h-3 mr-1"}),"返信"]})]})]},e.id)})}),r.jsx("div",{ref:R})]}),y&&r.jsx("div",{className:"px-4 py-2 bg-gray-50 border-t",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-xs text-engineering-blue font-medium",children:[y.sender?.display_name||y.sender?.email,"への返信"]}),r.jsx("div",{className:"text-sm text-gray-600 truncate",children:y.content})]}),r.jsx(o.z,{size:"sm",variant:"ghost",onClick:()=>w(null),children:"\xd7"})]})}),r.jsx("div",{className:"p-4 border-t border-gray-200",children:(0,r.jsxs)("form",{onSubmit:B,className:"flex items-end gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:"メッセージを入力...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-engineering-blue focus:border-transparent",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()}})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"file",ref:L,onChange:e=>{let t=e.target.files?.[0];t&&F(t)},className:"hidden"}),r.jsx(o.z,{type:"button",variant:"outline",size:"icon",onClick:()=>L.current?.click(),disabled:h,children:r.jsx(z.Z,{className:"w-4 h-4"})}),r.jsx(o.z,{type:"submit",disabled:!c.trim()||h,className:"px-4",children:h?r.jsx(S.Z,{className:"w-4 h-4 animate-spin"}):r.jsx(C.Z,{className:"w-4 h-4"})})]})]})}),D&&O&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ファイルをアップロード"}),r.jsx("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"w-10 h-10 bg-engineering-blue rounded-lg flex items-center justify-center",children:r.jsx(b.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-gray-900",children:O.name}),r.jsx("p",{className:"text-sm text-gray-500",children:J(O.size)})]})]})}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"コメント（任意）"}),r.jsx("textarea",{value:P,onChange:e=>A(e.target.value),placeholder:"ファイルについてのコメントを入力してください...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent resize-none",rows:3})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[r.jsx(o.z,{variant:"outline",onClick:()=>{M(!1),q(null),A("")},disabled:h,children:"キャンセル"}),r.jsx(o.z,{variant:"engineering",onClick:()=>Q(O,P),disabled:h,children:h?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"アップロード中..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(C.Z,{className:"w-4 h-4 mr-2"}),"アップロード"]})})]})]})})]})}var E=s(18822);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let P=(0,w.Z)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);var A=s(23485),D=s(14513);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let M=(0,w.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var O=s(62312),q=s(66138);function R({roomId:e,projectId:t,isVisible:s,onClose:n,className:c=""}){let{user:d}=(0,x.useAuth)(),[u,m]=(0,a.useState)([]),[f,y]=(0,a.useState)(!0),[j,b]=(0,a.useState)(""),[w,N]=(0,a.useState)(!1),[k,_]=(0,a.useState)([]),[z,S]=(0,a.useState)(!1),[C,Z]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s&&e&&(R(),L())},[s,e]);let R=async()=>{try{let{data:{session:t}}=await g.OQ.auth.getSession();if(!t){console.error("セッションが見つかりません");return}let s=await fetch(`/api/chat/participants?room_id=${e}`,{method:"GET",headers:{Authorization:`Bearer ${t.access_token}`}}),r=await s.json();s.ok?m(r.participants):(console.error("参加者取得エラー:",r.message),m([]))}catch(e){console.error("参加者取得エラー:",e),m([])}finally{y(!1)}},L=async()=>{try{let{data:{session:e}}=await g.OQ.auth.getSession();if(!e)return;let s=await fetch(`/api/projects/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e.access_token}`}});if(s.ok){let e=(await s.json()).project,{data:t}=await g.OQ.from("users").select("id").eq("auth_user_id",d?.id).single(),{data:r}=await g.OQ.from("memberships").select("org_id, role").eq("user_id",t?.id).single();Z(r?.org_id===e.org_id)}}catch(e){console.error("権限確認エラー:",e),Z(!1)}},T=async()=>{if(j.trim()){N(!0),_([]);try{let{data:{session:t}}=await g.OQ.auth.getSession();if(!t){console.error("セッションが見つかりません");return}let s=j.split(/[,\n]/).map(e=>e.trim()).filter(e=>e),r=await fetch("/api/chat/participants/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({room_id:e,user_emails:s})}),a=await r.json();r.ok?(_(a.results),b(""),R()):(console.error("招待エラー:",a.message),_([{email:"全体",success:!1,error:a.message}]))}catch(e){console.error("招待エラー:",e),_([{email:"全体",success:!1,error:"招待処理中にエラーが発生しました"}])}finally{N(!1)}}},U=(e,t)=>"contractor"===e?r.jsx(E.Z,{className:"w-4 h-4 text-blue-600"}):"OrgAdmin"===t?r.jsx(P,{className:"w-4 h-4 text-yellow-600"}):"Staff"===t?r.jsx(A.Z,{className:"w-4 h-4 text-green-600"}):r.jsx(E.Z,{className:"w-4 h-4 text-gray-600"}),$=(e,t)=>"contractor"===e?"受注者":"OrgAdmin"===t?"組織管理者":"Staff"===t?"スタッフ":"メンバー";return s?(0,r.jsxs)(i.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},className:(0,p.cn)("fixed top-0 right-0 h-full w-80 bg-white border-l border-gray-200 shadow-lg z-50 flex flex-col",c),children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(l.Z,{className:"w-5 h-5 text-engineering-blue"}),r.jsx("h3",{className:"font-semibold text-gray-900",children:"参加者"}),r.jsx(h.C,{variant:"secondary",children:u.length})]}),r.jsx(o.z,{variant:"ghost",size:"sm",onClick:n,className:"h-8 w-8 p-0",children:r.jsx(D.Z,{className:"w-4 h-4"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:f?r.jsx("div",{className:"flex items-center justify-center h-32",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue"})}):(0,r.jsxs)("div",{className:"space-y-4",children:[C&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"招待"}),(0,r.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>S(!z),className:"flex items-center gap-2",children:[r.jsx(M,{className:"w-4 h-4"}),"招待"]})]}),r.jsx(v.M,{children:z&&(0,r.jsxs)(i.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"メールアドレス（複数の場合は改行またはカンマで区切り）"}),r.jsx("textarea",{value:j,onChange:e=>b(e.target.value),placeholder:"user@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-engineering-blue focus:border-transparent",rows:3})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(o.z,{onClick:T,disabled:!j.trim()||w,size:"sm",className:"flex-1",children:w?"招待中...":"招待する"}),r.jsx(o.z,{variant:"outline",size:"sm",onClick:()=>{S(!1),b(""),_([])},children:"キャンセル"})]})]})}),k.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h5",{className:"text-xs font-medium text-gray-600",children:"招待結果"}),k.map((e,t)=>(0,r.jsxs)("div",{className:(0,p.cn)("p-2 rounded-lg text-xs",e.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.success?r.jsx(O.Z,{className:"w-3 h-3"}):r.jsx(q.Z,{className:"w-3 h-3"}),r.jsx("span",{className:"font-medium",children:e.email})]}),r.jsx("p",{className:"mt-1",children:e.message||e.error})]},t))]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"現在の参加者"}),r.jsx("div",{className:"space-y-2",children:u.map(e=>(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 rounded-full bg-engineering-blue flex items-center justify-center text-white text-sm font-medium flex-shrink-0",children:e.display_name?.charAt(0)||e.email.charAt(0)}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.display_name||"名前未設定"}),U(e.role,e.org_role)]}),r.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.email}),r.jsx(h.C,{variant:"secondary",className:"mt-1 text-xs",children:$(e.role,e.org_role)})]})]},e.id))})]})]})})]}):null}function L({className:e=""}){let[t,s]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1);return n().useEffect(()=>{let e=()=>{h(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{let e="/chat",t=sessionStorage.getItem("currentPage");sessionStorage.setItem("currentPage",e),t&&t!==e&&sessionStorage.setItem("previousPage",t)},[]),(0,r.jsxs)("div",{className:(0,p.cn)("flex h-full bg-gray-50",e),children:[r.jsx(i.E.div,{initial:!1,animate:{width:m?t?0:"100%":320,opacity:m&&t?0:1},className:(0,p.cn)("border-r border-gray-200 bg-white overflow-hidden",m&&t&&"hidden"),children:r.jsx(y,{selectedRoomId:t||void 0,onRoomSelect:e=>{s(e)},className:"h-full"})}),r.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[m&&r.jsx(o.z,{variant:"ghost",size:"icon",onClick:()=>s(null),children:"←"}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"font-semibold text-gray-900",children:"チャットルーム"}),r.jsx("p",{className:"text-sm text-gray-500",children:"プロジェクト関連のディスカッション"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(o.z,{variant:"ghost",size:"icon",onClick:()=>u(!d),className:(0,p.cn)("transition-colors",d&&"bg-engineering-blue/10 text-engineering-blue"),children:r.jsx(l.Z,{className:"w-4 h-4"})}),r.jsx(o.z,{variant:"ghost",size:"icon",children:r.jsx(c.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[r.jsx("div",{className:"flex-1 flex flex-col",children:r.jsx(Z,{roomId:t,className:"flex-1"})}),d&&r.jsx(R,{roomId:t,projectId:t.replace("project_",""),isVisible:d,onClose:()=>u(!1)})]})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-white",children:(0,r.jsxs)("div",{className:"text-center max-w-md",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:r.jsx(l.Z,{className:"w-8 h-8 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"チャットルームを選択してください"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"左のリストからチャットルームを選択して、 プロジェクト関係者とのコミュニケーションを開始してください。"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-gray-400",children:[r.jsx("p",{children:"\uD83D\uDCAC リアルタイムメッセージング"}),r.jsx("p",{children:"\uD83D\uDCC1 ファイル共有"}),r.jsx("p",{children:"\uD83D\uDC65 プロジェクト関係者との連携"})]})]})})})]})}},19591:(e,t,s)=>{"use strict";s.d(t,{C:()=>l});var r=s(95344);s(3729);var a=s(49247),n=s(11453);let i=(0,a.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white shadow hover:bg-green-600",warning:"border-transparent bg-yellow-500 text-white shadow hover:bg-yellow-600",info:"border-transparent bg-blue-500 text-white shadow hover:bg-blue-600",engineering:"border-engineering-blue bg-engineering-blue/10 text-engineering-blue",glass:"glass text-gray-700 border-white/30"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...s}){return r.jsx("div",{className:(0,n.cn)(i({variant:t}),e),...s})}},5094:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var r=s(95344),a=s(3729),n=s(45877),i=s(49247),l=s(11453);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",engineering:"bg-engineering-blue text-white shadow-lg hover:bg-engineering-blue-dark hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",gradient:"gradient-engineering text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300",glass:"glass text-gray-900 hover:bg-white/20 border-white/30"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",xl:"h-12 rounded-lg px-10 text-base",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...i},o)=>{let d=a?n.g7:"button";return r.jsx(d,{className:(0,l.cn)(c({variant:t,size:s,className:e})),ref:o,...i})});o.displayName="Button"},11453:(e,t,s)=>{"use strict";s.d(t,{XO:()=>c,cn:()=>n,xG:()=>i,z2:()=>l});var r=s(56815),a=s(79377);function n(...e){return(0,a.m6)((0,r.W)(e))}function i(e){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(e)}function l(e){return({draft:"bg-gray-100 text-gray-800",bidding:"bg-blue-100 text-blue-800",contracted:"bg-green-100 text-green-800",in_progress:"bg-yellow-100 text-yellow-800",submitted:"bg-purple-100 text-purple-800",completed:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800"}function c(e){return({draft:"\uD83D\uDCDD",bidding:"\uD83C\uDFD7️",contracted:"✅",in_progress:"⚡",submitted:"\uD83D\uDCCB",completed:"\uD83C\uDF89",cancelled:"❌"})[e]||"\uD83D\uDCC4"}},92524:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(25036),a=s(86843);let n=(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/auth/auth-guard.tsx`),{__esModule:i,$$typeof:l}=n;n.default;let c=(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/auth/auth-guard.tsx#AuthGuard`);(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/auth/auth-guard.tsx#withAuth`),(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/auth/auth-guard.tsx#useRoleAccess`);let o=(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/chat/chat-layout.tsx`),{__esModule:d,$$typeof:u}=o;o.default;let m=(0,a.createProxy)(String.raw`/Users/sayuri/caddonworks/src/components/chat/chat-layout.tsx#ChatLayout`);function h(){return r.jsx(c,{allowedRoles:["OrgAdmin","Staff","Contractor","Reviewer"],children:r.jsx("div",{className:"h-screen bg-gradient-mesh",children:r.jsx(m,{className:"h-full"})})})}},73644:(e,t,s)=>{"use strict";s.d(t,{M:()=>p});var r=s(3729),a=s(19038);function n(){let e=(0,r.useRef)(!1);return(0,a.L)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}var i=s(80228),l=s(35986),c=s(40207);class o extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:t}){let s=(0,r.useId)(),a=(0,r.useRef)(null),n=(0,r.useRef)({width:0,height:0,top:0,left:0});return(0,r.useInsertionEffect)(()=>{let{width:e,height:r,top:i,left:l}=n.current;if(t||!a.current||!e||!r)return;a.current.dataset.motionPopId=s;let c=document.createElement("style");return document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${r}px !important;
            top: ${i}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[t]),r.createElement(o,{isPresent:t,childRef:a,sizeRef:n},r.cloneElement(e,{ref:a}))}let u=({children:e,initial:t,isPresent:s,onExitComplete:a,custom:n,presenceAffectsLayout:i,mode:o})=>{let u=(0,c.h)(m),h=(0,r.useId)(),x=(0,r.useMemo)(()=>({id:h,initial:t,isPresent:s,custom:n,onExitComplete:e=>{for(let t of(u.set(e,!0),u.values()))if(!t)return;a&&a()},register:e=>(u.set(e,!1),()=>u.delete(e))}),i?void 0:[s]);return(0,r.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[s]),r.useEffect(()=>{s||u.size||!a||a()},[s]),"popLayout"===o&&(e=r.createElement(d,{isPresent:s},e)),r.createElement(l.O.Provider,{value:x},e)};function m(){return new Map}var h=s(66828),x=s(87222);let g=e=>e.key||"",p=({children:e,custom:t,initial:s=!0,onExitComplete:l,exitBeforeEnter:c,presenceAffectsLayout:o=!0,mode:d="sync"})=>{var m;(0,x.k)(!c,"Replace exitBeforeEnter with mode='wait'");let p=(0,r.useContext)(h.p).forceRender||function(){let e=n(),[t,s]=(0,r.useState)(0),a=(0,r.useCallback)(()=>{e.current&&s(t+1)},[t]);return[(0,r.useCallback)(()=>i.Wi.postRender(a),[a]),t]}()[0],f=n(),y=function(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}(e),v=y,j=(0,r.useRef)(new Map).current,b=(0,r.useRef)(v),w=(0,r.useRef)(new Map).current,N=(0,r.useRef)(!0);if((0,a.L)(()=>{N.current=!1,function(e,t){e.forEach(e=>{let s=g(e);t.set(s,e)})}(y,w),b.current=v}),m=()=>{N.current=!0,w.clear(),j.clear()},(0,r.useEffect)(()=>()=>m(),[]),N.current)return r.createElement(r.Fragment,null,v.map(e=>r.createElement(u,{key:g(e),isPresent:!0,initial:!!s&&void 0,presenceAffectsLayout:o,mode:d},e)));v=[...v];let k=b.current.map(g),_=y.map(g),z=k.length;for(let e=0;e<z;e++){let t=k[e];-1!==_.indexOf(t)||j.has(t)||j.set(t,void 0)}return"wait"===d&&j.size&&(v=[]),j.forEach((e,s)=>{if(-1!==_.indexOf(s))return;let a=w.get(s);if(!a)return;let n=k.indexOf(s),i=e;i||(i=r.createElement(u,{key:g(a),isPresent:!1,onExitComplete:()=>{j.delete(s);let e=Array.from(w.keys()).filter(e=>!_.includes(e));if(e.forEach(e=>w.delete(e)),b.current=y.filter(t=>{let r=g(t);return r===s||e.includes(r)}),!j.size){if(!1===f.current)return;p(),l&&l()}},custom:t,presenceAffectsLayout:o,mode:d},a),j.set(s,i)),v.splice(n,0,i)}),v=v.map(e=>{let t=e.key;return j.has(t)?e:r.createElement(u,{key:g(e),isPresent:!0,presenceAffectsLayout:o,mode:d},e)}),r.createElement(r.Fragment,null,j.size?v:v.map(e=>(0,r.cloneElement)(e)))}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,4679,3035,7962,8710],()=>s(90241));module.exports=r})();