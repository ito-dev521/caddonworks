"use strict";(()=>{var e={};e.id=9410,e.ids=[9410],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},61587:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>l,originalPathname:()=>j,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>I});var s={};r.r(s),r.d(s,{DELETE:()=>p});var a=r(95419),o=r(69108),i=r(99678),n=r(78070),c=r(6517);async function p(e,{params:t}){try{let{id:r,attachmentId:s}=t,a=e.headers.get("authorization");if(!a)return n.Z.json({message:"認証が必要です"},{status:401});let o=a.replace("Bearer ",""),{data:{user:i},error:p}=await c.OQ.auth.getUser(o);if(p||!i)return n.Z.json({message:"認証に失敗しました"},{status:401});let{data:u,error:d}=await c.OQ.from("project_attachments").select(`
        id,
        file_path,
        project_id,
        projects!inner (
          org_id,
          memberships!inner (
            user_id,
            role
          )
        )
      `).eq("id",s).eq("project_id",r).eq("projects.memberships.user_id",i.id).single();if(d||!u)return n.Z.json({message:"添付資料が見つからないか、削除権限がありません"},{status:404});let{error:m}=await c.OQ.storage.from("project-attachments").remove([u.file_path]);m&&console.error("ファイル削除エラー:",m);let{error:h}=await c.OQ.from("project_attachments").delete().eq("id",s);if(h)return console.error("添付資料削除エラー:",h),n.Z.json({message:"添付資料の削除に失敗しました"},{status:400});return n.Z.json({message:"添付資料が正常に削除されました"},{status:200})}catch(e){return console.error("添付資料削除エラー:",e),n.Z.json({message:"サーバーエラーが発生しました"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/projects/[id]/attachments/[attachmentId]/route",pathname:"/api/projects/[id]/attachments/[attachmentId]",filename:"route",bundlePath:"app/api/projects/[id]/attachments/[attachmentId]/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/projects/[id]/attachments/[attachmentId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:l,staticGenerationBailout:I}=u,j="/api/projects/[id]/attachments/[attachmentId]/route";function g(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},6517:(e,t,r)=>{r.d(t,{OQ:()=>a,ST:()=>o});var s=r(32409);let a=(0,s.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),o=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE";return(0,s.eI)("https://rxnozwuamddqlcwysxag.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,2409],()=>r(61587));module.exports=s})();