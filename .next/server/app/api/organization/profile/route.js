"use strict";(()=>{var e={};e.id=7635,e.ids=[7635],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},47265:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>z,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>h});var a={};t.r(a),t.d(a,{GET:()=>l,PUT:()=>p});var s=t(95419),o=t(69108),i=t(99678),n=t(78070);let u=(0,t(32409).eI)("https://rxnozwuamddqlcwysxag.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function l(e){try{console.log("organization profile API: 開始");let r=e.headers.get("authorization");if(!r)return n.Z.json({message:"認証が必要です"},{status:401});let t=r.replace("Bearer ",""),{data:{user:a},error:s}=await u.auth.getUser(t);if(s||!a)return console.error("認証エラー:",s),n.Z.json({message:"認証に失敗しました"},{status:401});console.log("認証成功, ユーザーID:",a.id,"Email:",a.email);let{data:o,error:i}=await u.from("users").select("id, email, display_name").eq("auth_user_id",a.id).single();if(i||!o)return console.error("ユーザープロフィール取得エラー:",i),n.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});console.log("ユーザープロフィール取得成功:",o);let{data:l,error:p}=await u.from("memberships").select(`
        *,
        organizations(*)
      `).eq("user_id",o.id).eq("role","OrgAdmin");if(p||!l||0===l.length)return console.error("membership取得エラー:",p),n.Z.json({message:"組織情報が見つかりません: "+(p?.message||"不明なエラー")},{status:404});let d=l[0];return console.log("membership取得成功:",d),n.Z.json({user:o,organization:d.organizations,membership:d},{status:200})}catch(e){return console.error("organization profile API: サーバーエラー:",e),n.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}async function p(e){try{let r=e.headers.get("authorization");if(!r)return n.Z.json({message:"認証が必要です"},{status:401});let t=r.replace("Bearer ",""),{data:{user:a},error:s}=await u.auth.getUser(t);if(s||!a)return n.Z.json({message:"認証に失敗しました"},{status:401});let{data:o,error:i}=await u.from("users").select("id, email, display_name").eq("auth_user_id",a.id).single();if(i||!o)return console.error("ユーザープロフィール取得エラー:",i),n.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});let{organizationData:l}=await e.json(),{data:p,error:d}=await u.from("organizations").update({...l,updated_at:new Date().toISOString()}).eq("id",l.id).select().single();if(d)return console.error("組織情報更新エラー:",d),n.Z.json({message:"組織情報の更新に失敗しました"},{status:500});return n.Z.json({message:"組織情報が正常に更新されました",organization:p},{status:200})}catch(e){return console.error("organization profile update API: サーバーエラー:",e),n.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/organization/profile/route",pathname:"/api/organization/profile",filename:"route",bundlePath:"app/api/organization/profile/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/organization/profile/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:m,headerHooks:f,staticGenerationBailout:h}=d,z="/api/organization/profile/route";function j(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206,2409],()=>t(47265));module.exports=a})();