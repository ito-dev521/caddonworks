"use strict";(()=>{var e={};e.id=6709,e.ids=[6709],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},38612:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>I,originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>h});var s={};t.r(s),t.d(s,{POST:()=>m});var o=t(95419),i=t(69108),a=t(99678),n=t(78070),c=t(6517);async function m(e){try{let{data:e,error:r}=await c.OQ.from("users").select("id").eq("email","contractor@demo.com").single();if(r||!e)return n.Z.json({message:"受注者ユーザーが見つかりません"},{status:404});let{error:t}=await c.OQ.from("memberships").delete().eq("user_id",e.id);t&&console.error("Delete membership error:",t);let s=null,{data:o}=await c.OQ.from("organizations").select("id").eq("name","個人事業主（受注者）").single();if(o)s=o.id;else{let{data:e,error:r}=await c.OQ.from("organizations").insert({name:"個人事業主（受注者）",description:"受注者用のダミー組織",billing_email:"contractor@demo.com",system_fee:0,active:!0}).select().single();if(r)return console.error("Create contractor org error:",r),n.Z.json({message:"受注者用組織の作成に失敗しました: "+r.message},{status:400});s=e.id}let{error:i}=await c.OQ.from("memberships").insert({org_id:s,user_id:e.id,role:"Contractor"});if(i)return console.error("Insert membership error:",i),n.Z.json({message:"メンバーシップの作成に失敗しました: "+i.message},{status:400});return n.Z.json({message:"受注者のメンバーシップを修正しました",userId:e.id},{status:200})}catch(e){return console.error("Fix contractor membership error:",e),n.Z.json({message:"サーバーエラーが発生しました"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/fix-contractor-membership/route",pathname:"/api/fix-contractor-membership",filename:"route",bundlePath:"app/api/fix-contractor-membership/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/fix-contractor-membership/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:d,headerHooks:I,staticGenerationBailout:h}=u,g="/api/fix-contractor-membership/route";function b(){return(0,a.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:l})}},6517:(e,r,t)=>{t.d(r,{OQ:()=>o,ST:()=>i});var s=t(32409);let o=(0,s.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),i=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE";return(0,s.eI)("https://rxnozwuamddqlcwysxag.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,2409],()=>t(38612));module.exports=s})();