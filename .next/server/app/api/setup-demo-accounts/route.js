"use strict";(()=>{var e={};e.id=5096,e.ids=[5096],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},42171:(e,a,s)=>{s.r(a),s.d(a,{headerHooks:()=>g,originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>c,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>h});var i={};s.r(i),s.d(i,{POST:()=>l});var t=s(95419),r=s(69108),o=s(99678),m=s(78070),n=s(6517);async function l(e){try{let e=[];for(let a of[{email:"admin@demo.com",password:"demo123",displayName:"運営者デモ",role:"Admin",organizationName:"システム運営"},{email:"orgadmin@demo.com",password:"demo123",displayName:"発注者デモ",role:"OrgAdmin",organizationName:"デモ建設株式会社"},{email:"contractor@demo.com",password:"demo123",displayName:"受注者デモ",role:"Contractor",specialties:["道路設計","橋梁設計"],qualifications:["技術士（建設部門）","一級建築士"]},{email:"reviewer@demo.com",password:"demo123",displayName:"監督員デモ",role:"Reviewer",organizationName:"デモ建設株式会社"}])try{let{data:s}=await n.OQ.from("users").select("id").eq("email",a.email).single();if(s){e.push({email:a.email,status:"already_exists",message:"既に存在します"});continue}let{data:i,error:t}=await n.OQ.auth.signUp({email:a.email,password:a.password,options:{data:{display_name:a.displayName,role:a.role}}});if(t){e.push({email:a.email,status:"auth_error",message:t.message});continue}if(!i.user){e.push({email:a.email,status:"auth_error",message:"ユーザー作成に失敗しました"});continue}let{data:r,error:o}=await n.OQ.from("users").insert({auth_user_id:i.user.id,email:a.email,display_name:a.displayName,specialties:a.specialties||[],qualifications:a.qualifications||[]}).select().single();if(o){e.push({email:a.email,status:"profile_error",message:o.message});continue}let m=null;if(a.organizationName){let{data:s}=await n.OQ.from("organizations").select("id").eq("name",a.organizationName).single();if(s)m=s.id;else{let{data:s,error:i}=await n.OQ.from("organizations").insert({name:a.organizationName,description:"デモ用の組織です",billing_email:a.email,system_fee:5e4,active:!0}).select().single();if(i){e.push({email:a.email,status:"org_error",message:i.message});continue}m=s.id}}let l={user_id:r.id,role:a.role};if(m)l.org_id=m;else if("Contractor"===a.role){let{data:s}=await n.OQ.from("organizations").select("id").eq("name","デフォルト組織").single();if(s)l.org_id=s.id;else{let{data:s,error:i}=await n.OQ.from("organizations").insert({name:"デフォルト組織",description:"受注者用のデフォルト組織",billing_email:"default@example.com",system_fee:0,active:!0}).select().single();if(i){e.push({email:a.email,status:"org_error",message:i.message});continue}l.org_id=s.id}}let{error:u}=await n.OQ.from("memberships").insert(l);if(u){e.push({email:a.email,status:"membership_error",message:u.message});continue}e.push({email:a.email,status:"success",message:"デモアカウントを作成しました"})}catch(s){e.push({email:a.email,status:"error",message:"予期しないエラーが発生しました"})}return m.Z.json({message:"デモアカウントのセットアップが完了しました",results:e},{status:200})}catch(e){return console.error("Demo accounts setup error:",e),m.Z.json({message:"サーバーエラーが発生しました"},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/setup-demo-accounts/route",pathname:"/api/setup-demo-accounts",filename:"route",bundlePath:"app/api/setup-demo-accounts/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/setup-demo-accounts/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:c,headerHooks:g,staticGenerationBailout:h}=u,f="/api/setup-demo-accounts/route";function w(){return(0,o.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:p})}},6517:(e,a,s)=>{s.d(a,{OQ:()=>t,ST:()=>r});var i=s(32409);let t=(0,i.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),r=()=>(0,i.eI)("https://rxnozwuamddqlcwysxag.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var a=require("../../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),i=a.X(0,[1638,6206,2409],()=>s(42171));module.exports=i})();