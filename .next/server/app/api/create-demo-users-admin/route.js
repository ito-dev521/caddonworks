"use strict";(()=>{var e={};e.id=4429,e.ids=[4429],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},69022:(e,a,s)=>{s.r(a),s.d(a,{headerHooks:()=>g,originalPathname:()=>I,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>h});var r={};s.r(r),s.d(r,{POST:()=>l});var i=s(95419),t=s(69108),o=s(99678),m=s(78070),n=s(6517);async function l(e){try{let e=(0,n.ST)(),a=[];for(let s of[{email:"admin@demo.com",password:"demo123",displayName:"管理者デモ",role:"OrgAdmin",organizationName:"デモ建設株式会社"},{email:"contractor@demo.com",password:"demo123",displayName:"受注者デモ",role:"Contractor",specialties:["道路設計","橋梁設計"],qualifications:["技術士（建設部門）","一級建築士"]},{email:"reviewer@demo.com",password:"demo123",displayName:"監督員デモ",role:"Reviewer",organizationName:"デモ建設株式会社"}])try{let{data:r}=await e.from("users").select("id").eq("email",s.email).single();if(r){a.push({email:s.email,status:"already_exists",message:"既に存在します"});continue}let{data:i,error:t}=await e.auth.admin.createUser({email:s.email,password:s.password,email_confirm:!0,user_metadata:{display_name:s.displayName,role:s.role}});if(t){a.push({email:s.email,status:"auth_error",message:t.message});continue}if(!i.user){a.push({email:s.email,status:"auth_error",message:"ユーザー作成に失敗しました"});continue}let{data:o,error:m}=await e.from("users").insert({auth_user_id:i.user.id,email:s.email,display_name:s.displayName,specialties:s.specialties||[],qualifications:s.qualifications||[]}).select().single();if(m){a.push({email:s.email,status:"user_error",message:m.message});continue}let n=null;if(s.organizationName){let{data:a,error:r}=await e.from("organizations").insert({name:s.organizationName,description:`${s.organizationName}のデモ組織`,billing_email:s.email,system_fee:0,active:!0}).select().single();if(r){let{data:a}=await e.from("organizations").select("id").eq("name",s.organizationName).single();a&&(n=a.id)}else n=a.id}let l={user_id:o.id,role:s.role};n&&(l.org_id=n);let{error:u}=await e.from("memberships").insert(l);u?a.push({email:s.email,status:"membership_error",message:u.message}):a.push({email:s.email,status:"success",message:"デモアカウントを作成しました"})}catch(e){a.push({email:s.email,status:"error",message:e.message})}return m.Z.json({message:"デモアカウントのセットアップが完了しました",results:a},{status:200})}catch(e){return console.error("Create demo users admin error:",e),m.Z.json({message:"サーバーエラーが発生しました"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/create-demo-users-admin/route",pathname:"/api/create-demo-users-admin",filename:"route",bundlePath:"app/api/create-demo-users-admin/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/create-demo-users-admin/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:g,staticGenerationBailout:h}=u,I="/api/create-demo-users-admin/route";function w(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}},6517:(e,a,s)=>{s.d(a,{OQ:()=>i,ST:()=>t});var r=s(32409);let i=(0,r.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),t=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE";return(0,r.eI)("https://rxnozwuamddqlcwysxag.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var a=require("../../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),r=a.X(0,[1638,6206,2409],()=>s(69022));module.exports=r})();