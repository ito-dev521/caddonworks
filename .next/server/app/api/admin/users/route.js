"use strict";(()=>{var e={};e.id=2628,e.ids=[2628],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},78562:(e,s,r)=>{r.r(s),r.d(s,{headerHooks:()=>I,originalPathname:()=>Z,patchFetch:()=>_,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>j});var t={};r.r(t),r.d(t,{GET:()=>c,PUT:()=>m});var a=r(95419),i=r(69108),n=r(99678),o=r(78070),u=r(32409);let d=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE",l=(0,u.eI)("https://rxnozwuamddqlcwysxag.supabase.co",d,{auth:{autoRefreshToken:!1,persistSession:!1}});async function c(e){try{let s=e.headers.get("authorization");if(!s)return o.Z.json({message:"認証が必要です"},{status:401});let r=s.replace("Bearer ",""),{data:{user:t},error:a}=await l.auth.getUser(r);if(a||!t)return o.Z.json({message:"認証に失敗しました"},{status:401});let{data:i,error:n}=await l.from("users").select("id, email, display_name, role").eq("auth_user_id",t.id).single();if(n||!i)return o.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});if("admin"!==i.role)return o.Z.json({message:"運営者権限が必要です"},{status:403});let{data:u,error:d}=await l.from("users").select(`
        id,
        email,
        display_name,
        specialties,
        qualifications,
        experience_years,
        member_level,
        formal_name,
        phone_number,
        address,
        created_at,
        updated_at
      `).order("created_at",{ascending:!1});if(d)return console.error("ユーザー一覧取得エラー:",d),o.Z.json({message:"ユーザー一覧の取得に失敗しました"},{status:400});return o.Z.json({users:u||[]},{status:200})}catch(e){return console.error("admin users API: サーバーエラー:",e),o.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}async function m(e){try{let s=e.headers.get("authorization");if(!s)return o.Z.json({message:"認証が必要です"},{status:401});let r=s.replace("Bearer ",""),{data:{user:t},error:a}=await l.auth.getUser(r);if(a||!t)return o.Z.json({message:"認証に失敗しました"},{status:401});let{data:i,error:n}=await l.from("users").select("id, email, display_name, role").eq("auth_user_id",t.id).single();if(n||!i)return o.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});if("admin"!==i.role)return o.Z.json({message:"運営者権限が必要です"},{status:403});let{userId:u,memberLevel:d}=await e.json();if(!u||!d)return o.Z.json({message:"ユーザーIDと会員レベルが必要です"},{status:400});let{data:c,error:m}=await l.from("users").update({member_level:d,updated_at:new Date().toISOString()}).eq("id",u).select().single();if(m)return console.error("会員レベル更新エラー:",m),o.Z.json({message:"会員レベルの更新に失敗しました"},{status:400});return o.Z.json({message:"会員レベルが正常に更新されました",user:c},{status:200})}catch(e){return console.error("admin users update API: サーバーエラー:",e),o.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/admin/users/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:I,staticGenerationBailout:j}=p,Z="/api/admin/users/route";function _(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[1638,6206,2409],()=>r(78562));module.exports=t})();