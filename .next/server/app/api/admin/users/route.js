"use strict";(()=>{var e={};e.id=2628,e.ids=[2628],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},78562:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>f,originalPathname:()=>_,patchFetch:()=>j,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>h});var t={};s.r(t),s.d(t,{GET:()=>d,PUT:()=>l});var a=s(95419),o=s(69108),n=s(99678),i=s(78070);let u=(0,s(32409).eI)("https://rxnozwuamddqlcwysxag.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e){try{let r=e.headers.get("authorization");if(!r)return i.Z.json({message:"認証が必要です"},{status:401});let s=r.replace("Bearer ",""),{data:{user:t},error:a}=await u.auth.getUser(s);if(a||!t)return i.Z.json({message:"認証に失敗しました"},{status:401});let{data:o,error:n}=await u.from("users").select("id, email, display_name, role").eq("auth_user_id",t.id).single();if(n||!o)return i.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});if("admin"!==o.role)return i.Z.json({message:"運営者権限が必要です"},{status:403});let{data:d,error:l}=await u.from("users").select(`
        id,
        email,
        display_name,
        specialties,
        qualifications,
        experience_years,
        member_level,
        formal_name,
        phone_number,
        address,
        created_at,
        updated_at
      `).order("created_at",{ascending:!1});if(l)return console.error("ユーザー一覧取得エラー:",l),i.Z.json({message:"ユーザー一覧の取得に失敗しました"},{status:400});return i.Z.json({users:d||[]},{status:200})}catch(e){return console.error("admin users API: サーバーエラー:",e),i.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}async function l(e){try{let r=e.headers.get("authorization");if(!r)return i.Z.json({message:"認証が必要です"},{status:401});let s=r.replace("Bearer ",""),{data:{user:t},error:a}=await u.auth.getUser(s);if(a||!t)return i.Z.json({message:"認証に失敗しました"},{status:401});let{data:o,error:n}=await u.from("users").select("id, email, display_name, role").eq("auth_user_id",t.id).single();if(n||!o)return i.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});if("admin"!==o.role)return i.Z.json({message:"運営者権限が必要です"},{status:403});let{userId:d,memberLevel:l}=await e.json();if(!d||!l)return i.Z.json({message:"ユーザーIDと会員レベルが必要です"},{status:400});let{data:m,error:p}=await u.from("users").update({member_level:l,updated_at:new Date().toISOString()}).eq("id",d).select().single();if(p)return console.error("会員レベル更新エラー:",p),i.Z.json({message:"会員レベルの更新に失敗しました"},{status:400});return i.Z.json({message:"会員レベルが正常に更新されました",user:m},{status:200})}catch(e){return console.error("admin users update API: サーバーエラー:",e),i.Z.json({message:"サーバーエラーが発生しました: "+(e instanceof Error?e.message:"不明なエラー")},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/admin/users/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:g,headerHooks:f,staticGenerationBailout:h}=m,_="/api/admin/users/route";function j(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1638,6206,2409],()=>s(78562));module.exports=t})();