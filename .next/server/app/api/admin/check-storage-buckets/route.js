"use strict";(()=>{var e={};e.id=3011,e.ids=[3011],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},54105:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>h,originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>I});var r={};s.r(r),s.d(r,{GET:()=>u});var a=s(95419),i=s(69108),o=s(99678),n=s(78070),c=s(6517);async function u(e){try{let t=(0,c.ST)(),s=e.headers.get("authorization");if(!s)return n.Z.json({message:"認証が必要です"},{status:401});let r=s.replace("Bearer ",""),{data:{user:a},error:i}=await t.auth.getUser(r);if(i||!a)return n.Z.json({message:"認証に失敗しました"},{status:401});let{data:o,error:u}=await t.from("users").select("id, email, display_name").eq("auth_user_id",a.id).single();if(u||!o)return n.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});let{data:l,error:p}=await t.from("memberships").select("role").eq("user_id",o.id).eq("role","Admin").single();if(p||!l)return n.Z.json({message:"管理者権限が必要です"},{status:403});let{data:d,error:m}=await t.storage.listBuckets();if(m)return console.error("バケット一覧取得エラー:",m),n.Z.json({message:"バケット一覧の取得に失敗しました",error:m.message},{status:500});let h=d?.some(e=>"project-attachments"===e.id);return n.Z.json({message:"バケット一覧を取得しました",buckets:d?.map(e=>({id:e.id,name:e.name,public:e.public,file_size_limit:e.file_size_limit,allowed_mime_types:e.allowed_mime_types})),projectAttachmentsExists:h,totalBuckets:d?.length||0},{status:200})}catch(e){return console.error("バケット確認エラー:",e),n.Z.json({message:"サーバーエラーが発生しました",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/check-storage-buckets/route",pathname:"/api/admin/check-storage-buckets",filename:"route",bundlePath:"app/api/admin/check-storage-buckets/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/admin/check-storage-buckets/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:h,staticGenerationBailout:I}=l,g="/api/admin/check-storage-buckets/route";function b(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},6517:(e,t,s)=>{s.d(t,{OQ:()=>a,ST:()=>i});var r=s(32409);let a=(0,r.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),i=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE";return(0,r.eI)("https://rxnozwuamddqlcwysxag.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,6206,2409],()=>s(54105));module.exports=r})();