"use strict";(()=>{var e={};e.id=5194,e.ids=[5194],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},97678:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>I,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>h});var a={};r.r(a),r.d(a,{POST:()=>p});var s=r(95419),i=r(69108),o=r(99678),n=r(78070),c=r(6517);async function p(e){try{let t=(0,c.ST)(),r=e.headers.get("authorization");if(!r)return n.Z.json({message:"認証が必要です"},{status:401});let a=r.replace("Bearer ",""),{data:{user:s},error:i}=await t.auth.getUser(a);if(i||!s)return n.Z.json({message:"認証に失敗しました"},{status:401});let{data:o,error:p}=await t.from("users").select("id, email, display_name").eq("auth_user_id",s.id).single();if(p||!o)return n.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});let{data:u,error:m}=await t.from("memberships").select("role").eq("user_id",o.id).eq("role","Admin").single();if(m||!u)return n.Z.json({message:"管理者権限が必要です"},{status:403});let{data:l,error:d}=await t.storage.listBuckets();if(d)return console.error("バケット一覧取得エラー:",d),n.Z.json({message:"バケット一覧の取得に失敗しました",error:d.message},{status:500});if(l?.some(e=>"project-attachments"===e.id))return n.Z.json({message:"project-attachmentsバケットは既に存在します",buckets:l?.map(e=>({id:e.id,name:e.name,public:e.public}))},{status:200});let{data:g,error:h}=await t.storage.createBucket("project-attachments",{public:!1,fileSizeLimit:209715200,allowedMimeTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","image/jpeg","image/png","image/gif","image/webp","application/zip","application/x-rar-compressed","application/x-rar","application/octet-stream","text/plain"]});if(h)return console.error("バケット作成エラー:",h),n.Z.json({message:"バケットの作成に失敗しました",error:h.message},{status:500});return n.Z.json({message:"project-attachmentsバケットが正常に作成されました",bucket:g,existingBuckets:l?.map(e=>({id:e.id,name:e.name,public:e.public}))},{status:201})}catch(e){return console.error("バケット作成エラー:",e),n.Z.json({message:"サーバーエラーが発生しました",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/create-storage-bucket/route",pathname:"/api/admin/create-storage-bucket",filename:"route",bundlePath:"app/api/admin/create-storage-bucket/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/admin/create-storage-bucket/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:d,headerHooks:g,staticGenerationBailout:h}=u,I="/api/admin/create-storage-bucket/route";function f(){return(0,o.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:l})}},6517:(e,t,r)=>{r.d(t,{OQ:()=>s,ST:()=>i});var a=r(32409);let s=(0,a.eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU"),i=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NjgwMywiZXhwIjoyMDczMzQyODAzfQ.w7KcFrtcTRhqoHwTSlgTc6NDNHIJH985rAgT9bD0ipE";return(0,a.eI)("https://rxnozwuamddqlcwysxag.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,2409],()=>r(97678));module.exports=a})();