"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/upload/route";
exports.ids = ["app/api/chat/upload/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Fupload%2Froute&page=%2Fapi%2Fchat%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Fupload%2Froute.ts&appDir=%2FUsers%2Fsayuri%2Fcaddonworks%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsayuri%2Fcaddonworks&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Fupload%2Froute&page=%2Fapi%2Fchat%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Fupload%2Froute.ts&appDir=%2FUsers%2Fsayuri%2Fcaddonworks%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsayuri%2Fcaddonworks&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_sayuri_caddonworks_src_app_api_chat_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/chat/upload/route.ts */ \"(rsc)/./src/app/api/chat/upload/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/upload/route\",\n        pathname: \"/api/chat/upload\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/upload/route\"\n    },\n    resolvedPagePath: \"/Users/sayuri/caddonworks/src/app/api/chat/upload/route.ts\",\n    nextConfigOutput,\n    userland: _Users_sayuri_caddonworks_src_app_api_chat_upload_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/chat/upload/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGdXBsb2FkJTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGdXBsb2FkJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnVwbG9hZCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnNheXVyaSUyRmNhZGRvbndvcmtzJTJGc3JjJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnNheXVyaSUyRmNhZGRvbndvcmtzJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ1U7QUFDdkY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaXZpbC1lbmdpbmVlcmluZy1wbGF0Zm9ybS8/YWE5MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvc2F5dXJpL2NhZGRvbndvcmtzL3NyYy9hcHAvYXBpL2NoYXQvdXBsb2FkL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jaGF0L3VwbG9hZC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NoYXQvdXBsb2FkXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jaGF0L3VwbG9hZC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9zYXl1cmkvY2FkZG9ud29ya3Mvc3JjL2FwcC9hcGkvY2hhdC91cGxvYWQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY2hhdC91cGxvYWQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Fupload%2Froute&page=%2Fapi%2Fchat%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Fupload%2Froute.ts&appDir=%2FUsers%2Fsayuri%2Fcaddonworks%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsayuri%2Fcaddonworks&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/chat/upload/route.ts":
/*!******************************************!*\
  !*** ./src/app/api/chat/upload/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(\"https://rxnozwuamddqlcwysxag.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    }\n});\nasync function POST(request) {\n    try {\n        const formData = await request.formData();\n        const file = formData.get(\"file\");\n        const roomId = formData.get(\"roomId\");\n        const comment = formData.get(\"comment\");\n        if (!file || !roomId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"ファイルとルームIDが必要です\"\n            }, {\n                status: 400\n            });\n        }\n        // ユーザーの認証\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"認証が必要です\"\n            }, {\n                status: 401\n            });\n        }\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const { data: { user }, error: authError } = await supabaseAdmin.auth.getUser(token);\n        if (authError || !user) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"認証に失敗しました\"\n            }, {\n                status: 401\n            });\n        }\n        // ユーザープロフィールを取得\n        const { data: userProfile, error: userError } = await supabaseAdmin.from(\"users\").select(\"id, email, display_name\").eq(\"auth_user_id\", user.id).single();\n        if (userError || !userProfile) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"ユーザープロフィールが見つかりません\"\n            }, {\n                status: 403\n            });\n        }\n        // プロジェクトIDを取得\n        const projectId = roomId.replace(\"project_\", \"\");\n        // プロジェクトの存在確認とアクセス権限チェック\n        const { data: project, error: projectError } = await supabaseAdmin.from(\"projects\").select(\"id, title, org_id, contractor_id\").eq(\"id\", projectId).single();\n        if (projectError || !project) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"プロジェクトが見つかりません\"\n            }, {\n                status: 404\n            });\n        }\n        // アクセス権限をチェック\n        const { data: membership } = await supabaseAdmin.from(\"memberships\").select(\"org_id, role\").eq(\"user_id\", userProfile.id).single();\n        const hasAccess = membership?.org_id === project.org_id || project.contractor_id === userProfile.id;\n        if (!hasAccess) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"このプロジェクトへのアクセス権限がありません\"\n            }, {\n                status: 403\n            });\n        }\n        // ファイルサイズチェック（動画ファイルは300MB、その他は100MB制限）\n        const isVideoFile = file.type.startsWith(\"video/\");\n        const maxSize = isVideoFile ? 300 * 1024 * 1024 : 100 * 1024 * 1024;\n        const maxSizeText = isVideoFile ? \"300MB\" : \"100MB\";\n        if (file.size > maxSize) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: `ファイルサイズが大きすぎます（${maxSizeText}以下にしてください）`\n            }, {\n                status: 400\n            });\n        }\n        // ファイルタイプチェック\n        const allowedTypes = [\n            \"image/jpeg\",\n            \"image/png\",\n            \"image/gif\",\n            \"image/webp\",\n            \"video/mp4\",\n            \"video/avi\",\n            \"video/mov\",\n            \"video/wmv\",\n            \"video/flv\",\n            \"video/webm\",\n            \"video/mkv\",\n            \"application/pdf\",\n            \"application/msword\",\n            \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n            \"application/vnd.ms-excel\",\n            \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n            \"text/plain\",\n            \"application/zip\",\n            \"application/x-zip-compressed\",\n            \"application/dwg\",\n            \"application/x-dwg\",\n            \"application/acad\",\n            \"application/x-acad\",\n            \"application/step\",\n            \"application/x-step\",\n            \"application/iges\",\n            \"application/x-iges\",\n            \"application/octet-stream\"\n        ];\n        const allowedExtensions = [\n            \"dwg\",\n            \"p21\",\n            \"sfc\",\n            \"bfo\",\n            \"step\",\n            \"stp\",\n            \"iges\",\n            \"igs\"\n        ];\n        const fileExtension = file.name.split(\".\").pop()?.toLowerCase();\n        const isAllowedExtension = allowedExtensions.includes(fileExtension || \"\");\n        const isAllowedMimeType = allowedTypes.includes(file.type);\n        if (!isAllowedMimeType && !isAllowedExtension) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"サポートされていないファイル形式です\"\n            }, {\n                status: 400\n            });\n        }\n        // ファイルをSupabase Storageにアップロード\n        const fileExt = file.name.split(\".\").pop();\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`;\n        const filePath = `chat-attachments/${roomId}/${fileName}`;\n        const { data: uploadData, error: uploadError } = await supabaseAdmin.storage.from(\"attachments\").upload(filePath, file, {\n            cacheControl: \"3600\",\n            upsert: false\n        });\n        if (uploadError) {\n            console.error(\"ファイルアップロードエラー:\", uploadError);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"ファイルのアップロードに失敗しました: \" + uploadError.message\n            }, {\n                status: 400\n            });\n        }\n        // 公開URLを取得\n        const { data: { publicUrl } } = supabaseAdmin.storage.from(\"attachments\").getPublicUrl(filePath);\n        // sender_typeを決定\n        const senderType = membership?.org_id === project.org_id ? \"client\" : \"contractor\";\n        // メッセージ内容を決定（コメントがある場合はコメント、ない場合はファイル名）\n        const messageContent = comment.trim() ? comment : file.name;\n        // チャットメッセージを保存\n        const { data: messageData, error: messageError } = await supabaseAdmin.from(\"chat_messages\").insert({\n            project_id: projectId,\n            sender_id: userProfile.id,\n            sender_type: senderType,\n            message: messageContent,\n            file_url: publicUrl,\n            file_name: file.name,\n            file_size: file.size,\n            message_type: file.type.startsWith(\"image/\") ? \"image\" : file.type.startsWith(\"video/\") ? \"video\" : \"file\"\n        }).select().single();\n        if (messageError) {\n            console.error(\"チャットメッセージ保存エラー:\", messageError);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                message: \"メッセージの保存に失敗しました: \" + messageError.message\n            }, {\n                status: 400\n            });\n        }\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"ファイルがアップロードされました\",\n            file: {\n                id: messageData.id,\n                name: file.name,\n                url: publicUrl,\n                size: file.size,\n                type: file.type.startsWith(\"image/\") ? \"image\" : \"file\"\n            }\n        });\n    } catch (error) {\n        console.error(\"ファイルアップロードAPI エラー:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"サーバーエラーが発生しました: \" + (error instanceof Error ? error.message : \"不明なエラー\")\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVM0RDtZQUNUUSxVQUFVWDtZQUNWWSxXQUFXMUUsS0FBS3VDLElBQUk7WUFDcEJvQyxXQUFXM0UsS0FBS21DLElBQUk7WUFDcEJ5QyxjQUFjNUUsS0FBSytCLElBQUksQ0FBQ0MsVUFBVSxDQUFDLFlBQVksVUFDbENoQyxLQUFLK0IsSUFBSSxDQUFDQyxVQUFVLENBQUMsWUFBWSxVQUFVO1FBQzFELEdBQ0NiLE1BQU0sR0FDTkcsTUFBTTtRQUVULElBQUk4QyxjQUFjO1lBQ2hCUCxRQUFRaEQsS0FBSyxDQUFDLG1CQUFtQnVEO1lBQ2pDLE9BQU9qRixrRkFBWUEsQ0FBQ2lCLElBQUksQ0FDdEI7Z0JBQUVDLFNBQVMsc0JBQXNCK0QsYUFBYS9ELE9BQU87WUFBQyxHQUN0RDtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsT0FBT25CLGtGQUFZQSxDQUFDaUIsSUFBSSxDQUFDO1lBQ3ZCQyxTQUFTO1lBQ1RMLE1BQU07Z0JBQ0pxQixJQUFJOEMsWUFBWTlDLEVBQUU7Z0JBQ2xCa0IsTUFBTXZDLEtBQUt1QyxJQUFJO2dCQUNmc0MsS0FBS2Y7Z0JBQ0wzQixNQUFNbkMsS0FBS21DLElBQUk7Z0JBQ2ZKLE1BQU0vQixLQUFLK0IsSUFBSSxDQUFDQyxVQUFVLENBQUMsWUFBWSxVQUFVO1lBQ25EO1FBQ0Y7SUFFRixFQUFFLE9BQU9uQixPQUFPO1FBQ2RnRCxRQUFRaEQsS0FBSyxDQUFDLHNCQUFzQkE7UUFDcEMsT0FBTzFCLGtGQUFZQSxDQUFDaUIsSUFBSSxDQUN0QjtZQUFFQyxTQUFTLHFCQUFzQlEsQ0FBQUEsaUJBQWlCaUUsUUFBUWpFLE1BQU1SLE9BQU8sR0FBRyxRQUFPO1FBQUcsR0FDcEY7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaXZpbC1lbmdpbmVlcmluZy1wbGF0Zm9ybS8uL3NyYy9hcHAvYXBpL2NoYXQvdXBsb2FkL3JvdXRlLnRzPzIwNzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuXG5jb25zdCBzdXBhYmFzZUFkbWluID0gY3JlYXRlQ2xpZW50KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZISxcbiAge1xuICAgIGF1dGg6IHtcbiAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxuICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlXG4gICAgfVxuICB9XG4pXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKClcbiAgICBjb25zdCBmaWxlID0gZm9ybURhdGEuZ2V0KCdmaWxlJykgYXMgRmlsZVxuICAgIGNvbnN0IHJvb21JZCA9IGZvcm1EYXRhLmdldCgncm9vbUlkJykgYXMgc3RyaW5nXG4gICAgY29uc3QgY29tbWVudCA9IGZvcm1EYXRhLmdldCgnY29tbWVudCcpIGFzIHN0cmluZ1xuXG4gICAgaWYgKCFmaWxlIHx8ICFyb29tSWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiAn44OV44Kh44Kk44Or44Go44Or44O844OgSUTjgYzlv4XopoHjgafjgZknIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIOODpuODvOOCtuODvOOBruiqjeiovFxuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJylcbiAgICBpZiAoIWF1dGhIZWFkZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiAn6KqN6Ki844GM5b+F6KaB44Gn44GZJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIucmVwbGFjZSgnQmVhcmVyICcsICcnKVxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5nZXRVc2VyKHRva2VuKVxuXG4gICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IG1lc3NhZ2U6ICfoqo3oqLzjgavlpLHmlZfjgZfjgb7jgZfjgZ8nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIOODpuODvOOCtuODvOODl+ODreODleOCo+ODvOODq+OCkuWPluW+l1xuICAgIGNvbnN0IHsgZGF0YTogdXNlclByb2ZpbGUsIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuc2VsZWN0KCdpZCwgZW1haWwsIGRpc3BsYXlfbmFtZScpXG4gICAgICAuZXEoJ2F1dGhfdXNlcl9pZCcsIHVzZXIuaWQpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1c2VyRXJyb3IgfHwgIXVzZXJQcm9maWxlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ+ODpuODvOOCtuODvOODl+ODreODleOCo+ODvOODq+OBjOimi+OBpOOBi+OCiuOBvuOBm+OCkycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g44OX44Ot44K444Kn44Kv44OISUTjgpLlj5blvpdcbiAgICBjb25zdCBwcm9qZWN0SWQgPSByb29tSWQucmVwbGFjZSgncHJvamVjdF8nLCAnJylcblxuICAgIC8vIOODl+ODreOCuOOCp+OCr+ODiOOBruWtmOWcqOeiuuiqjeOBqOOCouOCr+OCu+OCueaoqemZkOODgeOCp+ODg+OCr1xuICAgIGNvbnN0IHsgZGF0YTogcHJvamVjdCwgZXJyb3I6IHByb2plY3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oJ3Byb2plY3RzJylcbiAgICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgb3JnX2lkLCBjb250cmFjdG9yX2lkJylcbiAgICAgIC5lcSgnaWQnLCBwcm9qZWN0SWQpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmIChwcm9qZWN0RXJyb3IgfHwgIXByb2plY3QpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiAn44OX44Ot44K444Kn44Kv44OI44GM6KaL44Gk44GL44KK44G+44Gb44KTJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyDjgqLjgq/jgrvjgrnmqKnpmZDjgpLjg4Hjgqfjg4Pjgq9cbiAgICBjb25zdCB7IGRhdGE6IG1lbWJlcnNoaXAgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKCdtZW1iZXJzaGlwcycpXG4gICAgICAuc2VsZWN0KCdvcmdfaWQsIHJvbGUnKVxuICAgICAgLmVxKCd1c2VyX2lkJywgdXNlclByb2ZpbGUuaWQpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGNvbnN0IGhhc0FjY2VzcyA9IG1lbWJlcnNoaXA/Lm9yZ19pZCA9PT0gcHJvamVjdC5vcmdfaWQgfHwgcHJvamVjdC5jb250cmFjdG9yX2lkID09PSB1c2VyUHJvZmlsZS5pZFxuXG4gICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiAn44GT44Gu44OX44Ot44K444Kn44Kv44OI44G444Gu44Ki44Kv44K744K55qip6ZmQ44GM44GC44KK44G+44Gb44KTJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyDjg5XjgqHjgqTjg6vjgrXjgqTjgrrjg4Hjgqfjg4Pjgq/vvIjli5XnlLvjg5XjgqHjgqTjg6vjga8zMDBNQuOAgeOBneOBruS7luOBrzEwME1C5Yi26ZmQ77yJXG4gICAgY29uc3QgaXNWaWRlb0ZpbGUgPSBmaWxlLnR5cGUuc3RhcnRzV2l0aCgndmlkZW8vJylcbiAgICBjb25zdCBtYXhTaXplID0gaXNWaWRlb0ZpbGUgPyAzMDAgKiAxMDI0ICogMTAyNCA6IDEwMCAqIDEwMjQgKiAxMDI0XG4gICAgY29uc3QgbWF4U2l6ZVRleHQgPSBpc1ZpZGVvRmlsZSA/ICczMDBNQicgOiAnMTAwTUInXG4gICAgXG4gICAgaWYgKGZpbGUuc2l6ZSA+IG1heFNpemUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiBg44OV44Kh44Kk44Or44K144Kk44K644GM5aSn44GN44GZ44GO44G+44GZ77yIJHttYXhTaXplVGV4dH3ku6XkuIvjgavjgZfjgabjgY/jgaDjgZXjgYTvvIlgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIOODleOCoeOCpOODq+OCv+OCpOODl+ODgeOCp+ODg+OCr1xuICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IFtcbiAgICAgICdpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9naWYnLCAnaW1hZ2Uvd2VicCcsXG4gICAgICAndmlkZW8vbXA0JywgJ3ZpZGVvL2F2aScsICd2aWRlby9tb3YnLCAndmlkZW8vd212JywgJ3ZpZGVvL2ZsdicsICd2aWRlby93ZWJtJywgJ3ZpZGVvL21rdicsXG4gICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICdhcHBsaWNhdGlvbi9tc3dvcmQnLFxuICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JyxcbiAgICAgICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLFxuICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JyxcbiAgICAgICd0ZXh0L3BsYWluJyxcbiAgICAgICdhcHBsaWNhdGlvbi96aXAnLFxuICAgICAgJ2FwcGxpY2F0aW9uL3gtemlwLWNvbXByZXNzZWQnLFxuICAgICAgJ2FwcGxpY2F0aW9uL2R3ZycsXG4gICAgICAnYXBwbGljYXRpb24veC1kd2cnLFxuICAgICAgJ2FwcGxpY2F0aW9uL2FjYWQnLFxuICAgICAgJ2FwcGxpY2F0aW9uL3gtYWNhZCcsXG4gICAgICAnYXBwbGljYXRpb24vc3RlcCcsXG4gICAgICAnYXBwbGljYXRpb24veC1zdGVwJyxcbiAgICAgICdhcHBsaWNhdGlvbi9pZ2VzJyxcbiAgICAgICdhcHBsaWNhdGlvbi94LWlnZXMnLFxuICAgICAgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcbiAgICBdXG5cbiAgICBjb25zdCBhbGxvd2VkRXh0ZW5zaW9ucyA9IFtcbiAgICAgICdkd2cnLCAncDIxJywgJ3NmYycsICdiZm8nLCAnc3RlcCcsICdzdHAnLCAnaWdlcycsICdpZ3MnXG4gICAgXVxuICAgIFxuICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSBmaWxlLm5hbWUuc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKVxuICAgIGNvbnN0IGlzQWxsb3dlZEV4dGVuc2lvbiA9IGFsbG93ZWRFeHRlbnNpb25zLmluY2x1ZGVzKGZpbGVFeHRlbnNpb24gfHwgJycpXG4gICAgY29uc3QgaXNBbGxvd2VkTWltZVR5cGUgPSBhbGxvd2VkVHlwZXMuaW5jbHVkZXMoZmlsZS50eXBlKVxuICAgIFxuICAgIGlmICghaXNBbGxvd2VkTWltZVR5cGUgJiYgIWlzQWxsb3dlZEV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IG1lc3NhZ2U6ICfjgrXjg53jg7zjg4jjgZXjgozjgabjgYTjgarjgYTjg5XjgqHjgqTjg6vlvaLlvI/jgafjgZknIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIOODleOCoeOCpOODq+OCklN1cGFiYXNlIFN0b3JhZ2XjgavjgqLjg4Pjg5fjg63jg7zjg4lcbiAgICBjb25zdCBmaWxlRXh0ID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKClcbiAgICBjb25zdCBmaWxlTmFtZSA9IGAke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpfS4ke2ZpbGVFeHR9YFxuICAgIGNvbnN0IGZpbGVQYXRoID0gYGNoYXQtYXR0YWNobWVudHMvJHtyb29tSWR9LyR7ZmlsZU5hbWV9YFxuXG4gICAgY29uc3QgeyBkYXRhOiB1cGxvYWREYXRhLCBlcnJvcjogdXBsb2FkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uc3RvcmFnZVxuICAgICAgLmZyb20oJ2F0dGFjaG1lbnRzJylcbiAgICAgIC51cGxvYWQoZmlsZVBhdGgsIGZpbGUsIHtcbiAgICAgICAgY2FjaGVDb250cm9sOiAnMzYwMCcsXG4gICAgICAgIHVwc2VydDogZmFsc2VcbiAgICAgIH0pXG5cbiAgICBpZiAodXBsb2FkRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+ODleOCoeOCpOODq+OCouODg+ODl+ODreODvOODieOCqOODqeODvDonLCB1cGxvYWRFcnJvcilcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBtZXNzYWdlOiAn44OV44Kh44Kk44Or44Gu44Ki44OD44OX44Ot44O844OJ44Gr5aSx5pWX44GX44G+44GX44GfOiAnICsgdXBsb2FkRXJyb3IubWVzc2FnZSB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyDlhazplotVUkzjgpLlj5blvpdcbiAgICBjb25zdCB7IGRhdGE6IHsgcHVibGljVXJsIH0gfSA9IHN1cGFiYXNlQWRtaW4uc3RvcmFnZVxuICAgICAgLmZyb20oJ2F0dGFjaG1lbnRzJylcbiAgICAgIC5nZXRQdWJsaWNVcmwoZmlsZVBhdGgpXG5cbiAgICAvLyBzZW5kZXJfdHlwZeOCkuaxuuWumlxuICAgIGNvbnN0IHNlbmRlclR5cGUgPSBtZW1iZXJzaGlwPy5vcmdfaWQgPT09IHByb2plY3Qub3JnX2lkID8gJ2NsaWVudCcgOiAnY29udHJhY3RvcidcblxuICAgIC8vIOODoeODg+OCu+ODvOOCuOWGheWuueOCkuaxuuWumu+8iOOCs+ODoeODs+ODiOOBjOOBguOCi+WgtOWQiOOBr+OCs+ODoeODs+ODiOOAgeOBquOBhOWgtOWQiOOBr+ODleOCoeOCpOODq+WQje+8iVxuICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gY29tbWVudC50cmltKCkgPyBjb21tZW50IDogZmlsZS5uYW1lXG5cbiAgICAvLyDjg4Hjg6Pjg4Pjg4jjg6Hjg4Pjgrvjg7zjgrjjgpLkv53lrZhcbiAgICBjb25zdCB7IGRhdGE6IG1lc3NhZ2VEYXRhLCBlcnJvcjogbWVzc2FnZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgnY2hhdF9tZXNzYWdlcycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgcHJvamVjdF9pZDogcHJvamVjdElkLFxuICAgICAgICBzZW5kZXJfaWQ6IHVzZXJQcm9maWxlLmlkLFxuICAgICAgICBzZW5kZXJfdHlwZTogc2VuZGVyVHlwZSxcbiAgICAgICAgbWVzc2FnZTogbWVzc2FnZUNvbnRlbnQsXG4gICAgICAgIGZpbGVfdXJsOiBwdWJsaWNVcmwsXG4gICAgICAgIGZpbGVfbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICBmaWxlX3NpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgbWVzc2FnZV90eXBlOiBmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykgPyAnaW1hZ2UnIDogXG4gICAgICAgICAgICAgICAgICAgICBmaWxlLnR5cGUuc3RhcnRzV2l0aCgndmlkZW8vJykgPyAndmlkZW8nIDogJ2ZpbGUnXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmIChtZXNzYWdlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+ODgeODo+ODg+ODiOODoeODg+OCu+ODvOOCuOS/neWtmOOCqOODqeODvDonLCBtZXNzYWdlRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgbWVzc2FnZTogJ+ODoeODg+OCu+ODvOOCuOOBruS/neWtmOOBq+WkseaVl+OBl+OBvuOBl+OBnzogJyArIG1lc3NhZ2VFcnJvci5tZXNzYWdlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBtZXNzYWdlOiAn44OV44Kh44Kk44Or44GM44Ki44OD44OX44Ot44O844OJ44GV44KM44G+44GX44GfJyxcbiAgICAgIGZpbGU6IHtcbiAgICAgICAgaWQ6IG1lc3NhZ2VEYXRhLmlkLFxuICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgIHVybDogcHVibGljVXJsLFxuICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgIHR5cGU6IGZpbGUudHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSA/ICdpbWFnZScgOiAnZmlsZSdcbiAgICAgIH1cbiAgICB9KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign44OV44Kh44Kk44Or44Ki44OD44OX44Ot44O844OJQVBJIOOCqOODqeODvDonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IG1lc3NhZ2U6ICfjgrXjg7zjg5Djg7zjgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ86ICcgKyAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAn5LiN5piO44Gq44Ko44Op44O8JykgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlQWRtaW4iLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iLCJQT1NUIiwicmVxdWVzdCIsImZvcm1EYXRhIiwiZmlsZSIsImdldCIsInJvb21JZCIsImNvbW1lbnQiLCJqc29uIiwibWVzc2FnZSIsInN0YXR1cyIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwidG9rZW4iLCJyZXBsYWNlIiwiZGF0YSIsInVzZXIiLCJlcnJvciIsImF1dGhFcnJvciIsImdldFVzZXIiLCJ1c2VyUHJvZmlsZSIsInVzZXJFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwicHJvamVjdElkIiwicHJvamVjdCIsInByb2plY3RFcnJvciIsIm1lbWJlcnNoaXAiLCJoYXNBY2Nlc3MiLCJvcmdfaWQiLCJjb250cmFjdG9yX2lkIiwiaXNWaWRlb0ZpbGUiLCJ0eXBlIiwic3RhcnRzV2l0aCIsIm1heFNpemUiLCJtYXhTaXplVGV4dCIsInNpemUiLCJhbGxvd2VkVHlwZXMiLCJhbGxvd2VkRXh0ZW5zaW9ucyIsImZpbGVFeHRlbnNpb24iLCJuYW1lIiwic3BsaXQiLCJwb3AiLCJ0b0xvd2VyQ2FzZSIsImlzQWxsb3dlZEV4dGVuc2lvbiIsImluY2x1ZGVzIiwiaXNBbGxvd2VkTWltZVR5cGUiLCJmaWxlRXh0IiwiZmlsZU5hbWUiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwiZmlsZVBhdGgiLCJ1cGxvYWREYXRhIiwidXBsb2FkRXJyb3IiLCJzdG9yYWdlIiwidXBsb2FkIiwiY2FjaGVDb250cm9sIiwidXBzZXJ0IiwiY29uc29sZSIsInB1YmxpY1VybCIsImdldFB1YmxpY1VybCIsInNlbmRlclR5cGUiLCJtZXNzYWdlQ29udGVudCIsInRyaW0iLCJtZXNzYWdlRGF0YSIsIm1lc3NhZ2VFcnJvciIsImluc2VydCIsInByb2plY3RfaWQiLCJzZW5kZXJfaWQiLCJzZW5kZXJfdHlwZSIsImZpbGVfdXJsIiwiZmlsZV9uYW1lIiwiZmlsZV9zaXplIiwibWVzc2FnZV90eXBlIiwidXJsIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/chat/upload/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fchat%2Fupload%2Froute&page=%2Fapi%2Fchat%2Fupload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Fupload%2Froute.ts&appDir=%2FUsers%2Fsayuri%2Fcaddonworks%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsayuri%2Fcaddonworks&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();