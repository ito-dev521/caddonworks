"use strict";(()=>{var e={};e.id=9921,e.ids=[9921],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},24548:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>j,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>_,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var a={};t.r(a),t.d(a,{GET:()=>u});var s=t(95419),o=t(69108),i=t(99678),d=t(78070);let n=(0,t(32409).eI)("https://rxnozwuamddqlcwysxag.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function u(e,{params:r}){try{let t=r.id;if(!t)return d.Z.json({message:"入札IDが必要です"},{status:400});let a=e.headers.get("authorization");if(!a)return d.Z.json({message:"認証が必要です"},{status:401});let s=a.replace("Bearer ",""),{data:{user:o},error:i}=await n.auth.getUser(s);if(i||!o)return d.Z.json({message:"認証に失敗しました"},{status:401});let{data:u,error:c}=await n.from("users").select("id").eq("auth_user_id",o.id).single();if(c||!u)return d.Z.json({message:"ユーザープロフィールが見つかりません"},{status:403});let{data:l,error:p}=await n.from("bids").select("*").eq("id",t).single();if(p||!l)return d.Z.json({message:"入札が見つかりません"},{status:404});let{data:_,error:m}=await n.from("projects").select("*").eq("id",l.project_id).single();m&&console.error("案件情報取得エラー:",m);let{data:g,error:j}=await n.from("organizations").select("name").eq("id",_?.org_id).single();j&&console.error("組織情報取得エラー:",j);let{data:h,error:f}=await n.from("users").select("display_name, email").eq("id",l.contractor_id).single();f&&console.error("受注者情報取得エラー:",f);let{data:b,error:q}=await n.from("memberships").select("role, org_id").eq("user_id",u.id).single();if(q||!b)return d.Z.json({message:"組織情報が見つかりません"},{status:403});let x="OrgAdmin"===b.role&&_?.org_id===b.org_id,w="Contractor"===b.role&&l.contractor_id===u.id;if(!x&&!w)return d.Z.json({message:"この入札を閲覧する権限がありません"},{status:403});let y={id:l.id,project_id:l.project_id,contractor_id:l.contractor_id,bid_amount:l.bid_amount,message:l.message,created_at:l.created_at,contractor_name:h?.display_name,contractor_email:h?.email,project_title:_?.title,project_description:_?.description,project_budget:_?.budget,project_start_date:_?.start_date,project_end_date:_?.end_date,project_category:_?.category,project_org_id:_?.org_id,project_org_name:g?.name};return d.Z.json({bid:y},{status:200})}catch(e){return console.error("入札取得APIエラー:",e),d.Z.json({message:"サーバーエラーが発生しました"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/bids/[id]/route",pathname:"/api/bids/[id]",filename:"route",bundlePath:"app/api/bids/[id]/route"},resolvedPagePath:"/Users/sayuri/caddonworks/src/app/api/bids/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:_,headerHooks:m,staticGenerationBailout:g}=c,j="/api/bids/[id]/route";function h(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:p})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206,2409],()=>t(24548));module.exports=a})();