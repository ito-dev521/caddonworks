(()=>{var e={};e.id=5760,e.ids=[5760],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},5764:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.ZP,__next_app__:()=>x,originalPathname:()=>o,pages:()=>d,routeModule:()=>m,tree:()=>c});var a=t(50482),r=t(69108),i=t(83543),n=t(68300),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(s,l);let c=["",{children:["invoices",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,93368)),"/Users/sayuri/caddonworks/src/app/invoices/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,61623)),"/Users/sayuri/caddonworks/src/app/layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,24117)),"/Users/sayuri/caddonworks/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,48206)),"/Users/sayuri/caddonworks/src/app/not-found.tsx"]}],d=["/Users/sayuri/caddonworks/src/app/invoices/page.tsx"],o="/invoices/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/invoices/page",pathname:"/invoices",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},88194:(e,s,t)=>{Promise.resolve().then(t.bind(t,35380))},7060:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(69224).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},25545:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(69224).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},42739:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},36135:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(69224).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},35380:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>f});var a=t(95344),r=t(3729),i=t(57916),n=t(66138),l=t(25545),c=t(7060),d=t(37121),o=t(14513),x=t(36135),m=t(35851),u=t(76586),h=t(83655),g=t(5094),p=t(23673),j=t(19591),y=t(43750),b=t(18704);function f(){return a.jsx(u.AuthGuard,{children:a.jsx(v,{})})}function v(){let{userProfile:e,userRole:s}=(0,y.useAuth)(),[t,u]=(0,r.useState)([]),[f,v]=(0,r.useState)(!0),[N,w]=(0,r.useState)(null),[k,_]=(0,r.useState)(!1),[C,P]=(0,r.useState)({subject:"",message:""}),[A,S]=(0,r.useState)(!1),Z=async()=>{if(e)try{v(!0);let{data:{session:s}}=await b.OQ.auth.getSession();if(!s)return;let t=await fetch(`/api/invoices/contractor/${e.id}`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(t.ok){let e=await t.json();u(e.invoices||[])}}catch(e){console.error("請求書取得エラー:",e)}finally{v(!1)}},q=async e=>{try{let{data:{session:s}}=await b.OQ.auth.getSession();if(!s)return;let t=await fetch(`/api/invoices/${e}/issue`,{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`}}),a=await t.json();t.ok?(alert("請求書を発行しました。"),await Z(),w(null)):alert("請求書発行に失敗しました: "+a.message)}catch(e){console.error("請求書発行エラー:",e),alert("ネットワークエラーが発生しました")}},z=async()=>{if(!C.subject.trim()||!C.message.trim()){alert("件名とメッセージを入力してください");return}try{S(!0);let{data:{session:e}}=await b.OQ.auth.getSession();if(!e)return;let s=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({subject:C.subject,message:C.message,related_invoice_id:N?.id,type:"invoice_inquiry"})}),t=await s.json();s.ok?(alert("問い合わせを送信しました。"),_(!1),P({subject:"",message:""})):alert("問い合わせ送信に失敗しました: "+t.message)}catch(e){console.error("問い合わせ送信エラー:",e),alert("ネットワークエラーが発生しました")}finally{S(!1)}};if((0,r.useEffect)(()=>{e&&"Contractor"===s&&Z()},[e,s]),"Contractor"!==s)return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(h.W,{}),a.jsx("div",{className:"md:ml-64 transition-all duration-300",children:a.jsx("main",{className:"px-6 py-8",children:a.jsx("div",{className:"max-w-4xl mx-auto",children:a.jsx(p.Zb,{children:(0,a.jsxs)(p.aY,{className:"p-8 text-center",children:[a.jsx(n.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),a.jsx("p",{className:"text-gray-600",children:"このページは受注者のみアクセス可能です。"})]})})})})})]});let E=e=>{switch(e){case"draft":return a.jsx(j.C,{variant:"outline",className:"text-gray-600",children:"下書き"});case"issued":return a.jsx(j.C,{variant:"default",className:"bg-green-600",children:"発行済み"});case"paid":return a.jsx(j.C,{variant:"default",className:"bg-blue-600",children:"支払済み"});default:return a.jsx(j.C,{variant:"outline",children:e})}},O=e=>{switch(e){case"draft":return a.jsx(l.Z,{className:"w-5 h-5 text-gray-600"});case"issued":return a.jsx(c.Z,{className:"w-5 h-5 text-green-600"});case"paid":return a.jsx(c.Z,{className:"w-5 h-5 text-blue-600"});default:return a.jsx(n.Z,{className:"w-5 h-5 text-gray-600"})}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-mesh",children:[a.jsx(h.W,{}),a.jsx("div",{className:"md:ml-64 transition-all duration-300",children:a.jsx("main",{className:"px-6 py-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:a.jsx("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"請求書管理"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"発注者から作成された請求書を確認し、発行してください"})]})})}),a.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,a.jsxs)(p.Zb,{children:[a.jsx(p.Ol,{children:(0,a.jsxs)(p.ll,{className:"flex items-center gap-2",children:[a.jsx(d.Z,{className:"w-5 h-5"}),"請求書一覧"]})}),a.jsx(p.aY,{children:f?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-engineering-blue mx-auto"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"読み込み中..."})]}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[a.jsx(d.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"請求書はありません"})]}):a.jsx("div",{className:"space-y-4",children:t.map(e=>a.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[O(e.status),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:e.invoice_number}),a.jsx("p",{className:"text-sm text-gray-600",children:e.project.title}),a.jsx("p",{className:"text-sm text-gray-500",children:e.client_org.name})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["\xa5",e.total_amount.toLocaleString()]}),a.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.issue_date).toLocaleDateString("ja-JP")})]}),E(e.status),a.jsx(g.z,{variant:"outline",size:"sm",onClick:()=>w(e),children:"詳細"})]})]})},e.id))})})]})}),N&&a.jsx(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>w(null),children:a.jsx(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"請求書詳細"}),a.jsx(g.z,{variant:"ghost",size:"icon",onClick:()=>w(null),children:a.jsx(o.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"請求書番号"}),a.jsx("p",{className:"text-gray-900",children:N.invoice_number})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ステータス"}),E(N.status)]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発行日"}),a.jsx("p",{className:"text-gray-900",children:new Date(N.issue_date).toLocaleDateString("ja-JP")})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支払期限"}),a.jsx("p",{className:"text-gray-900",children:new Date(N.due_date).toLocaleDateString("ja-JP")})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"案件名"}),a.jsx("p",{className:"text-gray-900",children:N.project.title})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発注者"}),a.jsx("p",{className:"text-gray-900",children:N.client_org.name})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"金額詳細"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"契約金額"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",N.base_amount.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"システム手数料"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",N.system_fee.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[a.jsx("span",{className:"text-gray-900",children:"合計金額"}),(0,a.jsxs)("span",{className:"text-gray-900",children:["\xa5",N.total_amount.toLocaleString()]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4 border-t",children:["draft"===N.status&&(0,a.jsxs)(g.z,{onClick:()=>q(N.id),className:"bg-engineering-blue hover:bg-engineering-blue/90",children:[a.jsx(x.Z,{className:"w-4 h-4 mr-2"}),"請求書を発行"]}),(0,a.jsxs)(g.z,{variant:"outline",onClick:()=>_(!0),children:[a.jsx(m.Z,{className:"w-4 h-4 mr-2"}),"問い合わせ"]})]})]})]})})}),k&&a.jsx(i.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>_(!1),children:a.jsx(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-xl max-w-md w-full",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"問い合わせ"}),a.jsx(g.z,{variant:"ghost",size:"icon",onClick:()=>_(!1),children:a.jsx(o.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"件名 *"}),a.jsx("input",{type:"text",value:C.subject,onChange:e=>P(s=>({...s,subject:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"件名を入力してください"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メッセージ *"}),a.jsx("textarea",{value:C.message,onChange:e=>P(s=>({...s,message:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent",placeholder:"問い合わせ内容を入力してください"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx(g.z,{onClick:z,disabled:A,className:"bg-engineering-blue hover:bg-engineering-blue/90",children:A?"送信中...":"送信"}),a.jsx(g.z,{variant:"outline",onClick:()=>_(!1),children:"キャンセル"})]})]})]})})})]})})})]})}},76586:(e,s,t)=>{"use strict";t.r(s),t.d(s,{AuthGuard:()=>d,useRoleAccess:()=>x,withAuth:()=>o});var a=t(95344),r=t(3729),i=t(22254),n=t(57916),l=t(42739),c=t(43750);function d({children:e,requiredRole:s,allowedRoles:t,redirectTo:d="/auth/login"}){let{user:o,userRole:x,loading:m}=(0,c.useAuth)(),u=(0,i.useRouter)(),h=(0,i.usePathname)(),g=(0,r.useRef)(!1);return((0,r.useEffect)(()=>{if(!m&&!g.current){if(!o){sessionStorage.setItem("redirectAfterLogin",h),h!==d&&(g.current=!0,u.push(d));return}if(s&&x!==s||t&&t.length>0&&(!x||!t.includes(x))){"/unauthorized"!==h&&(g.current=!0,u.push("/unauthorized"));return}}},[o,x,m,s,t,u,d,h]),m)?a.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:a.jsx(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),a.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!o||s&&x!==s||t&&t.length>0&&(!x||!t.includes(x))?null:a.jsx(a.Fragment,{children:e})}function o(e,s){return function(t){return a.jsx(d,{requiredRole:s,children:a.jsx(e,{...t})})}}function x(){let{userRole:e}=(0,c.useAuth)(),s=s=>e===s,t=s=>!!e&&s.includes(e);return{hasRole:s,hasAnyRole:t,isAdmin:()=>s("OrgAdmin"),isStaff:()=>s("Staff"),isContractor:()=>s("Contractor"),isReviewer:()=>s("Reviewer"),isAuditor:()=>s("Auditor"),canManageProjects:()=>t(["OrgAdmin","Staff"]),canViewFinancials:()=>t(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>t(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>t(["Auditor","OrgAdmin"])}}},93368:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>r,default:()=>n});let a=(0,t(86843).createProxy)(String.raw`/Users/sayuri/caddonworks/src/app/invoices/page.tsx`),{__esModule:r,$$typeof:i}=a,n=a.default}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[1638,4679,3035,7962,5414,5188,1682],()=>t(5764));module.exports=a})();