(()=>{var e={};e.id=9674,e.ids=[9674],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},8913:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.ZP,__next_app__:()=>u,originalPathname:()=>o,pages:()=>d,routeModule:()=>x,tree:()=>c});var r=t(50482),a=t(69108),i=t(83543),n=t(68300),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(s,l);let c=["",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,75002)),"/Users/sayuri/caddonworks/src/app/admin/users/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,61623)),"/Users/sayuri/caddonworks/src/app/layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,24117)),"/Users/sayuri/caddonworks/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,48206)),"/Users/sayuri/caddonworks/src/app/not-found.tsx"]}],d=["/Users/sayuri/caddonworks/src/app/admin/users/page.tsx"],o="/admin/users/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},42430:(e,s,t)=>{Promise.resolve().then(t.bind(t,45289))},55794:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},42739:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},80508:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},75695:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},40626:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},31498:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},28765:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},23485:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(69224).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},45289:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>k});var r=t(95344),a=t(3729),i=t(57916),n=t(23485),l=t(28765),c=t(18822),d=t(40626),o=t(80508),u=t(55794),x=t(31498),m=t(14513),h=t(75695),p=t(89895),g=t(59659),y=t(23673),j=t(19591),f=t(5094),v=t(43750),b=t(18704),N=t(76586),w=t(91684);function k(){return r.jsx(N.AuthGuard,{children:r.jsx(Z,{})})}function Z(){let{userProfile:e,userRole:s,loading:t}=(0,v.useAuth)(),[N,k]=(0,a.useState)([]),[Z,_]=(0,a.useState)([]),[A,q]=(0,a.useState)(""),[P,C]=(0,a.useState)(null),[S,z]=(0,a.useState)("beginner"),[E,L]=(0,a.useState)(!0),[M,O]=(0,a.useState)(!1);if("Admin"!==s)return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(g.W,{}),r.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"アクセス拒否"}),r.jsx("p",{className:"text-gray-600",children:"このページにアクセスするには運営者権限が必要です。"})]})})]});let R=async()=>{try{L(!0);let{data:{session:e}}=await b.OQ.auth.getSession();if(!e)throw Error("セッションが見つかりません");let s=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}});if(!s.ok)throw Error("ユーザー一覧の取得に失敗しました");let t=await s.json();k(t.users||[]),_(t.users||[])}catch(e){console.error("ユーザー一覧取得エラー:",e),alert("ユーザー一覧の取得に失敗しました")}finally{L(!1)}},U=async(e,s)=>{try{O(!0);let{data:{session:t}}=await b.OQ.auth.getSession();if(!t)throw Error("セッションが見つかりません");if(!(await fetch("/api/admin/users",{method:"PUT",headers:{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,memberLevel:s})})).ok)throw Error("会員レベルの更新に失敗しました");k(t=>t.map(t=>t.id===e?{...t,member_level:s}:t)),_(t=>t.map(t=>t.id===e?{...t,member_level:s}:t)),C(null),alert("会員レベルが正常に更新されました")}catch(e){console.error("会員レベル更新エラー:",e),alert("会員レベルの更新に失敗しました")}finally{O(!1)}};return((0,a.useEffect)(()=>{A?_(N.filter(e=>e.display_name.toLowerCase().includes(A.toLowerCase())||e.email.toLowerCase().includes(A.toLowerCase())||e.formal_name?.toLowerCase().includes(A.toLowerCase()))):_(N)},[A,N]),(0,a.useEffect)(()=>{R()},[]),t||E)?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(g.W,{}),r.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-engineering-blue mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"読み込み中..."})]})})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(g.W,{}),r.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3",children:[r.jsx(n.Z,{className:"w-8 h-8 text-engineering-blue"}),"ユーザー管理"]}),r.jsx("p",{className:"text-gray-600",children:"全ユーザーの会員レベルを管理できます"})]}),r.jsx(y.Zb,{className:"mb-6",children:r.jsx(y.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx(l.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",placeholder:"ユーザー名、メールアドレス、氏名で検索...",value:A,onChange:e=>q(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-engineering-blue focus:border-transparent"})]})})}),r.jsx("div",{className:"grid gap-6",children:Z.map(e=>r.jsx(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsx(y.Zb,{className:"hover:shadow-lg transition-shadow",children:r.jsx(y.aY,{className:"p-6",children:r.jsx("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"w-12 h-12 bg-engineering-blue rounded-full flex items-center justify-center text-white font-bold text-lg",children:e.display_name.charAt(0).toUpperCase()}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.display_name}),r.jsx("p",{className:"text-sm text-gray-600",children:e.email})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.formal_name&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(c.Z,{className:"w-4 h-4"}),e.formal_name]}),e.phone_number&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(d.Z,{className:"w-4 h-4"}),e.phone_number]}),e.address&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(o.Z,{className:"w-4 h-4"}),e.address]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(u.Z,{className:"w-4 h-4"}),"登録日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),r.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:e.specialties?.map((e,s)=>r.jsx(j.C,{variant:"outline",className:"text-xs",children:e},s))}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"会員レベル:"}),P===e.id?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("select",{value:S,onChange:e=>z(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:Object.values(w.DY).map(e=>r.jsx("option",{value:e.level,children:e.label},e.level))}),r.jsx(f.z,{size:"sm",onClick:()=>U(e.id,S),disabled:M,className:"bg-green-600 hover:bg-green-700",children:r.jsx(x.Z,{className:"w-4 h-4"})}),r.jsx(f.z,{size:"sm",variant:"outline",onClick:()=>C(null),disabled:M,children:r.jsx(m.Z,{className:"w-4 h-4"})})]}):(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(j.C,{className:w.DY[e.member_level||"beginner"].color,children:w.DY[e.member_level||"beginner"].label}),r.jsx(f.z,{size:"sm",variant:"outline",onClick:()=>{C(e.id),z(e.member_level||"beginner")},children:r.jsx(h.Z,{className:"w-4 h-4"})})]})]})]})})})})},e.id))}),0===Z.length&&r.jsx(y.Zb,{children:(0,r.jsxs)(y.aY,{className:"p-8 text-center",children:[r.jsx(p.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ユーザーが見つかりません"}),r.jsx("p",{className:"text-gray-600",children:A?"検索条件に一致するユーザーがありません":"ユーザーが登録されていません"})]})})]})})]})}},76586:(e,s,t)=>{"use strict";t.r(s),t.d(s,{AuthGuard:()=>d,useRoleAccess:()=>u,withAuth:()=>o});var r=t(95344),a=t(3729),i=t(22254),n=t(57916),l=t(42739),c=t(43750);function d({children:e,requiredRole:s,allowedRoles:t,redirectTo:d="/auth/login"}){let{user:o,userRole:u,loading:x}=(0,c.useAuth)(),m=(0,i.useRouter)(),h=(0,i.usePathname)(),p=(0,a.useRef)(!1);return((0,a.useEffect)(()=>{if(!x&&!p.current){if(!o){sessionStorage.setItem("redirectAfterLogin",h),h!==d&&(p.current=!0,m.push(d));return}if(s&&u!==s||t&&t.length>0&&(!u||!t.includes(u))){"/unauthorized"!==h&&(p.current=!0,m.push("/unauthorized"));return}}},[o,u,x,s,t]),x)?r.jsx("div",{className:"min-h-screen bg-gradient-mesh flex items-center justify-center",children:(0,r.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-engineering-blue rounded-xl flex items-center justify-center mx-auto mb-4",children:r.jsx(l.Z,{className:"w-8 h-8 text-white animate-spin"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"認証確認中..."}),r.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください"})]})}):!o||s&&u!==s||t&&t.length>0&&(!u||!t.includes(u))?null:r.jsx(r.Fragment,{children:e})}function o(e,s){return function(t){return r.jsx(d,{requiredRole:s,children:r.jsx(e,{...t})})}}function u(){let{userRole:e}=(0,c.useAuth)(),s=s=>e===s,t=s=>!!e&&s.includes(e);return{hasRole:s,hasAnyRole:t,isAdmin:()=>s("OrgAdmin"),isStaff:()=>s("Staff"),isContractor:()=>s("Contractor"),isReviewer:()=>s("Reviewer"),isAuditor:()=>s("Auditor"),canManageProjects:()=>t(["OrgAdmin","Staff"]),canViewFinancials:()=>t(["OrgAdmin","Staff","Auditor"]),canReviewProjects:()=>t(["Reviewer","OrgAdmin"]),canViewAuditLogs:()=>t(["Auditor","OrgAdmin"])}}},91684:(e,s,t)=>{"use strict";t.d(s,{$9:()=>a,DY:()=>r,qf:()=>i});let r={beginner:{level:"beginner",label:"初級",description:"経験年数3年未満、未経験",color:"bg-green-100 text-green-800"},intermediate:{level:"intermediate",label:"中級",description:"経験年数3年以上7年未満",color:"bg-yellow-100 text-yellow-800"},advanced:{level:"advanced",label:"上級",description:"経験年数7年以上",color:"bg-red-100 text-red-800"}};function a(e,s){if(0===s.length||s.every(e=>"未経験"===e))return"beginner";let t=parseInt(e||"0",10);return t<3?"beginner":t<7?"intermediate":"advanced"}function i(e){return r[e]}},75002:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,t(86843).createProxy)(String.raw`/Users/sayuri/caddonworks/src/app/admin/users/page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[1638,4679,3035,7962,4835,8710,6152],()=>t(8913));module.exports=r})();