exports.id=8710,exports.ids=[8710],exports.modules={33204:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,26840,23)),Promise.resolve().then(s.t.bind(s,38771,23)),Promise.resolve().then(s.t.bind(s,13225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,43982,23))},3933:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,61476,23))},24137:(e,r,s)=>{Promise.resolve().then(s.bind(s,16414))},6402:(e,r,s)=>{Promise.resolve().then(s.bind(s,76534))},40655:(e,r,s)=>{Promise.resolve().then(s.bind(s,43750))},16414:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>n});var t=s(95344),o=s(3729);function n({error:e,reset:r}){return(0,o.useEffect)(()=>{console.error(e)},[e]),t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-lg font-semibold text-gray-900 text-center mb-2",children:"エラーが発生しました"}),t.jsx("p",{className:"text-gray-600 text-center mb-6",children:"申し訳ございません。予期しないエラーが発生しました。"}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:r,className:"flex-1 bg-engineering-blue text-white px-4 py-2 rounded-lg hover:bg-engineering-blue/90 transition-colors",children:"再試行"}),t.jsx("button",{onClick:()=>window.location.href="/",className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",children:"ホームに戻る"})]}),!1]})})}},76534:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>o});var t=s(95344);function o({error:e,reset:r}){return t.jsx("html",{children:t.jsx("body",{children:t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[t.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h2",{className:"text-lg font-semibold text-gray-900 text-center mb-2",children:"システムエラーが発生しました"}),t.jsx("p",{className:"text-gray-600 text-center mb-6",children:"申し訳ございません。システム全体でエラーが発生しました。"}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:r,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"再試行"}),t.jsx("button",{onClick:()=>window.location.href="/",className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",children:"ホームに戻る"})]}),!1]})})})})}},43750:(e,r,s)=>{"use strict";s.r(r),s.d(r,{AuthProvider:()=>a,useAuth:()=>i});var t=s(95344),o=s(3729),n=s(18704);let l=(0,o.createContext)(void 0);function i(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function a({children:e}){let[r,s]=(0,o.useState)(null),[i,a]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)(null),[g,f]=(0,o.useState)(!0),m=(0,o.useRef)(null);(0,o.useEffect)(()=>{(async()=>{try{console.log("AuthProvider: 初期セッション取得開始");let{data:{session:e},error:r}=await n.OQ.auth.getSession();if(r){console.error("AuthProvider: セッション取得エラー:",r),f(!1);return}console.log("AuthProvider: セッション取得結果:",{hasSession:!!e,userId:e?.user?.id,hasAccessToken:!!e?.access_token,tokenLength:e?.access_token?.length}),s(e?.user??null),e?.user&&e?.access_token?(console.log("\uD83D\uDE80 AuthProvider: 初期セッション - ユーザープロフィール取得開始"),setTimeout(()=>{console.log("⏱️ setTimeout実行: fetchUserProfile呼び出し (初期セッション)"),x(e.user.id)},0)):console.log("AuthProvider: セッションまたはトークンなし、ローディング終了")}catch(e){console.error("AuthProvider: 初期化エラー:",e),s(null),a(null),d(null),h(null)}finally{f(!1)}})();let{data:{subscription:e}}=n.OQ.auth.onAuthStateChange(async(e,r)=>{let t=new Date().toISOString();console.log(`🔄 [${t}] Auth state change:`,{event:e,userId:r?.user?.id,hasToken:!!r?.access_token}),s(r?.user??null),r?.user&&"SIGNED_IN"===e?(console.log(`🔑 [${t}] Auth state change: SIGNED_IN, fetching profile`),setTimeout(()=>{console.log(`⏱️ [${t}] setTimeout実行: fetchUserProfile呼び出し (SIGNED_IN)`),x(r.user.id)},0)):"SIGNED_OUT"===e&&(console.log("Auth state change: SIGNED_OUT, clearing profile"),a(null),d(null),h(null)),"INITIAL_SESSION"!==e&&f(!1)});return()=>e.unsubscribe()},[]);let x=async e=>{let r=new Date().toISOString(),s=Error().stack?.split("\n").slice(1,4).join(" -> ");if(console.log(`🔍 [${r}] fetchUserProfile: 開始`,{authUserId:e,fetchingRef:m.current,callStack:s}),m.current===e){console.log(`⚠️ [${r}] fetchUserProfile: 既に実行中のためスキップ`,{authUserId:e});return}m.current=e,console.log(`🏃 [${r}] fetchUserProfile: 実行開始`,{authUserId:e});try{console.log("fetchUserProfile: ユーザープロフィール取得開始");let{data:r,error:s}=await n.OQ.from("users").select("*").eq("auth_user_id",e).single();if(console.log("fetchUserProfile: ユーザープロフィール結果",{profile:r?.id,error:s?.message}),s&&"PGRST116"!==s.code){console.error("Error fetching user profile:",s);return}if(a(r),r){console.log("fetchUserProfile: メンバーシップ取得開始",{profileId:r.id});let{data:e,error:s}=await n.OQ.from("memberships").select("role, org_id").eq("user_id",r.id).single();if(console.log("fetchUserProfile: メンバーシップ結果",{role:e?.role,org_id:e?.org_id,error:s?.message}),s&&"PGRST116"!==s.code){console.error("Error fetching user role:",s);return}if(d(e?.role||null),e?.org_id){let{data:r,error:s}=await n.OQ.from("organizations").select("id, name").eq("id",e.org_id).single();s?(console.error("Error fetching organization:",s),h(null)):h({id:r.id,name:r.name})}else h(null);console.log("fetchUserProfile: 完了",{role:e?.role,organization:e?.org_id})}}catch(e){console.error("Error in fetchUserProfile:",e)}finally{m.current=null,console.log(`✅ [${r}] fetchUserProfile: 実行完了`,{authUserId:e})}},b=async(e,r)=>{console.log("signIn: 開始",{email:e}),f(!0);try{console.log("signIn: Supabase認証開始");let s=n.OQ.auth.signInWithPassword({email:e,password:r}),t=new Promise((e,r)=>{setTimeout(()=>r(Error("認証タイムアウト（30秒）")),3e4)}),{data:o,error:l}=await Promise.race([s,t]);if(console.log("signIn: Supabase認証結果",{data:o?.user?.id,error:l?.message}),l)throw l;console.log("signIn: 認証成功"),o?.user&&(console.log("signIn: ユーザープロフィール取得開始"),setTimeout(()=>{x(o.user.id)},50),console.log("signIn: ユーザープロフィール取得完了"))}catch(e){throw console.error("signIn: 認証エラー",e),e}finally{console.log("signIn: 終了"),f(!1)}},p=async(e,r,s)=>{f(!0);try{let{data:t,error:o}=await n.OQ.auth.signUp({email:e,password:r,options:{data:{display_name:s.display_name,specialties:s.specialties||[],qualifications:s.qualifications||[]}}});if(o)throw o;if(t.user){let{error:e}=await n.OQ.from("users").insert({auth_user_id:t.user.id,email:t.user.email,display_name:s.display_name||"",specialties:s.specialties||[],qualifications:s.qualifications||[],experience_years:s.experience_years});e&&console.error("Error creating user profile:",e)}}finally{f(!1)}},y=async()=>{f(!0);try{let{error:e}=await n.OQ.auth.signOut();if(e)throw e;s(null),a(null),d(null)}finally{f(!1)}},w=async e=>{if(!i)throw console.error("updateProfile: userProfile is null"),Error("ユーザープロフィールが見つかりません");try{console.log("updateProfile: 更新開始",{userId:i.id,updates:e});let{data:r,error:s}=await n.OQ.from("users").update(e).eq("id",i.id).select().single();if(s)throw console.error("updateProfile: Supabaseエラー",s),s;console.log("updateProfile: 更新成功",r),a({...i,...e})}catch(e){throw console.error("Error updating profile:",e),e}};return t.jsx(l.Provider,{value:{user:r,userProfile:i,userRole:c,userOrganization:u,loading:g,signIn:b,signUp:p,signOut:y,updateProfile:w,getRedirectPath:()=>{if(!c)return"/dashboard";switch(c){case"Contractor":return"/jobs";case"OrgAdmin":return"/projects";case"Reviewer":return"/reviews";default:return"/dashboard"}}},children:e})}},18704:(e,r,s)=>{"use strict";s.d(r,{OQ:()=>t});let t=(0,s(99072).eI)("https://rxnozwuamddqlcwysxag.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bm96d3VhbWRkcWxjd3lzeGFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NjY4MDMsImV4cCI6MjA3MzM0MjgwM30.0sbl6zWJ1XalGTFbsgeMpth6yH-oQA_P1eTCc8lKoAU")},24117:(e,r,s)=>{"use strict";s.r(r),s.d(r,{$$typeof:()=>n,__esModule:()=>o,default:()=>l});let t=(0,s(86843).createProxy)(String.raw`/Users/sayuri/caddonworks/src/app/error.tsx`),{__esModule:o,$$typeof:n}=t,l=t.default},83543:(e,r,s)=>{"use strict";s.d(r,{ZP:()=>l});let t=(0,s(86843).createProxy)(String.raw`/Users/sayuri/caddonworks/src/app/global-error.tsx`),{__esModule:o,$$typeof:n}=t,l=t.default},61623:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>h,metadata:()=>u});var t=s(25036),o=s(42195),n=s.n(o),l=s(86843);let i=(0,l.createProxy)(String.raw`/Users/sayuri/caddonworks/src/contexts/auth-context.tsx`),{__esModule:a,$$typeof:c}=i;i.default,(0,l.createProxy)(String.raw`/Users/sayuri/caddonworks/src/contexts/auth-context.tsx#useAuth`);let d=(0,l.createProxy)(String.raw`/Users/sayuri/caddonworks/src/contexts/auth-context.tsx#AuthProvider`);s(5023);let u={title:"土木設計業務プラットフォーム | Civil Engineering Platform",description:"AI-powered civil engineering project management platform with secure file handling and comprehensive billing system.",keywords:["civil engineering","project management","construction","CAD","design"]};function h({children:e}){return t.jsx("html",{lang:"ja",className:"h-full",children:t.jsx("body",{className:`${n().className} h-full antialiased`,children:t.jsx(d,{children:e})})})}},48206:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>l});var t=s(25036),o=s(40646),n=s.n(o);function l(){return t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6 text-center",children:[t.jsx("div",{className:"flex items-center justify-center w-16 h-16 mx-auto bg-gray-100 rounded-full mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"})})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"404"}),t.jsx("h2",{className:"text-lg font-semibold text-gray-700 mb-4",children:"ページが見つかりません"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"お探しのページは存在しないか、移動された可能性があります。"}),t.jsx(n(),{href:"/",className:"inline-block bg-engineering-blue text-white px-6 py-2 rounded-lg hover:bg-engineering-blue/90 transition-colors",children:"ホームに戻る"})]})})}},5023:()=>{}};